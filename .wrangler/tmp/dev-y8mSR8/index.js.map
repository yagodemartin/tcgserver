{
  "version": 3,
  "sources": ["../../../src/games/registry.js", "../../../src/games/pokemon/constants.js", "../../../src/games/pokemon/limitless.js", "../../../src/games/pokemon/enhancers.js", "../../../src/games/pokemon/adapter.js", "../../../src/games/magic/adapter.js", "../../../src/core/response.js", "../../../src/core/errors.js", "../../../src/core/cache.js", "../../../src/routes/meta.js", "../../../src/routes/tournaments.js", "../../../src/routes/deck.js", "../../../src/ui/demo.html.js", "../../../src/routes/demo.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/api-requests.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/emulator.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/errors.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/validator.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/version.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/client.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/user-record.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/auth-api-requests.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/utf8.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/base64.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/x509.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/jwk-fetcher.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/jws-verifier.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/jwt-decoder.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/token-verifier.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/auth.js", "../../../node_modules/firebase-auth-cloudflare-workers/dist/module/index.js", "../../../src/middleware/auth.js", "../../../src/services/firestore.js", "../../../src/routes/userTournaments.js", "../../../src/routes/userMatches.js", "../../../src/middleware/rateLimit.js", "../../../src/index.js", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-GaryF3/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-GaryF3/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\yagod\\Documents\\Proyectos\\TCGServer\\.wrangler\\tmp\\dev-y8mSR8",
  "sourcesContent": ["/**\n * Game Adapter Registry\n * Manages different TCG game adapters (Pokemon, Magic, etc.)\n */\n\n/**\n * Base class for game adapters\n * All game adapters must implement these methods\n */\nexport class GameAdapter {\n\tconstructor(game) {\n\t\tthis.game = game;\n\t}\n\n\t/**\n\t * Fetch recent tournaments\n\t * @param {number} days - Number of days to look back\n\t * @param {string} format - Game format (standard, expanded, etc.)\n\t * @param {number} limit - Max tournaments to fetch\n\t * @returns {Promise<Array>} Tournament list\n\t */\n\tasync fetchTournaments(days, format, limit) {\n\t\tthrow new Error('fetchTournaments not implemented');\n\t}\n\n\t/**\n\t * Fetch standings for a tournament\n\t * @param {string} tournamentId - Tournament ID\n\t * @returns {Promise<Array>} Standings array\n\t */\n\tasync fetchStandings(tournamentId) {\n\t\tthrow new Error('fetchStandings not implemented');\n\t}\n\n\t/**\n\t * Fetch detailed deck info\n\t * @param {string} deckName - Deck name\n\t * @param {number} days - Number of days to look back\n\t * @param {string} format - Game format\n\t * @returns {Promise<object|null>} Deck info or null\n\t */\n\tasync fetchDeckDetails(deckName, days, format) {\n\t\tthrow new Error('fetchDeckDetails not implemented');\n\t}\n\n\t/**\n\t * Extract main card from decklist\n\t * @param {object} decklist - Decklist object\n\t * @returns {object|null} Main card info\n\t */\n\textractMainCard(decklist) {\n\t\tthrow new Error('extractMainCard not implemented');\n\t}\n\n\t/**\n\t * Enhance card list with images\n\t * @param {object} decklist - Decklist object\n\t * @returns {object} Enhanced decklist\n\t */\n\tenhanceCardListWithImages(decklist) {\n\t\tthrow new Error('enhanceCardListWithImages not implemented');\n\t}\n\n\t/**\n\t * Get card image URL\n\t * @param {string} cardSet - Card set code\n\t * @param {string} cardNumber - Card number\n\t * @param {string} size - Image size\n\t * @returns {string|null} Image URL\n\t */\n\tgetCardImageUrl(cardSet, cardNumber, size) {\n\t\tthrow new Error('getCardImageUrl not implemented');\n\t}\n\n\t/**\n\t * Get deck URL on external site\n\t * @param {string} deckId - Deck ID\n\t * @returns {string} Deck URL\n\t */\n\tgetDeckUrl(deckId) {\n\t\tthrow new Error('getDeckUrl not implemented');\n\t}\n\n\t/**\n\t * Build cache key for meta data\n\t */\n\tgetMetaCacheKey(format, days, limit) {\n\t\treturn `${this.game}:meta:top:${format}:${days}:${limit}`;\n\t}\n\n\t/**\n\t * Build cache key for tournaments\n\t */\n\tgetTournamentsCacheKey(format, days, limit) {\n\t\treturn `${this.game}:tournaments:recent:${format}:${days}:${limit}`;\n\t}\n\n\t/**\n\t * Build cache key for deck details\n\t */\n\tgetDeckCacheKey(deckName, format, days) {\n\t\treturn `${this.game}:deck:${deckName}:${format}:${days}`;\n\t}\n}\n\n/**\n * Game Adapter Registry\n * Singleton that manages all game adapters\n */\nclass AdapterRegistry {\n\tconstructor() {\n\t\tthis.adapters = new Map();\n\t}\n\n\t/**\n\t * Register a game adapter\n\t */\n\tregister(game, adapter) {\n\t\tif (!(adapter instanceof GameAdapter)) {\n\t\t\tthrow new Error('Adapter must extend GameAdapter class');\n\t\t}\n\t\tthis.adapters.set(game.toLowerCase(), adapter);\n\t}\n\n\t/**\n\t * Get adapter for a game\n\t */\n\tget(game) {\n\t\treturn this.adapters.get(game.toLowerCase());\n\t}\n\n\t/**\n\t * Check if game is supported\n\t */\n\tisSupported(game) {\n\t\treturn this.adapters.has(game.toLowerCase());\n\t}\n\n\t/**\n\t * Get list of supported games\n\t */\n\tgetSupportedGames() {\n\t\treturn Array.from(this.adapters.keys());\n\t}\n}\n\n// Export singleton instance\nexport const gameRegistry = new AdapterRegistry();\n", "/**\n * Pokemon TCG constants\n */\n\nexport const LIMITLESS_API_BASE = 'https://play.limitlesstcg.com/api';\nexport const LIMITLESS_CDN_BASE = 'https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com/tpci';\n\nexport const FORMATS = {\n\tSTANDARD: 'standard',\n\tEXPANDED: 'expanded',\n};\n\n/**\n * Pokemon TCG set colors for visual identification\n * Used when card images fail to load\n */\nexport const SET_COLORS = {\n\t// Current era (Scarlet & Violet)\n\t'TWM': '#8B4789',  // Twilight Masquerade - Purple\n\t'PRE': '#22B14C',  // Primal Energy - Green\n\t'OBF': '#FF8C00',  // Obsidian Flames - Orange\n\t'PAL': '#1E90FF',  // Paldean Fates - Blue\n\t'SVI': '#DC143C',  // Scarlet & Violet - Red\n\t'MEG': '#FFD700',  // Magneton Meta - Gold\n\t'TEF': '#20B2AA',  // Temporal Forces - Teal\n\t'ASC': '#9370DB',  // Ancient Roar - Indigo\n\t'DRI': '#FF6347',  // Dragon Tera - Coral\n\t'MEW': '#00CED1',  // Mewtwo - Cyan\n\t'PAF': '#FF69B4',  // Paldean Future - Pink\n\t'PFL': '#8B7355',  // Paldean Fates - Brown\n\t'SCR': '#4169E1',  // Scarlet - Royal Blue\n\t'SLV': '#C0C0C0',  // Silver - Silver\n\t'SHF': '#FF4500',  // Shining Fates - Red-Orange\n\t'SVP': '#DA70D6',  // Sword/Shield Purple\n};\n\nexport const DEFAULT_SET_COLOR = '#808080'; // Gray\n", "/**\n * Limitless TCG API client for Pokemon\n */\n\nimport { LIMITLESS_API_BASE } from './constants.js';\n\n/**\n * Fetch tournaments from Limitless API\n * @param {number} days - Number of days to look back\n * @param {string} format - Format (standard, expanded)\n * @param {number} limit - Max tournaments to fetch\n * @returns {Promise<Array>} Tournament array\n */\nexport async function fetchTournaments(days = 7, format = 'standard', limit = 50) {\n\tconst now = new Date();\n\tconst startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n\n\tconst params = new URLSearchParams({\n\t\tgame: 'PTCG',\n\t\tformat: format.toUpperCase(),\n\t\tlimit,\n\t\tpage: 0,\n\t});\n\n\ttry {\n\t\tconst res = await fetch(`${LIMITLESS_API_BASE}/tournaments?${params}`);\n\t\tif (!res.ok) throw new Error(`Limitless API error: ${res.status}`);\n\n\t\tconst data = await res.json();\n\n\t\t// Filter tournaments from last N days\n\t\t// API returns array directly, not wrapped\n\t\treturn (Array.isArray(data) ? data : data.tournaments || []).filter(t => {\n\t\t\tconst tDate = new Date(t.date);\n\t\t\treturn tDate >= startDate;\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('fetchTournaments error:', err);\n\t\tthrow err;\n\t}\n}\n\n/**\n * Fetch standings for a specific tournament (with retries on rate limit)\n * @param {string} tournamentId - Tournament ID\n * @param {number} retries - Max retries\n * @returns {Promise<Array>} Standings array\n */\nexport async function fetchStandings(tournamentId, retries = 3) {\n\tfor (let i = 0; i < retries; i++) {\n\t\ttry {\n\t\t\tconst res = await fetch(`${LIMITLESS_API_BASE}/tournaments/${tournamentId}/standings`);\n\n\t\t\t// Check for rate limit\n\t\t\tif (res.status === 429) {\n\t\t\t\tconst retryAfter = res.headers.get('Retry-After');\n\t\t\t\tconst delay = retryAfter ? parseInt(retryAfter) * 1000 : (1000 * Math.pow(2, i));\n\t\t\t\tconsole.warn(`Rate limited, retrying after ${delay}ms`);\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, delay));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!res.ok) throw new Error(`Limitless API error: ${res.status}`);\n\t\t\treturn await res.json();\n\t\t} catch (err) {\n\t\t\tif (i === retries - 1) {\n\t\t\t\tconsole.error(`fetchStandings(${tournamentId}) failed after ${retries} retries:`, err);\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));\n\t\t}\n\t}\n\treturn [];\n}\n", "/**\n * Pokemon TCG card enhancement utilities\n */\n\nimport { LIMITLESS_CDN_BASE, SET_COLORS, DEFAULT_SET_COLOR } from './constants.js';\n\n/**\n * Extract main card from deck (prioritize \"ex\" cards, then first pokemon)\n */\nexport function extractMainCard(decklist) {\n\tif (!decklist || !decklist.pokemon || decklist.pokemon.length === 0) {\n\t\treturn null;\n\t}\n\n\t// First, try to find an \"ex\" card\n\tconst exCard = decklist.pokemon.find(card => card.name && card.name.includes('ex'));\n\tif (exCard) {\n\t\treturn { name: exCard.name, set: exCard.set, number: exCard.number };\n\t}\n\n\t// Otherwise, return first pokemon\n\tconst firstCard = decklist.pokemon[0];\n\treturn { name: firstCard.name, set: firstCard.set, number: firstCard.number };\n}\n\n/**\n * Get card image URL using Limitless CDN\n * No API call needed - construct URL directly\n * Format: https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com/tpci/[SET]/[SET]_[CARD_ID]_R_EN_[SIZE].png\n */\nexport function getCardImageUrl(cardSet, cardNumber, size = 'SM') {\n\tif (!cardSet || !cardNumber) return null;\n\treturn `${LIMITLESS_CDN_BASE}/${cardSet}/${cardSet}_${cardNumber}_R_EN_${size}.png`;\n}\n\n/**\n * Get set color for visual identification\n * Returns a color code for each Pokemon TCG set\n */\nexport function getSetColor(cardSet) {\n\tif (!cardSet) return DEFAULT_SET_COLOR;\n\treturn SET_COLORS[cardSet.toUpperCase()] || DEFAULT_SET_COLOR;\n}\n\n/**\n * Enhance card list with images from Limitless CDN\n */\nexport function enhanceCardListWithImages(decklist) {\n\tif (!decklist) return decklist;\n\n\tconst enhanced = { ...decklist };\n\n\t// Function to add images to cards\n\tconst addImagesToCards = (cards) => {\n\t\tif (!Array.isArray(cards)) return cards;\n\n\t\treturn cards.map(card => {\n\t\t\t// Use Limitless CDN for images\n\t\t\tif (card.set && card.number) {\n\t\t\t\tcard.image = getCardImageUrl(card.set, card.number, 'SM');\n\t\t\t}\n\t\t\treturn card;\n\t\t});\n\t};\n\n\t// Add images to all card types\n\tif (enhanced.pokemon) {\n\t\tenhanced.pokemon = addImagesToCards(enhanced.pokemon);\n\t}\n\tif (enhanced.trainer) {\n\t\tenhanced.trainer = addImagesToCards(enhanced.trainer);\n\t}\n\tif (enhanced.energy) {\n\t\tenhanced.energy = addImagesToCards(enhanced.energy);\n\t}\n\n\treturn enhanced;\n}\n\n/**\n * Aggregate decks from standings with main card info\n */\nexport async function aggregateDecks(standingsArray) {\n\tconst deckMap = {};\n\n\t// Aggregate deck info\n\tstandingsArray.forEach(standing => {\n\t\tif (standing.deck && standing.deck.name) {\n\t\t\tconst deckName = standing.deck.name;\n\t\t\tif (!deckMap[deckName]) {\n\t\t\t\tdeckMap[deckName] = {\n\t\t\t\t\tname: deckName,\n\t\t\t\t\tcount: 0,\n\t\t\t\t\tmainCard: extractMainCard(standing.decklist),\n\t\t\t\t\tdeckId: standing.deck.id,\n\t\t\t\t\ticons: standing.deck.icons || [],\n\t\t\t\t};\n\t\t\t}\n\t\t\tdeckMap[deckName].count++;\n\t\t}\n\t});\n\n\t// Add URLs and images for visual identification\n\tObject.values(deckMap).forEach(deck => {\n\t\tif (deck.mainCard) {\n\t\t\tdeck.setColor = getSetColor(deck.mainCard.set);\n\t\t\tdeck.setCode = deck.mainCard.set;\n\t\t\t// Use main card image from Limitless CDN (large size)\n\t\t\tdeck.image = getCardImageUrl(deck.mainCard.set, deck.mainCard.number, 'LG');\n\t\t}\n\t\t// Limitless deck URL\n\t\tdeck.deckUrl = `https://play.limitlesstcg.com/deck/${deck.deckId}`;\n\t});\n\n\tconst decks = Object.values(deckMap);\n\n\t// Sort by count descending\n\treturn decks.sort((a, b) => b.count - a.count);\n}\n", "/**\n * Pokemon TCG Game Adapter\n */\n\nimport { GameAdapter } from '../registry.js';\nimport { fetchTournaments, fetchStandings } from './limitless.js';\nimport {\n\textractMainCard,\n\tgetCardImageUrl,\n\tgetSetColor,\n\tenhanceCardListWithImages,\n\taggregateDecks,\n} from './enhancers.js';\n\nexport class PokemonAdapter extends GameAdapter {\n\tconstructor() {\n\t\tsuper('pokemon');\n\t}\n\n\t/**\n\t * Fetch recent tournaments from Limitless API\n\t */\n\tasync fetchTournaments(days, format, limit) {\n\t\treturn await fetchTournaments(days, format, limit);\n\t}\n\n\t/**\n\t * Fetch standings for a tournament\n\t */\n\tasync fetchStandings(tournamentId) {\n\t\treturn await fetchStandings(tournamentId);\n\t}\n\n\t/**\n\t * Fetch detailed deck info by aggregating tournament standings\n\t */\n\tasync fetchDeckDetails(deckName, days = 7, format = 'standard') {\n\t\tconst tournaments = await this.fetchTournaments(days, format, 50);\n\n\t\tif (tournaments.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst deckInfo = {\n\t\t\tname: deckName,\n\t\t\tappearances: 0,\n\t\t\ttopPlacements: [],\n\t\t\tcardList: null,\n\t\t\tmainCard: null,\n\t\t};\n\n\t\t// Process only first 5 tournaments to avoid rate limiting\n\t\tconst tournamentsToProcess = tournaments.slice(0, 5);\n\n\t\tfor (let i = 0; i < tournamentsToProcess.length; i++) {\n\t\t\tconst tournament = tournamentsToProcess[i];\n\t\t\tconst standings = await this.fetchStandings(tournament.id);\n\n\t\t\tstandings.forEach(standing => {\n\t\t\t\tif (standing.deck && standing.deck.name === deckName) {\n\t\t\t\t\tdeckInfo.appearances++;\n\n\t\t\t\t\t// Record top 8 placements\n\t\t\t\t\tif (standing.placing <= 8) {\n\t\t\t\t\t\tdeckInfo.topPlacements.push({\n\t\t\t\t\t\t\tplacing: standing.placing,\n\t\t\t\t\t\t\tplayer: standing.name,\n\t\t\t\t\t\t\ttournament: tournament.name,\n\t\t\t\t\t\t\tdate: tournament.date,\n\t\t\t\t\t\t\trecord: standing.record,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Get card list from first occurrence\n\t\t\t\t\tif (standing.decklist && !deckInfo.cardList) {\n\t\t\t\t\t\tdeckInfo.cardList = standing.decklist;\n\t\t\t\t\t\tdeckInfo.mainCard = this.extractMainCard(standing.decklist);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Delay between requests to respect rate limiting\n\t\t\tif (i < tournamentsToProcess.length - 1) {\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 500));\n\t\t\t}\n\t\t}\n\n\t\t// Enhance card list with images if found\n\t\tif (deckInfo.cardList) {\n\t\t\tdeckInfo.cardList = this.enhanceCardListWithImages(deckInfo.cardList);\n\t\t}\n\n\t\treturn deckInfo.appearances > 0 ? deckInfo : null;\n\t}\n\n\t/**\n\t * Extract main card from decklist\n\t */\n\textractMainCard(decklist) {\n\t\treturn extractMainCard(decklist);\n\t}\n\n\t/**\n\t * Enhance card list with images\n\t */\n\tenhanceCardListWithImages(decklist) {\n\t\treturn enhanceCardListWithImages(decklist);\n\t}\n\n\t/**\n\t * Get card image URL\n\t */\n\tgetCardImageUrl(cardSet, cardNumber, size = 'SM') {\n\t\treturn getCardImageUrl(cardSet, cardNumber, size);\n\t}\n\n\t/**\n\t * Get deck URL on Limitless\n\t */\n\tgetDeckUrl(deckId) {\n\t\treturn `https://play.limitlesstcg.com/deck/${deckId}`;\n\t}\n\n\t/**\n\t * Get set color for visual identification\n\t */\n\tgetSetColor(cardSet) {\n\t\treturn getSetColor(cardSet);\n\t}\n\n\t/**\n\t * Aggregate decks from standings\n\t */\n\tasync aggregateDecks(standingsArray) {\n\t\treturn await aggregateDecks(standingsArray);\n\t}\n}\n", "/**\n * Magic: The Gathering Game Adapter (Stub - Phase 2)\n */\n\nimport { GameAdapter } from '../registry.js';\n\nexport class MagicAdapter extends GameAdapter {\n\tconstructor() {\n\t\tsuper('magic');\n\t}\n\n\tasync fetchTournaments(days, format, limit) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n\n\tasync fetchStandings(tournamentId) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n\n\tasync fetchDeckDetails(deckName, days, format) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n\n\textractMainCard(decklist) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n\n\tenhanceCardListWithImages(decklist) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n\n\tgetCardImageUrl(cardSet, cardNumber, size) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n\n\tgetDeckUrl(deckId) {\n\t\tthrow new Error('Magic: The Gathering support coming soon (Phase 2)');\n\t}\n}\n", "/**\n * Response helper utilities\n */\n\nexport function jsonResponse(data, options = {}) {\n\tconst {\n\t\tstatus = 200,\n\t\tcache = null,\n\t\tcacheControl = null,\n\t\tcors = true,\n\t} = options;\n\n\tconst headers = {\n\t\t'Content-Type': 'application/json',\n\t};\n\n\tif (cors) {\n\t\theaders['Access-Control-Allow-Origin'] = '*';\n\t\theaders['Access-Control-Allow-Methods'] = 'GET, POST, PUT, DELETE, OPTIONS';\n\t\theaders['Access-Control-Allow-Headers'] = 'Content-Type, Authorization';\n\t}\n\n\tif (cache) {\n\t\theaders['X-Cache'] = cache;\n\t}\n\n\tif (cacheControl) {\n\t\theaders['Cache-Control'] = cacheControl;\n\t}\n\n\treturn new Response(JSON.stringify(data), {\n\t\tstatus,\n\t\theaders,\n\t});\n}\n\nexport function corsOptionsResponse() {\n\treturn new Response(null, {\n\t\tstatus: 204,\n\t\theaders: {\n\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t\t'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n\t\t\t'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n\t\t\t'Access-Control-Max-Age': '86400',\n\t\t},\n\t});\n}\n\nexport function htmlResponse(html, options = {}) {\n\tconst { cacheControl = 'public, max-age=300' } = options;\n\n\treturn new Response(html, {\n\t\theaders: {\n\t\t\t'Content-Type': 'text/html; charset=utf-8',\n\t\t\t'Cache-Control': cacheControl,\n\t\t},\n\t});\n}\n", "/**\n * Error response utilities\n */\n\nexport function errorResponse(message, status = 500, details = null) {\n\tconst body = { error: message };\n\tif (details) {\n\t\tbody.details = details;\n\t}\n\n\treturn new Response(JSON.stringify(body), {\n\t\tstatus,\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t},\n\t});\n}\n\nexport function notFoundResponse(message = 'Not found') {\n\treturn errorResponse(message, 404);\n}\n\nexport function unauthorizedResponse(message = 'Unauthorized') {\n\treturn errorResponse(message, 401);\n}\n\nexport function badRequestResponse(message = 'Bad request', details = null) {\n\treturn errorResponse(message, 400, details);\n}\n\nexport function rateLimitResponse(retryAfter = 3600) {\n\treturn new Response(JSON.stringify({\n\t\terror: 'Rate limit exceeded',\n\t\tretryAfter,\n\t}), {\n\t\tstatus: 429,\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Retry-After': String(retryAfter),\n\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t},\n\t});\n}\n\nexport function methodNotAllowedResponse(allowed = ['GET']) {\n\treturn new Response(JSON.stringify({\n\t\terror: 'Method not allowed',\n\t}), {\n\t\tstatus: 405,\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Allow': allowed.join(', '),\n\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t},\n\t});\n}\n\nexport function comingSoonResponse(game) {\n\treturn new Response(JSON.stringify({\n\t\terror: 'Coming soon',\n\t\tmessage: `${game} support is not yet implemented. Currently only Pokemon TCG is available.`,\n\t}), {\n\t\tstatus: 501,\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t},\n\t});\n}\n", "/**\n * KV Cache utilities for Cloudflare Workers\n */\n\nexport class CacheManager {\n\tconstructor(kvNamespace) {\n\t\tthis.kv = kvNamespace;\n\t}\n\n\t/**\n\t * Get cached data\n\t */\n\tasync get(key) {\n\t\ttry {\n\t\t\tconst cached = await this.kv.get(key);\n\t\t\treturn cached ? JSON.parse(cached) : null;\n\t\t} catch (err) {\n\t\t\tconsole.error('Cache get error:', err);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Set cached data with TTL\n\t */\n\tasync set(key, value, ttl = 3600) {\n\t\ttry {\n\t\t\tawait this.kv.put(key, JSON.stringify(value), { expirationTtl: ttl });\n\t\t\treturn true;\n\t\t} catch (err) {\n\t\t\tconsole.error('Cache set error:', err);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Delete cached data\n\t */\n\tasync delete(key) {\n\t\ttry {\n\t\t\tawait this.kv.delete(key);\n\t\t\treturn true;\n\t\t} catch (err) {\n\t\t\tconsole.error('Cache delete error:', err);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Build cache key for meta endpoint\n\t */\n\tbuildMetaCacheKey(game, format, days, limit) {\n\t\treturn `${game}:meta:top:${format}:${days}:${limit}`;\n\t}\n\n\t/**\n\t * Build cache key for tournaments endpoint\n\t */\n\tbuildTournamentsCacheKey(game, format, days, limit) {\n\t\treturn `${game}:tournaments:recent:${format}:${days}:${limit}`;\n\t}\n\n\t/**\n\t * Build cache key for deck details endpoint\n\t */\n\tbuildDeckCacheKey(game, deckName, format, days) {\n\t\treturn `${game}:deck:${deckName}:${format}:${days}`;\n\t}\n}\n", "/**\n * Meta endpoints - Top decks from recent tournaments\n */\n\nimport { gameRegistry } from '../games/registry.js';\nimport { jsonResponse } from '../core/response.js';\nimport { errorResponse, comingSoonResponse } from '../core/errors.js';\nimport { CacheManager } from '../core/cache.js';\n\n/**\n * GET /v1/:game/meta/top - Return top meta decks\n */\nexport async function handleMetaTop(request, env, ctx, game) {\n\tconst url = new URL(request.url);\n\tconst days = parseInt(url.searchParams.get('days')) || 7;\n\tconst format = (url.searchParams.get('format') || 'standard').toLowerCase();\n\tconst limit = parseInt(url.searchParams.get('limit')) || 10;\n\n\t// Get game adapter\n\tconst adapter = gameRegistry.get(game);\n\tif (!adapter) {\n\t\treturn comingSoonResponse(game);\n\t}\n\n\tconst cache = new CacheManager(env.KVDB);\n\tconst cacheKey = adapter.getMetaCacheKey(format, days, limit);\n\n\ttry {\n\t\t// Check cache first\n\t\tconst cached = await cache.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn jsonResponse(cached, { cache: 'HIT' });\n\t\t}\n\n\t\t// Fetch tournaments\n\t\tconst tournaments = await adapter.fetchTournaments(days, format, 50);\n\n\t\tif (tournaments.length === 0) {\n\t\t\treturn jsonResponse({\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\tformat,\n\t\t\t\tdays,\n\t\t\t\tdecks: [],\n\t\t\t\tmessage: 'No tournaments found',\n\t\t\t});\n\t\t}\n\n\t\t// Process only first 5 tournaments to avoid rate limiting\n\t\tconst tournamentsToProcess = tournaments.slice(0, 5);\n\n\t\t// Fetch standings for each tournament with delays\n\t\tconst allStandings = [];\n\t\tfor (let i = 0; i < tournamentsToProcess.length; i++) {\n\t\t\tconst tournament = tournamentsToProcess[i];\n\t\t\tconst standings = await adapter.fetchStandings(tournament.id);\n\t\t\tallStandings.push(...standings);\n\n\t\t\t// Delay between requests to respect rate limiting\n\t\t\tif (i < tournamentsToProcess.length - 1) {\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 500));\n\t\t\t}\n\t\t}\n\n\t\t// Aggregate and sort decks\n\t\tconst allDecks = await adapter.aggregateDecks(allStandings);\n\t\tconst decks = allDecks.slice(0, limit);\n\n\t\tconst response = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t\tformat,\n\t\t\tdays,\n\t\t\tdecks,\n\t\t};\n\n\t\t// Cache for 12 hours\n\t\tctx.waitUntil(cache.set(cacheKey, response, 43200));\n\n\t\treturn jsonResponse(response, { cache: 'MISS' });\n\t} catch (err) {\n\t\tconsole.error('handleMetaTop error:', err);\n\t\t// Check if this is a \"coming soon\" error\n\t\tif (err.message && err.message.includes('coming soon')) {\n\t\t\treturn comingSoonResponse(game);\n\t\t}\n\t\treturn errorResponse('Internal server error', 500, err.message);\n\t}\n}\n", "/**\n * Tournaments endpoints - Recent tournament listings\n */\n\nimport { gameRegistry } from '../games/registry.js';\nimport { jsonResponse } from '../core/response.js';\nimport { errorResponse, comingSoonResponse } from '../core/errors.js';\nimport { CacheManager } from '../core/cache.js';\n\n/**\n * GET /v1/:game/tournaments/recent - Return recent tournaments\n */\nexport async function handleTournamentsRecent(request, env, ctx, game) {\n\tconst url = new URL(request.url);\n\tconst days = parseInt(url.searchParams.get('days')) || 7;\n\tconst format = (url.searchParams.get('format') || 'standard').toLowerCase();\n\tconst limit = parseInt(url.searchParams.get('limit')) || 50;\n\n\t// Get game adapter\n\tconst adapter = gameRegistry.get(game);\n\tif (!adapter) {\n\t\treturn comingSoonResponse(game);\n\t}\n\n\tconst cache = new CacheManager(env.KVDB);\n\tconst cacheKey = adapter.getTournamentsCacheKey(format, days, limit);\n\n\ttry {\n\t\t// Check cache first\n\t\tconst cached = await cache.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn jsonResponse(cached, { cache: 'HIT' });\n\t\t}\n\n\t\t// Fetch tournaments\n\t\tconst tournaments = await adapter.fetchTournaments(days, format, limit);\n\n\t\tconst response = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t\tformat,\n\t\t\tdays,\n\t\t\tcount: tournaments.length,\n\t\t\ttournaments: tournaments.map(t => ({\n\t\t\t\tid: t.id,\n\t\t\t\tname: t.name,\n\t\t\t\tdate: t.date,\n\t\t\t\tplayers: t.players || 0,\n\t\t\t\tformat: t.format,\n\t\t\t})),\n\t\t};\n\n\t\t// Cache for 6 hours\n\t\tctx.waitUntil(cache.set(cacheKey, response, 21600));\n\n\t\treturn jsonResponse(response, { cache: 'MISS' });\n\t} catch (err) {\n\t\tconsole.error('handleTournamentsRecent error:', err);\n\t\t// Check if this is a \"coming soon\" error\n\t\tif (err.message && err.message.includes('coming soon')) {\n\t\t\treturn comingSoonResponse(game);\n\t\t}\n\t\treturn errorResponse('Internal server error', 500, err.message);\n\t}\n}\n", "/**\n * Deck details endpoints\n */\n\nimport { gameRegistry } from '../games/registry.js';\nimport { jsonResponse } from '../core/response.js';\nimport { errorResponse, notFoundResponse, comingSoonResponse } from '../core/errors.js';\nimport { CacheManager } from '../core/cache.js';\n\n/**\n * GET /v1/:game/meta/deck/:deckName - Get detailed deck info\n */\nexport async function handleDeckDetails(request, env, ctx, game, deckName) {\n\tconst url = new URL(request.url);\n\tconst days = parseInt(url.searchParams.get('days')) || 7;\n\tconst format = (url.searchParams.get('format') || 'standard').toLowerCase();\n\n\t// Get game adapter\n\tconst adapter = gameRegistry.get(game);\n\tif (!adapter) {\n\t\treturn comingSoonResponse(game);\n\t}\n\n\tconst decodedDeckName = decodeURIComponent(deckName);\n\tconst cache = new CacheManager(env.KVDB);\n\tconst cacheKey = adapter.getDeckCacheKey(decodedDeckName, format, days);\n\n\ttry {\n\t\t// Check cache first\n\t\tconst cached = await cache.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn jsonResponse(cached, { cache: 'HIT' });\n\t\t}\n\n\t\t// Fetch deck details\n\t\tconst deckInfo = await adapter.fetchDeckDetails(decodedDeckName, days, format);\n\n\t\tif (!deckInfo) {\n\t\t\treturn notFoundResponse(`No recent data found for deck: ${decodedDeckName}`);\n\t\t}\n\n\t\t// Add set color and code if main card exists\n\t\tif (deckInfo.mainCard && adapter.getSetColor) {\n\t\t\tdeckInfo.setColor = adapter.getSetColor(deckInfo.mainCard.set);\n\t\t\tdeckInfo.setCode = deckInfo.mainCard.set;\n\t\t}\n\n\t\tconst response = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t\tformat,\n\t\t\tdays,\n\t\t\tdeck: deckInfo,\n\t\t};\n\n\t\t// Cache for 12 hours\n\t\tctx.waitUntil(cache.set(cacheKey, response, 43200));\n\n\t\treturn jsonResponse(response, { cache: 'MISS' });\n\t} catch (err) {\n\t\tconsole.error('handleDeckDetails error:', err);\n\t\t// Check if this is a \"coming soon\" error\n\t\tif (err.message && err.message.includes('coming soon')) {\n\t\t\treturn comingSoonResponse(game);\n\t\t}\n\t\treturn errorResponse('Internal server error', 500, err.message);\n\t}\n}\n", "/**\n * Demo HTML template with multi-game support\n */\n\nexport function generateDemoHTML() {\n\treturn `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t<title>TCG Companion - Multi-Game Meta Dashboard</title>\n\t<style>\n\t\t* { margin: 0; padding: 0; box-sizing: border-box; }\n\t\tbody {\n\t\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\tmin-height: 100vh;\n\t\t\tpadding: 20px;\n\t\t\tcolor: #333;\n\t\t}\n\t\t.container { max-width: 1200px; margin: 0 auto; }\n\t\theader {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 30px;\n\t\t\tmargin-bottom: 30px;\n\t\t\tbox-shadow: 0 4px 6px rgba(0,0,0,0.1);\n\t\t}\n\t\th1 { color: #667eea; margin-bottom: 10px; }\n\t\t.subtitle { color: #666; font-size: 14px; }\n\t\t.controls {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 20px;\n\t\t\tmargin-bottom: 30px;\n\t\t\tbox-shadow: 0 4px 6px rgba(0,0,0,0.1);\n\t\t\tdisplay: flex;\n\t\t\tgap: 15px;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-items: flex-end;\n\t\t}\n\t\t.control-group {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tgap: 5px;\n\t\t}\n\t\tlabel {\n\t\t\tfont-size: 12px;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #666;\n\t\t\ttext-transform: uppercase;\n\t\t}\n\t\tselect, input {\n\t\t\tpadding: 8px 12px;\n\t\t\tborder: 2px solid #e0e0e0;\n\t\t\tborder-radius: 6px;\n\t\t\tfont-size: 14px;\n\t\t}\n\t\tselect:focus, input:focus {\n\t\t\toutline: none;\n\t\t\tborder-color: #667eea;\n\t\t}\n\t\toption:disabled {\n\t\t\tcolor: #999;\n\t\t\tfont-style: italic;\n\t\t}\n\t\tbutton {\n\t\t\tpadding: 10px 20px;\n\t\t\tbackground: #667eea;\n\t\t\tcolor: white;\n\t\t\tborder: none;\n\t\t\tborder-radius: 6px;\n\t\t\tfont-weight: 600;\n\t\t\tcursor: pointer;\n\t\t}\n\t\tbutton:hover { background: #5568d3; }\n\t\tbutton:disabled { background: #ccc; cursor: not-allowed; }\n\t\t.section {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 25px;\n\t\t\tmargin-bottom: 30px;\n\t\t\tbox-shadow: 0 4px 6px rgba(0,0,0,0.1);\n\t\t}\n\t\th2 { color: #667eea; margin-bottom: 20px; font-size: 22px; }\n\t\t.loading { text-align: center; padding: 40px; color: #999; }\n\t\t.error {\n\t\t\tbackground: #fee;\n\t\t\tborder: 2px solid #fcc;\n\t\t\tborder-radius: 8px;\n\t\t\tpadding: 15px;\n\t\t\tcolor: #c33;\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t\t.deck-grid {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n\t\t\tgap: 20px;\n\t\t}\n\t\t@media (max-width: 600px) {\n\t\t\t.deck-grid {\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n\t\t\t}\n\t\t}\n\t\t.deck-card {\n\t\t\tbackground: #f8f9fa;\n\t\t\tborder-radius: 10px;\n\t\t\tpadding: 15px;\n\t\t\tcursor: pointer;\n\t\t\tborder: 2px solid transparent;\n\t\t\ttransition: all 0.2s;\n\t\t}\n\t\t.deck-card:hover {\n\t\t\ttransform: translateY(-4px);\n\t\t\tbox-shadow: 0 6px 12px rgba(0,0,0,0.15);\n\t\t\tborder-color: #667eea;\n\t\t}\n\t\t.deck-image {\n\t\t\twidth: 100%;\n\t\t\theight: 200px;\n\t\t\tobject-fit: contain;\n\t\t\tborder-radius: 8px;\n\t\t\tmargin-bottom: 12px;\n\t\t\tbackground: white;\n\t\t}\n\t\t.deck-name { font-weight: 600; font-size: 16px; margin-bottom: 8px; }\n\t\t.deck-count { color: #667eea; font-size: 14px; font-weight: 600; }\n\t\t.tournament-list { display: flex; flex-direction: column; gap: 12px; }\n\t\t.tournament-item {\n\t\t\tbackground: #f8f9fa;\n\t\t\tpadding: 15px;\n\t\t\tborder-radius: 8px;\n\t\t\tborder-left: 4px solid #667eea;\n\t\t}\n\t\t.tournament-name { font-weight: 600; margin-bottom: 5px; }\n\t\t.tournament-meta { font-size: 13px; color: #666; }\n\t\t.modal {\n\t\t\tdisplay: none;\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tbackground: rgba(0,0,0,0.7);\n\t\t\tz-index: 1000;\n\t\t\tpadding: 20px;\n\t\t\toverflow-y: auto;\n\t\t}\n\t\t.modal.active {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t}\n\t\t.modal-content {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 30px;\n\t\t\tmax-width: 900px;\n\t\t\twidth: 100%;\n\t\t\tmax-height: 90vh;\n\t\t\toverflow-y: auto;\n\t\t\tposition: relative;\n\t\t}\n\t\t.close-modal {\n\t\t\tposition: absolute;\n\t\t\ttop: 15px;\n\t\t\tright: 15px;\n\t\t\tbackground: #f0f0f0;\n\t\t\tborder: none;\n\t\t\twidth: 32px;\n\t\t\theight: 32px;\n\t\t\tborder-radius: 50%;\n\t\t\tcursor: pointer;\n\t\t\tfont-size: 20px;\n\t\t}\n\t\t.close-modal:hover { background: #e0e0e0; }\n\t\t.card-section { margin-bottom: 25px; }\n\t\t.card-section h3 { color: #667eea; margin-bottom: 12px; font-size: 16px; text-transform: uppercase; }\n\t\t.card-list { display: flex; flex-direction: column; gap: 8px; }\n\t\t.card-item {\n\t\t\tbackground: #f8f9fa;\n\t\t\tpadding: 10px 15px;\n\t\t\tborder-radius: 6px;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t\tgap: 15px;\n\t\t}\n\t\t.card-image-thumb {\n\t\t\twidth: 50px;\n\t\t\theight: 70px;\n\t\t\tborder-radius: 4px;\n\t\t\tbackground: white;\n\t\t\tborder: 1px solid #ddd;\n\t\t\tflex-shrink: 0;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\toverflow: hidden;\n\t\t}\n\t\t.card-image-thumb img {\n\t\t\tmax-width: 100%;\n\t\t\tmax-height: 100%;\n\t\t\tobject-fit: contain;\n\t\t}\n\t\t.card-count {\n\t\t\tbackground: #667eea;\n\t\t\tcolor: white;\n\t\t\tpadding: 4px 10px;\n\t\t\tborder-radius: 12px;\n\t\t\tfont-size: 12px;\n\t\t\tfont-weight: 600;\n\t\t}\n\t\t.cache-badge {\n\t\t\tdisplay: inline-block;\n\t\t\tpadding: 4px 8px;\n\t\t\tborder-radius: 4px;\n\t\t\tfont-size: 11px;\n\t\t\tfont-weight: 600;\n\t\t\tmargin-left: 10px;\n\t\t}\n\t\t.cache-hit { background: #d4edda; color: #155724; }\n\t\t.cache-miss { background: #fff3cd; color: #856404; }\n\t</style>\n</head>\n<body>\n\t<div class=\"container\">\n\t\t<header>\n\t\t\t<h1>TCG Companion</h1>\n\t\t\t<p class=\"subtitle\">Multi-game meta tracker powered by Cloudflare Workers</p>\n\t\t</header>\n\n\t\t<div class=\"controls\">\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Game</label>\n\t\t\t\t<select id=\"game\" onchange=\"loadData()\">\n\t\t\t\t\t<option value=\"pokemon\" selected>Pok\u00E9mon TCG</option>\n\t\t\t\t\t<option value=\"magic\" disabled>Magic: The Gathering (Coming Soon)</option>\n\t\t\t\t\t<option value=\"riftbound\" disabled>Riftbound (Coming Soon)</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Days</label>\n\t\t\t\t<select id=\"days\">\n\t\t\t\t\t<option value=\"3\">Last 3 Days</option>\n\t\t\t\t\t<option value=\"7\" selected>Last 7 Days</option>\n\t\t\t\t\t<option value=\"14\">Last 14 Days</option>\n\t\t\t\t\t<option value=\"30\">Last 30 Days</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Format</label>\n\t\t\t\t<select id=\"format\">\n\t\t\t\t\t<option value=\"standard\" selected>Standard</option>\n\t\t\t\t\t<option value=\"expanded\">Expanded</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Limit</label>\n\t\t\t\t<input type=\"number\" id=\"limit\" value=\"10\" min=\"5\" max=\"20\">\n\t\t\t</div>\n\n\t\t\t<button id=\"refreshBtn\" onclick=\"loadData()\">Refresh Data</button>\n\t\t</div>\n\n\t\t<div id=\"errorContainer\"></div>\n\n\t\t<div class=\"section\">\n\t\t\t<h2>Top Meta Decks <span id=\"metaCacheBadge\"></span></h2>\n\t\t\t<div id=\"metaDecks\" class=\"loading\">Loading...</div>\n\t\t</div>\n\n\t\t<div class=\"section\">\n\t\t\t<h2>Recent Tournaments <span id=\"tournamentCacheBadge\"></span></h2>\n\t\t\t<div id=\"tournaments\" class=\"loading\">Loading...</div>\n\t\t</div>\n\t</div>\n\n\t<div id=\"deckModal\" class=\"modal\">\n\t\t<div class=\"modal-content\">\n\t\t\t<button class=\"close-modal\" onclick=\"closeModal()\">&times;</button>\n\t\t\t<div id=\"modalContent\"></div>\n\t\t</div>\n\t</div>\n\n\t<script>\n\t\tasync function loadData() {\n\t\t\tconst game = document.getElementById('game').value;\n\t\t\tconst days = document.getElementById('days').value;\n\t\t\tconst format = document.getElementById('format').value;\n\t\t\tconst limit = document.getElementById('limit').value;\n\t\t\tconst refreshBtn = document.getElementById('refreshBtn');\n\n\t\t\trefreshBtn.disabled = true;\n\t\t\tdocument.getElementById('errorContainer').innerHTML = '';\n\n\t\t\ttry {\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tloadMetaDecks(game, days, format, limit),\n\t\t\t\t\tloadTournaments(game, days, format)\n\t\t\t\t]);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error loading data:', error);\n\t\t\t\tshowError('Failed to load data: ' + error.message);\n\t\t\t} finally {\n\t\t\t\trefreshBtn.disabled = false;\n\t\t\t}\n\t\t}\n\n\t\tasync function loadMetaDecks(game, days, format, limit) {\n\t\t\tconst container = document.getElementById('metaDecks');\n\t\t\tcontainer.innerHTML = '<div class=\"loading\">Loading meta decks...</div>';\n\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\\`/v1/\\${game}/meta/top?days=\\${days}&format=\\${format}&limit=\\${limit}\\`);\n\n\t\t\t\tif (res.status === 501) {\n\t\t\t\t\tcontainer.innerHTML = '<div class=\"loading\">\uD83D\uDEA7 This game is not yet supported. Currently only Pok\u00E9mon TCG is available.</div>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n\n\t\t\t\tconst cacheStatus = res.headers.get('X-Cache');\n\t\t\t\tupdateCacheBadge('metaCacheBadge', cacheStatus);\n\n\t\t\t\tconst data = await res.json();\n\n\t\t\t\tif (data.decks.length === 0) {\n\t\t\t\t\tcontainer.innerHTML = '<p class=\"loading\">No decks found for this period.</p>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer.innerHTML = '';\n\t\t\t\tconst grid = document.createElement('div');\n\t\t\t\tgrid.className = 'deck-grid';\n\n\t\t\t\tdata.decks.forEach((deck, index) => {\n\t\t\t\t\tconst card = document.createElement('div');\n\t\t\t\t\tcard.className = 'deck-card';\n\t\t\t\t\tcard.onclick = () => showDeckDetails(game, deck.name, days, format);\n\n\t\t\t\t\tconst setColor = deck.setColor || '#808080';\n\t\t\t\t\tconst deckUrl = deck.deckUrl || '#';\n\t\t\t\t\tconst deckName = deck.name || 'Unknown';\n\t\t\t\t\tconst deckCount = deck.count || 0;\n\t\t\t\t\tconst setCode = deck.setCode || 'Unknown';\n\n\t\t\t\t\tlet imageHtml = '';\n\t\t\t\t\tif (deck.image) {\n\t\t\t\t\t\timageHtml = '<img src=\"' + deck.image + '\" alt=\"' + deckName + '\" style=\"height: 100%; width: auto; object-fit: contain;\" onerror=\"this.style.display=\\'none\\'\">';\n\t\t\t\t\t} else {\n\t\t\t\t\t\timageHtml = '<span style=\"color: white; font-size: 12px; font-weight: bold; text-transform: uppercase;\">' + setCode + '</span>';\n\t\t\t\t\t}\n\n\t\t\t\t\tcard.innerHTML = '<div class=\"deck-image\" style=\"background-color: ' + setColor + '; display: flex; align-items: center; justify-content: center; position: relative;\">' +\n\t\t\t\t\t\timageHtml +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'<div class=\"deck-name\">' + deckName + '</div>' +\n\t\t\t\t\t\t'<div class=\"deck-count\">' + deckCount + ' appearances</div>' +\n\t\t\t\t\t\t'<a href=\"' + deckUrl + '\" target=\"_blank\" style=\"display: inline-block; margin-top: 8px; padding: 4px 8px; background: #667eea; color: white; text-decoration: none; border-radius: 4px; font-size: 11px; font-weight: 600;\">View Deck</a>';\n\n\t\t\t\t\tgrid.appendChild(card);\n\t\t\t\t});\n\n\t\t\t\tcontainer.appendChild(grid);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('loadMetaDecks error:', error);\n\t\t\t\tcontainer.innerHTML = \\`<div class=\"error\">Failed to load meta decks: \\${error.message}</div>\\`;\n\t\t\t}\n\t\t}\n\n\t\tasync function loadTournaments(game, days, format) {\n\t\t\tconst container = document.getElementById('tournaments');\n\t\t\tcontainer.innerHTML = '<div class=\"loading\">Loading tournaments...</div>';\n\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\\`/v1/\\${game}/tournaments/recent?days=\\${days}&format=\\${format}&limit=50\\`);\n\n\t\t\t\tif (res.status === 501) {\n\t\t\t\t\tcontainer.innerHTML = '<div class=\"loading\">\uD83D\uDEA7 This game is not yet supported. Currently only Pok\u00E9mon TCG is available.</div>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n\n\t\t\t\tconst cacheStatus = res.headers.get('X-Cache');\n\t\t\t\tupdateCacheBadge('tournamentCacheBadge', cacheStatus);\n\n\t\t\t\tconst data = await res.json();\n\n\t\t\t\tif (data.tournaments.length === 0) {\n\t\t\t\t\tcontainer.innerHTML = '<p class=\"loading\">No tournaments found for this period.</p>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer.innerHTML = '';\n\t\t\t\tconst list = document.createElement('div');\n\t\t\t\tlist.className = 'tournament-list';\n\n\t\t\t\tdata.tournaments.slice(0, 10).forEach((tournament, index) => {\n\t\t\t\t\tconst item = document.createElement('div');\n\t\t\t\t\titem.className = 'tournament-item';\n\n\t\t\t\t\titem.innerHTML = \\`\n\t\t\t\t\t\t<div class=\"tournament-name\">\\${tournament.name}</div>\n\t\t\t\t\t\t<div class=\"tournament-meta\">\n\t\t\t\t\t\t\t\\${new Date(tournament.date).toLocaleDateString()}\n\t\t\t\t\t\t\t\u2022 \\${tournament.players || 'N/A'} players\n\t\t\t\t\t\t\t\u2022 \\${tournament.format}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\\`;\n\n\t\t\t\t\tlist.appendChild(item);\n\t\t\t\t});\n\n\t\t\t\tcontainer.appendChild(list);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('loadTournaments error:', error);\n\t\t\t\tcontainer.innerHTML = \\`<div class=\"error\">Failed to load tournaments: \\${error.message}</div>\\`;\n\t\t\t}\n\t\t}\n\n\t\tasync function showDeckDetails(game, deckName, days, format) {\n\t\t\tconst modal = document.getElementById('deckModal');\n\t\t\tconst content = document.getElementById('modalContent');\n\n\t\t\tmodal.classList.add('active');\n\t\t\tcontent.innerHTML = '<div class=\"loading\">Loading deck details...</div>';\n\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\\`/v1/\\${game}/meta/deck/\\${encodeURIComponent(deckName)}?days=\\${days}&format=\\${format}\\`);\n\n\t\t\t\tif (res.status === 501) {\n\t\t\t\t\tcontent.innerHTML = '<div class=\"loading\">\uD83D\uDEA7 Deck details not available for this game yet.</div>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tif (res.status === 404) {\n\t\t\t\t\t\tthrow new Error('Deck details not available');\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(\\`HTTP \\${res.status}\\`);\n\t\t\t\t}\n\n\t\t\t\tconst data = await res.json();\n\t\t\t\tconst deck = data.deck;\n\n\t\t\t\tif (!deck || !deck.name) {\n\t\t\t\t\tthrow new Error('Invalid deck data received');\n\t\t\t\t}\n\n\t\t\t\tconst setColor = deck.setColor || '#808080';\n\t\t\t\tconst deckName = deck.name || 'Unknown';\n\t\t\t\tconst deckAppearances = deck.appearances || 0;\n\t\t\t\tconst deckUrl = deck.deckUrl || '#';\n\t\t\t\tconst setCode = deck.setCode || 'Unknown';\n\n\t\t\t\tlet imageHtml = '';\n\t\t\t\tif (deck.image) {\n\t\t\t\t\timageHtml = '<img src=\"' + deck.image + '\" alt=\"' + deckName + '\" style=\"height: 100%; width: auto; object-fit: contain;\" onerror=\"this.style.display=\\'none\\'\">';\n\t\t\t\t} else {\n\t\t\t\t\timageHtml = '<span style=\"color: white; font-size: 18px; font-weight: bold; text-transform: uppercase;\">' + setCode + '</span>';\n\t\t\t\t}\n\n\t\t\t\tlet html = '<h2>' + deckName + '</h2>' +\n\t\t\t\t\t'<p style=\"color: #666; margin-bottom: 10px;\">' +\n\t\t\t\t\tdeckAppearances + ' appearances in last ' + days + ' days' +\n\t\t\t\t\t'</p>' +\n\t\t\t\t\t'<a href=\"' + deckUrl + '\" target=\"_blank\" style=\"display: inline-block; margin-bottom: 20px; padding: 8px 16px; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;\">\uD83D\uDCCB View Full Deck</a>' +\n\t\t\t\t\t'<div style=\"width: 200px; height: 200px; background-color: ' + setColor + '; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center;\">' +\n\t\t\t\t\timageHtml +\n\t\t\t\t\t'</div>';\n\n\t\t\t\tif (deck.topPlacements && deck.topPlacements.length > 0) {\n\t\t\t\t\thtml += '<div class=\"card-section\"><h3>Top Placements</h3><div class=\"card-list\">';\n\t\t\t\t\tdeck.topPlacements.slice(0, 5).forEach(placement => {\n\t\t\t\t\t\tconst placing = placement.placing || '?';\n\t\t\t\t\t\tconst player = placement.player || 'Unknown';\n\t\t\t\t\t\tconst tournament = placement.tournament || 'Unknown';\n\t\t\t\t\t\tconst record = placement.record || {wins: 0, losses: 0, ties: 0};\n\t\t\t\t\t\tconst date = placement.date ? new Date(placement.date).toLocaleDateString() : 'Unknown';\n\n\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<strong>#\\${placing}</strong> - \\${player} at \\${tournament}\n\t\t\t\t\t\t\t\t\t<div style=\"font-size: 12px; color: #666; margin-top: 4px;\">\n\t\t\t\t\t\t\t\t\t\t\\${record.wins}-\\${record.losses}-\\${record.ties}\n\t\t\t\t\t\t\t\t\t\t\u2022 \\${date}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\\`;\n\t\t\t\t\t});\n\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t}\n\n\t\t\t\tif (deck.cardList) {\n\t\t\t\t\tconst cardList = deck.cardList;\n\n\t\t\t\t\tif (cardList.pokemon && cardList.pokemon.length > 0) {\n\t\t\t\t\t\thtml += \\`<div class=\"card-section\"><h3>Pokemon (\\${cardList.pokemon.length})</h3><div class=\"card-list\">\\`;\n\t\t\t\t\t\tcardList.pokemon.forEach(card => {\n\t\t\t\t\t\t\tconst imageHtml = card.image\n\t\t\t\t\t\t\t\t? \\`<div class=\"card-image-thumb\"><img src=\"\\${card.image}\" alt=\"\\${card.name}\" onerror=\"this.style.display=\\'none\\'\" /></div>\\`\n\t\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t\t\\${imageHtml}\n\t\t\t\t\t\t\t\t\t<span>\\${card.name}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"card-count\">\\${card.count}x</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\\`;\n\t\t\t\t\t\t});\n\t\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (cardList.trainer && cardList.trainer.length > 0) {\n\t\t\t\t\t\thtml += \\`<div class=\"card-section\"><h3>Trainers (\\${cardList.trainer.length})</h3><div class=\"card-list\">\\`;\n\t\t\t\t\t\tcardList.trainer.forEach(card => {\n\t\t\t\t\t\t\tconst imageHtml = card.image\n\t\t\t\t\t\t\t\t? \\`<div class=\"card-image-thumb\"><img src=\"\\${card.image}\" alt=\"\\${card.name}\" onerror=\"this.style.display=\\'none\\'\" /></div>\\`\n\t\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t\t\\${imageHtml}\n\t\t\t\t\t\t\t\t\t<span>\\${card.name}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"card-count\">\\${card.count}x</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\\`;\n\t\t\t\t\t\t});\n\t\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (cardList.energy && cardList.energy.length > 0) {\n\t\t\t\t\t\thtml += \\`<div class=\"card-section\"><h3>Energy (\\${cardList.energy.length})</h3><div class=\"card-list\">\\`;\n\t\t\t\t\t\tcardList.energy.forEach(card => {\n\t\t\t\t\t\t\tconst imageHtml = card.image\n\t\t\t\t\t\t\t\t? \\`<div class=\"card-image-thumb\"><img src=\"\\${card.image}\" alt=\"\\${card.name}\" onerror=\"this.style.display=\\'none\\'\" /></div>\\`\n\t\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t\t\\${imageHtml}\n\t\t\t\t\t\t\t\t\t<span>\\${card.name}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"card-count\">\\${card.count}x</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\\`;\n\t\t\t\t\t\t});\n\t\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontent.innerHTML = html;\n\t\t\t} catch (error) {\n\t\t\t\tcontent.innerHTML = \\`<div class=\"error\">Failed to load deck details: \\${error.message}</div>\\`;\n\t\t\t}\n\t\t}\n\n\t\tfunction closeModal() {\n\t\t\tdocument.getElementById('deckModal').classList.remove('active');\n\t\t}\n\n\t\tfunction updateCacheBadge(badgeId, cacheStatus) {\n\t\t\tconst badge = document.getElementById(badgeId);\n\t\t\tif (cacheStatus === 'HIT') {\n\t\t\t\tbadge.innerHTML = '<span class=\"cache-badge cache-hit\">CACHED</span>';\n\t\t\t} else if (cacheStatus === 'MISS') {\n\t\t\t\tbadge.innerHTML = '<span class=\"cache-badge cache-miss\">FRESH</span>';\n\t\t\t}\n\t\t}\n\n\t\tfunction showError(message) {\n\t\t\tconst container = document.getElementById('errorContainer');\n\t\t\tcontainer.innerHTML = \\`<div class=\"error\">\\${message}</div>\\`;\n\t\t}\n\n\t\tloadData();\n\n\t\tdocument.getElementById('deckModal').addEventListener('click', (e) => {\n\t\t\tif (e.target.id === 'deckModal') {\n\t\t\t\tcloseModal();\n\t\t\t}\n\t\t});\n\t</script>\n</body>\n</html>`;\n}\n", "/**\n * Demo page endpoint\n */\n\nimport { htmlResponse } from '../core/response.js';\nimport { generateDemoHTML } from '../ui/demo.html.js';\n\n/**\n * GET / or /demo - Serve demo HTML page\n */\nexport async function handleDemo(request, env, ctx) {\n\treturn htmlResponse(generateDemoHTML(), {\n\t\tcacheControl: 'public, max-age=300',\n\t});\n}\n", "/**\n * Class that defines all the settings for the backend API endpoint.\n *\n * @param endpoint - The Firebase Auth backend endpoint.\n * @param httpMethod - The http method for that endpoint.\n * @constructor\n */\nexport class ApiSettings {\n    version;\n    endpoint;\n    httpMethod;\n    requestValidator;\n    responseValidator;\n    constructor(version, endpoint, httpMethod = 'POST') {\n        this.version = version;\n        this.endpoint = endpoint;\n        this.httpMethod = httpMethod;\n        this.setRequestValidator(null).setResponseValidator(null);\n    }\n    /** @returns The backend API resource version. */\n    getVersion() {\n        return this.version;\n    }\n    /** @returns The backend API endpoint. */\n    getEndpoint() {\n        return this.endpoint;\n    }\n    /** @returns The request HTTP method. */\n    getHttpMethod() {\n        return this.httpMethod;\n    }\n    /**\n     * @param requestValidator - The request validator.\n     * @returns The current API settings instance.\n     */\n    setRequestValidator(requestValidator) {\n        const nullFunction = () => undefined;\n        this.requestValidator = requestValidator || nullFunction;\n        return this;\n    }\n    /** @returns The request validator. */\n    getRequestValidator() {\n        return this.requestValidator;\n    }\n    /**\n     * @param responseValidator - The response validator.\n     * @returns The current API settings instance.\n     */\n    setResponseValidator(responseValidator) {\n        const nullFunction = () => undefined;\n        this.responseValidator = responseValidator || nullFunction;\n        return this;\n    }\n    /** @returns The response validator. */\n    getResponseValidator() {\n        return this.responseValidator;\n    }\n}\n", "export function emulatorHost(env) {\n    return env?.FIREBASE_AUTH_EMULATOR_HOST;\n}\n/**\n * When true the SDK should communicate with the Auth Emulator for all API\n * calls and also produce unsigned tokens.\n */\nexport const useEmulator = (env) => {\n    return !!emulatorHost(env);\n};\n", "/**\n * Jwt error code structure.\n *\n * @param code - The error code.\n * @param message - The error message.\n * @constructor\n */\nexport class JwtError extends Error {\n    code;\n    message;\n    constructor(code, message) {\n        super(message);\n        this.code = code;\n        this.message = message;\n        this.__proto__ = JwtError.prototype;\n    }\n}\n/**\n * JWT error codes.\n */\nexport var JwtErrorCode;\n(function (JwtErrorCode) {\n    JwtErrorCode[\"INVALID_ARGUMENT\"] = \"invalid-argument\";\n    JwtErrorCode[\"INVALID_CREDENTIAL\"] = \"invalid-credential\";\n    JwtErrorCode[\"TOKEN_EXPIRED\"] = \"token-expired\";\n    JwtErrorCode[\"INVALID_SIGNATURE\"] = \"invalid-token\";\n    JwtErrorCode[\"NO_MATCHING_KID\"] = \"no-matching-kid-error\";\n    JwtErrorCode[\"NO_KID_IN_HEADER\"] = \"no-kid-error\";\n    JwtErrorCode[\"KEY_FETCH_ERROR\"] = \"key-fetch-error\";\n})(JwtErrorCode || (JwtErrorCode = {}));\n/**\n * App client error codes and their default messages.\n */\nexport class AppErrorCodes {\n    static INVALID_CREDENTIAL = 'invalid-credential';\n    static INTERNAL_ERROR = 'internal-error';\n    static NETWORK_ERROR = 'network-error';\n    static NETWORK_TIMEOUT = 'network-timeout';\n    static UNABLE_TO_PARSE_RESPONSE = 'unable-to-parse-response';\n}\n/**\n * Auth client error codes and their default messages.\n */\nexport class AuthClientErrorCode {\n    static INVALID_ARGUMENT = {\n        code: 'argument-error',\n        message: 'Invalid argument provided.',\n    };\n    static INVALID_CREDENTIAL = {\n        code: 'invalid-credential',\n        message: 'Invalid credential object provided.',\n    };\n    static ID_TOKEN_EXPIRED = {\n        code: 'id-token-expired',\n        message: 'The provided Firebase ID token is expired.',\n    };\n    static INVALID_ID_TOKEN = {\n        code: 'invalid-id-token',\n        message: 'The provided ID token is not a valid Firebase ID token.',\n    };\n    static ID_TOKEN_REVOKED = {\n        code: 'id-token-revoked',\n        message: 'The Firebase ID token has been revoked.',\n    };\n    static INTERNAL_ERROR = {\n        code: 'internal-error',\n        message: 'An internal error has occurred.',\n    };\n    static USER_NOT_FOUND = {\n        code: 'user-not-found',\n        message: 'There is no user record corresponding to the provided identifier.',\n    };\n    static USER_DISABLED = {\n        code: 'user-disabled',\n        message: 'The user record is disabled.',\n    };\n    static SESSION_COOKIE_EXPIRED = {\n        code: 'session-cookie-expired',\n        message: 'The Firebase session cookie is expired.',\n    };\n    static SESSION_COOKIE_REVOKED = {\n        code: 'session-cookie-revoked',\n        message: 'The Firebase session cookie has been revoked.',\n    };\n    static INVALID_SESSION_COOKIE_DURATION = {\n        code: 'invalid-session-cookie-duration',\n        message: 'The session cookie duration must be a valid number in milliseconds ' + 'between 5 minutes and 2 weeks.',\n    };\n    static INVALID_UID = {\n        code: 'invalid-uid',\n        message: 'The uid must be a non-empty string with at most 128 characters.',\n    };\n    static INVALID_TOKENS_VALID_AFTER_TIME = {\n        code: 'invalid-tokens-valid-after-time',\n        message: 'The tokensValidAfterTime must be a valid UTC number in seconds.',\n    };\n    static FORBIDDEN_CLAIM = {\n        code: 'reserved-claim',\n        message: 'The specified developer claim is reserved and cannot be specified.',\n    };\n    static INVALID_CLAIMS = {\n        code: 'invalid-claims',\n        message: 'The provided custom claim attributes are invalid.',\n    };\n    static CLAIMS_TOO_LARGE = {\n        code: 'claims-too-large',\n        message: 'Developer claims maximum payload size exceeded.',\n    };\n}\n/**\n * Firebase error code structure. This extends Error.\n *\n * @param errorInfo - The error information (code and message).\n * @constructor\n */\nexport class FirebaseError extends Error {\n    errorInfo;\n    constructor(errorInfo) {\n        super(errorInfo.message);\n        this.errorInfo = errorInfo;\n        /* tslint:disable:max-line-length */\n        // Set the prototype explicitly. See the following link for more details:\n        // https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        /* tslint:enable:max-line-length */\n        this.__proto__ = FirebaseError.prototype;\n    }\n    /** @returns The error code. */\n    get code() {\n        return this.errorInfo.code;\n    }\n    /** @returns The error message. */\n    get message() {\n        return this.errorInfo.message;\n    }\n    /** @returns The object representation of the error. */\n    toJSON() {\n        return {\n            code: this.code,\n            message: this.message,\n        };\n    }\n}\n/**\n * A FirebaseError with a prefix in front of the error code.\n *\n * @param codePrefix - The prefix to apply to the error code.\n * @param code - The error code.\n * @param message - The error message.\n * @constructor\n */\nexport class PrefixedFirebaseError extends FirebaseError {\n    codePrefix;\n    constructor(codePrefix, code, message) {\n        super({\n            code: `${codePrefix}/${code}`,\n            message,\n        });\n        this.codePrefix = codePrefix;\n        /* tslint:disable:max-line-length */\n        // Set the prototype explicitly. See the following link for more details:\n        // https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        /* tslint:enable:max-line-length */\n        this.__proto__ = PrefixedFirebaseError.prototype;\n    }\n    /**\n     * Allows the error type to be checked without needing to know implementation details\n     * of the code prefixing.\n     *\n     * @param code - The non-prefixed error code to test against.\n     * @returns True if the code matches, false otherwise.\n     */\n    hasCode(code) {\n        return `${this.codePrefix}/${code}` === this.code;\n    }\n}\n/**\n * Firebase Auth error code structure. This extends PrefixedFirebaseError.\n *\n * @param info - The error code info.\n * @param [message] The error message. This will override the default\n *     message if provided.\n * @constructor\n */\nexport class FirebaseAuthError extends PrefixedFirebaseError {\n    constructor(info, message) {\n        // Override default message if custom message provided.\n        super('auth', info.code, message || info.message);\n        /* tslint:disable:max-line-length */\n        // Set the prototype explicitly. See the following link for more details:\n        // https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        /* tslint:enable:max-line-length */\n        this.__proto__ = FirebaseAuthError.prototype;\n    }\n    /**\n     * Creates the developer-facing error corresponding to the backend error code.\n     *\n     * @param serverErrorCode - The server error code.\n     * @param [message] The error message. The default message is used\n     *     if not provided.\n     * @param [rawServerResponse] The error's raw server response.\n     * @returns The corresponding developer-facing error.\n     */\n    static fromServerError(serverErrorCode, rawServerResponse) {\n        // serverErrorCode could contain additional details:\n        // ERROR_CODE : Detailed message which can also contain colons\n        const colonSeparator = (serverErrorCode || '').indexOf(':');\n        if (colonSeparator !== -1) {\n            serverErrorCode = serverErrorCode.substring(0, colonSeparator).trim();\n        }\n        // If not found, default to internal error.\n        const clientCodeKey = AUTH_SERVER_TO_CLIENT_CODE[serverErrorCode] || 'INTERNAL_ERROR';\n        const error = {\n            ...AuthClientErrorCode.INTERNAL_ERROR,\n            ...AuthClientErrorCode[clientCodeKey],\n        };\n        if (clientCodeKey === 'INTERNAL_ERROR' && typeof rawServerResponse !== 'undefined') {\n            try {\n                error.message += ` Raw server response: \"${JSON.stringify(rawServerResponse)}\"`;\n            }\n            catch (e) {\n                // Ignore JSON parsing error.\n            }\n        }\n        return new FirebaseAuthError(error);\n    }\n}\n/**\n * Firebase App error code structure. This extends PrefixedFirebaseError.\n *\n * @param code - The error code.\n * @param message - The error message.\n * @constructor\n */\nexport class FirebaseAppError extends PrefixedFirebaseError {\n    constructor(code, message) {\n        super('app', code, message);\n        /* tslint:disable:max-line-length */\n        // Set the prototype explicitly. See the following link for more details:\n        // https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        /* tslint:enable:max-line-length */\n        this.__proto__ = FirebaseAppError.prototype;\n    }\n}\n/** @const {ServerToClientCode} Auth server to client enum error codes. */\nconst AUTH_SERVER_TO_CLIENT_CODE = {\n    // Feature being configured or used requires a billing account.\n    BILLING_NOT_ENABLED: 'BILLING_NOT_ENABLED',\n    // Claims payload is too large.\n    CLAIMS_TOO_LARGE: 'CLAIMS_TOO_LARGE',\n    // Configuration being added already exists.\n    CONFIGURATION_EXISTS: 'CONFIGURATION_EXISTS',\n    // Configuration not found.\n    CONFIGURATION_NOT_FOUND: 'CONFIGURATION_NOT_FOUND',\n    // Provided credential has insufficient permissions.\n    INSUFFICIENT_PERMISSION: 'INSUFFICIENT_PERMISSION',\n    // Provided configuration has invalid fields.\n    INVALID_CONFIG: 'INVALID_CONFIG',\n    // Provided configuration identifier is invalid.\n    INVALID_CONFIG_ID: 'INVALID_PROVIDER_ID',\n    // ActionCodeSettings missing continue URL.\n    INVALID_CONTINUE_URI: 'INVALID_CONTINUE_URI',\n    // Dynamic link domain in provided ActionCodeSettings is not authorized.\n    INVALID_DYNAMIC_LINK_DOMAIN: 'INVALID_DYNAMIC_LINK_DOMAIN',\n    // uploadAccount provides an email that already exists.\n    DUPLICATE_EMAIL: 'EMAIL_ALREADY_EXISTS',\n    // uploadAccount provides a localId that already exists.\n    DUPLICATE_LOCAL_ID: 'UID_ALREADY_EXISTS',\n    // Request specified a multi-factor enrollment ID that already exists.\n    DUPLICATE_MFA_ENROLLMENT_ID: 'SECOND_FACTOR_UID_ALREADY_EXISTS',\n    // setAccountInfo email already exists.\n    EMAIL_EXISTS: 'EMAIL_ALREADY_EXISTS',\n    // /accounts:sendOobCode for password reset when user is not found.\n    EMAIL_NOT_FOUND: 'EMAIL_NOT_FOUND',\n    // Reserved claim name.\n    FORBIDDEN_CLAIM: 'FORBIDDEN_CLAIM',\n    // Invalid claims provided.\n    INVALID_CLAIMS: 'INVALID_CLAIMS',\n    // Invalid session cookie duration.\n    INVALID_DURATION: 'INVALID_SESSION_COOKIE_DURATION',\n    // Invalid email provided.\n    INVALID_EMAIL: 'INVALID_EMAIL',\n    // Invalid new email provided.\n    INVALID_NEW_EMAIL: 'INVALID_NEW_EMAIL',\n    // Invalid tenant display name. This can be thrown on CreateTenant and UpdateTenant.\n    INVALID_DISPLAY_NAME: 'INVALID_DISPLAY_NAME',\n    // Invalid ID token provided.\n    INVALID_ID_TOKEN: 'INVALID_ID_TOKEN',\n    // Invalid tenant/parent resource name.\n    INVALID_NAME: 'INVALID_NAME',\n    // OIDC configuration has an invalid OAuth client ID.\n    INVALID_OAUTH_CLIENT_ID: 'INVALID_OAUTH_CLIENT_ID',\n    // Invalid page token.\n    INVALID_PAGE_SELECTION: 'INVALID_PAGE_TOKEN',\n    // Invalid phone number.\n    INVALID_PHONE_NUMBER: 'INVALID_PHONE_NUMBER',\n    // Invalid agent project. Either agent project doesn't exist or didn't enable multi-tenancy.\n    INVALID_PROJECT_ID: 'INVALID_PROJECT_ID',\n    // Invalid provider ID.\n    INVALID_PROVIDER_ID: 'INVALID_PROVIDER_ID',\n    // Invalid service account.\n    INVALID_SERVICE_ACCOUNT: 'INVALID_SERVICE_ACCOUNT',\n    // Invalid testing phone number.\n    INVALID_TESTING_PHONE_NUMBER: 'INVALID_TESTING_PHONE_NUMBER',\n    // Invalid tenant type.\n    INVALID_TENANT_TYPE: 'INVALID_TENANT_TYPE',\n    // Missing Android package name.\n    MISSING_ANDROID_PACKAGE_NAME: 'MISSING_ANDROID_PACKAGE_NAME',\n    // Missing configuration.\n    MISSING_CONFIG: 'MISSING_CONFIG',\n    // Missing configuration identifier.\n    MISSING_CONFIG_ID: 'MISSING_PROVIDER_ID',\n    // Missing tenant display name: This can be thrown on CreateTenant and UpdateTenant.\n    MISSING_DISPLAY_NAME: 'MISSING_DISPLAY_NAME',\n    // Email is required for the specified action. For example a multi-factor user requires\n    // a verified email.\n    MISSING_EMAIL: 'MISSING_EMAIL',\n    // Missing iOS bundle ID.\n    MISSING_IOS_BUNDLE_ID: 'MISSING_IOS_BUNDLE_ID',\n    // Missing OIDC issuer.\n    MISSING_ISSUER: 'MISSING_ISSUER',\n    // No localId provided (deleteAccount missing localId).\n    MISSING_LOCAL_ID: 'MISSING_UID',\n    // OIDC configuration is missing an OAuth client ID.\n    MISSING_OAUTH_CLIENT_ID: 'MISSING_OAUTH_CLIENT_ID',\n    // Missing provider ID.\n    MISSING_PROVIDER_ID: 'MISSING_PROVIDER_ID',\n    // Missing SAML RP config.\n    MISSING_SAML_RELYING_PARTY_CONFIG: 'MISSING_SAML_RELYING_PARTY_CONFIG',\n    // Empty user list in uploadAccount.\n    MISSING_USER_ACCOUNT: 'MISSING_UID',\n    // Password auth disabled in console.\n    OPERATION_NOT_ALLOWED: 'OPERATION_NOT_ALLOWED',\n    // Provided credential has insufficient permissions.\n    PERMISSION_DENIED: 'INSUFFICIENT_PERMISSION',\n    // Phone number already exists.\n    PHONE_NUMBER_EXISTS: 'PHONE_NUMBER_ALREADY_EXISTS',\n    // Project not found.\n    PROJECT_NOT_FOUND: 'PROJECT_NOT_FOUND',\n    // In multi-tenancy context: project creation quota exceeded.\n    QUOTA_EXCEEDED: 'QUOTA_EXCEEDED',\n    // Currently only 5 second factors can be set on the same user.\n    SECOND_FACTOR_LIMIT_EXCEEDED: 'SECOND_FACTOR_LIMIT_EXCEEDED',\n    // Tenant not found.\n    TENANT_NOT_FOUND: 'TENANT_NOT_FOUND',\n    // Tenant ID mismatch.\n    TENANT_ID_MISMATCH: 'MISMATCHING_TENANT_ID',\n    // Token expired error.\n    TOKEN_EXPIRED: 'ID_TOKEN_EXPIRED',\n    // Continue URL provided in ActionCodeSettings has a domain that is not whitelisted.\n    UNAUTHORIZED_DOMAIN: 'UNAUTHORIZED_DOMAIN',\n    // A multi-factor user requires a supported first factor.\n    UNSUPPORTED_FIRST_FACTOR: 'UNSUPPORTED_FIRST_FACTOR',\n    // The request specified an unsupported type of second factor.\n    UNSUPPORTED_SECOND_FACTOR: 'UNSUPPORTED_SECOND_FACTOR',\n    // Operation is not supported in a multi-tenant context.\n    UNSUPPORTED_TENANT_OPERATION: 'UNSUPPORTED_TENANT_OPERATION',\n    // A verified email is required for the specified action. For example a multi-factor user\n    // requires a verified email.\n    UNVERIFIED_EMAIL: 'UNVERIFIED_EMAIL',\n    // User on which action is to be performed is not found.\n    USER_NOT_FOUND: 'USER_NOT_FOUND',\n    // User record is disabled.\n    USER_DISABLED: 'USER_DISABLED',\n    // Password provided is too weak.\n    WEAK_PASSWORD: 'INVALID_PASSWORD',\n    // Unrecognized reCAPTCHA action.\n    INVALID_RECAPTCHA_ACTION: 'INVALID_RECAPTCHA_ACTION',\n    // Unrecognized reCAPTCHA enforcement state.\n    INVALID_RECAPTCHA_ENFORCEMENT_STATE: 'INVALID_RECAPTCHA_ENFORCEMENT_STATE',\n    // reCAPTCHA is not enabled for account defender.\n    RECAPTCHA_NOT_ENABLED: 'RECAPTCHA_NOT_ENABLED',\n};\n", "/**\n * Validates that a string is a valid web URL.\n *\n * @param urlStr - The string to validate.\n * @returns Whether the string is valid web URL or not.\n */\nexport function isURL(urlStr) {\n    if (typeof urlStr !== 'string') {\n        return false;\n    }\n    // Lookup illegal characters.\n    const re = /[^a-z0-9:/?#[\\]@!$&'()*+,;=.\\-_~%]/i;\n    if (re.test(urlStr)) {\n        return false;\n    }\n    try {\n        const uri = new URL(urlStr);\n        const scheme = uri.protocol;\n        const hostname = uri.hostname;\n        const pathname = uri.pathname;\n        if (scheme !== 'http:' && scheme !== 'https:') {\n            return false;\n        }\n        // Validate hostname: Can contain letters, numbers, underscore and dashes separated by a dot.\n        // Each zone must not start with a hyphen or underscore.\n        if (!hostname || !/^[a-zA-Z0-9]+[\\w-]*([.]?[a-zA-Z0-9]+[\\w-]*)*$/.test(hostname)) {\n            return false;\n        }\n        // Allow for pathnames: (/chars+)*/?\n        // Where chars can be a combination of: a-z A-Z 0-9 - _ . ~ ! $ & ' ( ) * + , ; = : @ %\n        const pathnameRe = /^(\\/[\\w\\-.~!$'()*+,;=:@%]+)*\\/?$/;\n        // Validate pathname.\n        if (pathname && pathname !== '/' && !pathnameRe.test(pathname)) {\n            return false;\n        }\n        // Allow any query string and hash as long as no invalid character is used.\n    }\n    catch (e) {\n        return false;\n    }\n    return true;\n}\n/**\n * Validates that a value is a number.\n *\n * @param value - The value to validate.\n * @returns Whether the value is a number or not.\n */\nexport function isNumber(value) {\n    return typeof value === 'number';\n}\n/**\n * Validates that a value is a string.\n *\n * @param value - The value to validate.\n * @returns Whether the value is a string or not.\n */\nexport function isString(value) {\n    return typeof value === 'string';\n}\n/**\n * Validates that a value is a non-empty string.\n *\n * @param value - The value to validate.\n * @returns Whether the value is a non-empty string or not.\n */\nexport function isNonEmptyString(value) {\n    return isString(value) && value !== '';\n}\n/**\n   *\n/**\n * Validates that a value is a nullable object.\n *\n * @param value - The value to validate.\n * @returns Whether the value is an object or not.\n */\nexport function isObject(value) {\n    return typeof value === 'object' && !Array.isArray(value);\n}\n/**\n * Validates that a value is a non-null object.\n *\n * @param value - The value to validate.\n * @returns Whether the value is a non-null object or not.\n */\nexport function isNonNullObject(value) {\n    return isObject(value) && value !== null;\n}\n/**\n * Validates that a string is a valid Firebase Auth uid.\n *\n * @param uid - The string to validate.\n * @returns Whether the string is a valid Firebase Auth uid.\n */\nexport function isUid(uid) {\n    return typeof uid === 'string' && uid.length > 0 && uid.length <= 128;\n}\n", "export const version = '2.0.6';\n", "import { useEmulator } from './emulator';\nimport { AppErrorCodes, FirebaseAppError, FirebaseAuthError } from './errors';\nimport { isNonNullObject } from './validator';\nimport { version } from './version';\n/**\n * Default retry configuration for HTTP requests. Retries up to 4 times on connection reset and timeout errors\n * as well as HTTP 503 errors. Exposed as a function to ensure that every HttpClient gets its own RetryConfig\n * instance.\n */\nexport function defaultRetryConfig() {\n    return {\n        maxRetries: 4,\n        statusCodes: [503],\n        ioErrorCodes: ['ECONNRESET', 'ETIMEDOUT'],\n        backOffFactor: 0.5,\n        maxDelayInMillis: 60 * 1000,\n    };\n}\nexport function buildApiUrl(projectId, apiSettings, env) {\n    const defaultAuthURL = 'https://identitytoolkit.googleapis.com';\n    const baseUrl = env?.FIREBASE_AUTH_EMULATOR_HOST\n        ? `http://${env.FIREBASE_AUTH_EMULATOR_HOST}/identitytoolkit.googleapis.com`\n        : defaultAuthURL;\n    const endpoint = apiSettings.getEndpoint();\n    return `${baseUrl}/${apiSettings.getVersion()}/projects/${projectId}${endpoint}`;\n}\nexport class BaseClient {\n    projectId;\n    credential;\n    retryConfig;\n    constructor(projectId, credential, retryConfig = defaultRetryConfig()) {\n        this.projectId = projectId;\n        this.credential = credential;\n        this.retryConfig = retryConfig;\n    }\n    async getToken(env) {\n        if (useEmulator(env)) {\n            return 'owner';\n        }\n        const result = await this.credential.getAccessToken();\n        return result.access_token;\n    }\n    async fetch(apiSettings, requestData, env) {\n        const fullUrl = buildApiUrl(this.projectId, apiSettings, env);\n        if (requestData) {\n            const requestValidator = apiSettings.getRequestValidator();\n            requestValidator(requestData);\n        }\n        const token = await this.getToken(env);\n        const method = apiSettings.getHttpMethod();\n        const signal = AbortSignal.timeout(25000); // 25s\n        return await this.fetchWithRetry(fullUrl, {\n            method,\n            headers: {\n                Authorization: `Bearer ${token}`,\n                'User-Agent': `Code-Hex/firebase-auth-cloudflare-workers/${version}`,\n                'X-Client-Version': `Code-Hex/firebase-auth-cloudflare-workers/${version}`,\n                'Content-Type': 'application/json;charset=utf-8',\n            },\n            body: requestData ? JSON.stringify(requestData) : undefined,\n            signal,\n        });\n    }\n    async fetchWithRetry(url, init, retryAttempts = 0) {\n        try {\n            const res = await fetch(url, init);\n            const text = await res.text();\n            if (!res.ok) {\n                throw new HttpError(res.status, text);\n            }\n            try {\n                return JSON.parse(text);\n            }\n            catch (err) {\n                throw new HttpError(res.status, text, {\n                    cause: new FirebaseAppError(AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, `Error while parsing response data: \"${String(err)}\". Raw server ` +\n                        `response: \"${text}\". Status code: \"${res.status}\". Outgoing ` +\n                        `request: \"${init.method} ${url}.\"`),\n                });\n            }\n        }\n        catch (err) {\n            const canRetry = this.isRetryEligible(retryAttempts, err);\n            const delayMillis = this.backOffDelayMillis(retryAttempts);\n            if (canRetry && delayMillis <= this.retryConfig.maxDelayInMillis) {\n                await this.waitForRetry(delayMillis);\n                return await this.fetchWithRetry(url, init, retryAttempts + 1);\n            }\n            if (err instanceof HttpError) {\n                if (err.cause) {\n                    throw err.cause;\n                }\n                try {\n                    const json = JSON.parse(err.message);\n                    const errorCode = this.getErrorCode(json);\n                    if (errorCode) {\n                        throw FirebaseAuthError.fromServerError(errorCode, json);\n                    }\n                }\n                catch (err) {\n                    if (err instanceof FirebaseAuthError) {\n                        throw err;\n                    }\n                }\n                throw new FirebaseAppError(AppErrorCodes.INTERNAL_ERROR, `Error while sending request or reading response: \"${err}\". Raw server ` +\n                    `response: Status code: \"${err.status}\". Outgoing ` +\n                    `request: \"${init.method} ${url}.\"`);\n            }\n            throw new FirebaseAppError(AppErrorCodes.NETWORK_ERROR, `Error while making request: ${String(err)}`);\n        }\n    }\n    /**\n     * @param response - The response to check for errors.\n     * @returns The error code if present; null otherwise.\n     */\n    getErrorCode(response) {\n        return (isNonNullObject(response) && response.error && response.error.message) || null;\n    }\n    waitForRetry(delayMillis) {\n        if (delayMillis > 0) {\n            return new Promise(resolve => {\n                setTimeout(resolve, delayMillis);\n            });\n        }\n        return Promise.resolve();\n    }\n    isRetryEligible(retryAttempts, err) {\n        if (retryAttempts >= this.retryConfig.maxRetries) {\n            return false;\n        }\n        if (err instanceof HttpError) {\n            const statusCodes = this.retryConfig.statusCodes || [];\n            return statusCodes.includes(err.status);\n        }\n        if (err instanceof Error && err.name === 'AbortError') {\n            return false;\n        }\n        return true;\n    }\n    backOffDelayMillis(retryAttempts) {\n        if (retryAttempts === 0) {\n            return 0;\n        }\n        const backOffFactor = this.retryConfig.backOffFactor || 0;\n        const delayInSeconds = 2 ** retryAttempts * backOffFactor;\n        return Math.min(delayInSeconds * 1000, this.retryConfig.maxDelayInMillis);\n    }\n}\nclass HttpError extends Error {\n    status;\n    constructor(status, message, opts) {\n        super(message, opts);\n        this.status = status;\n        this.name = 'HttpError';\n    }\n}\n", "import { AuthClientErrorCode, FirebaseAuthError } from './errors';\nimport { isNonNullObject } from './validator';\n/**\n * 'REDACTED', encoded as a base64 string.\n */\nconst B64_REDACTED = 'UkVEQUNURUQ='; // Buffer.from('REDACTED').toString('base64');\n/**\n * Parses a time stamp string or number and returns the corresponding date if valid.\n *\n * @param time - The unix timestamp string or number in milliseconds.\n * @returns The corresponding date as a UTC string, if valid. Otherwise, null.\n */\nfunction parseDate(time) {\n    try {\n        const date = new Date(parseInt(time, 10));\n        if (!isNaN(date.getTime())) {\n            return date.toUTCString();\n        }\n    }\n    catch (e) {\n        // Do nothing. null will be returned.\n    }\n    return null;\n}\nvar MultiFactorId;\n(function (MultiFactorId) {\n    MultiFactorId[\"Phone\"] = \"phone\";\n    MultiFactorId[\"Totp\"] = \"totp\";\n})(MultiFactorId || (MultiFactorId = {}));\n/**\n * Interface representing the common properties of a user-enrolled second factor.\n */\nexport class MultiFactorInfo {\n    /**\n     * The ID of the enrolled second factor. This ID is unique to the user.\n     */\n    uid;\n    /**\n     * The optional display name of the enrolled second factor.\n     */\n    displayName;\n    /**\n     * The type identifier of the second factor.\n     * For SMS second factors, this is `phone`.\n     * For TOTP second factors, this is `totp`.\n     */\n    factorId;\n    /**\n     * The optional date the second factor was enrolled, formatted as a UTC string.\n     */\n    enrollmentTime;\n    /**\n     * Initializes the MultiFactorInfo associated subclass using the server side.\n     * If no MultiFactorInfo is associated with the response, null is returned.\n     *\n     * @param response - The server side response.\n     * @internal\n     */\n    static initMultiFactorInfo(response) {\n        let multiFactorInfo = null;\n        // PhoneMultiFactorInfo, TotpMultiFactorInfo currently available.\n        try {\n            if (response.phoneInfo !== undefined) {\n                multiFactorInfo = new PhoneMultiFactorInfo(response);\n            }\n            else if (response.totpInfo !== undefined) {\n                multiFactorInfo = new TotpMultiFactorInfo(response);\n            }\n            else {\n                // Ignore the other SDK unsupported MFA factors to prevent blocking developers using the current SDK.\n            }\n        }\n        catch (e) {\n            // Ignore error.\n        }\n        return multiFactorInfo;\n    }\n    /**\n     * Initializes the MultiFactorInfo object using the server side response.\n     *\n     * @param response - The server side response.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        this.initFromServerResponse(response);\n    }\n    /**\n     * Returns a JSON-serializable representation of this object.\n     *\n     * @returns A JSON-serializable representation of this object.\n     */\n    toJSON() {\n        return {\n            uid: this.uid,\n            displayName: this.displayName,\n            factorId: this.factorId,\n            enrollmentTime: this.enrollmentTime,\n        };\n    }\n    /**\n     * Initializes the MultiFactorInfo object using the provided server response.\n     *\n     * @param response - The server side response.\n     */\n    initFromServerResponse(response) {\n        const factorId = response && this.getFactorId(response);\n        if (!factorId || !response || !response.mfaEnrollmentId) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Invalid multi-factor info response');\n        }\n        addReadonlyGetter(this, 'uid', response.mfaEnrollmentId);\n        addReadonlyGetter(this, 'factorId', factorId);\n        addReadonlyGetter(this, 'displayName', response.displayName);\n        // Encoded using [RFC 3339](https://www.ietf.org/rfc/rfc3339.txt) format.\n        // For example, \"2017-01-15T01:30:15.01Z\".\n        // This can be parsed directly via Date constructor.\n        // This can be computed using Data.prototype.toISOString.\n        if (response.enrolledAt) {\n            addReadonlyGetter(this, 'enrollmentTime', new Date(response.enrolledAt).toUTCString());\n        }\n        else {\n            addReadonlyGetter(this, 'enrollmentTime', null);\n        }\n    }\n}\n/**\n * Interface representing a phone specific user-enrolled second factor.\n */\nexport class PhoneMultiFactorInfo extends MultiFactorInfo {\n    /**\n     * The phone number associated with a phone second factor.\n     */\n    phoneNumber;\n    /**\n     * Initializes the PhoneMultiFactorInfo object using the server side response.\n     *\n     * @param response - The server side response.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        super(response);\n        addReadonlyGetter(this, 'phoneNumber', response.phoneInfo);\n    }\n    /**\n     * {@inheritdoc MultiFactorInfo.toJSON}\n     */\n    toJSON() {\n        return Object.assign(super.toJSON(), {\n            phoneNumber: this.phoneNumber,\n        });\n    }\n    /**\n     * Returns the factor ID based on the response provided.\n     *\n     * @param response - The server side response.\n     * @returns The multi-factor ID associated with the provided response. If the response is\n     *     not associated with any known multi-factor ID, null is returned.\n     *\n     * @internal\n     */\n    getFactorId(response) {\n        return response && response.phoneInfo ? MultiFactorId.Phone : null;\n    }\n}\n/**\n * `TotpInfo` struct associated with a second factor\n */\nexport class TotpInfo {\n}\n/**\n * Interface representing a TOTP specific user-enrolled second factor.\n */\nexport class TotpMultiFactorInfo extends MultiFactorInfo {\n    /**\n     * `TotpInfo` struct associated with a second factor\n     */\n    totpInfo;\n    /**\n     * Initializes the `TotpMultiFactorInfo` object using the server side response.\n     *\n     * @param response - The server side response.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        super(response);\n        addReadonlyGetter(this, 'totpInfo', response.totpInfo);\n    }\n    /**\n     * {@inheritdoc MultiFactorInfo.toJSON}\n     */\n    toJSON() {\n        return Object.assign(super.toJSON(), {\n            totpInfo: this.totpInfo,\n        });\n    }\n    /**\n     * Returns the factor ID based on the response provided.\n     *\n     * @param response - The server side response.\n     * @returns The multi-factor ID associated with the provided response. If the response is\n     *     not associated with any known multi-factor ID, `null` is returned.\n     *\n     * @internal\n     */\n    getFactorId(response) {\n        return response && response.totpInfo ? MultiFactorId.Totp : null;\n    }\n}\n/**\n * The multi-factor related user settings.\n */\nexport class MultiFactorSettings {\n    /**\n     * List of second factors enrolled with the current user.\n     * Currently only phone and TOTP second factors are supported.\n     */\n    enrolledFactors;\n    /**\n     * Initializes the `MultiFactor` object using the server side or JWT format response.\n     *\n     * @param response - The server side response.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        const parsedEnrolledFactors = [];\n        if (!isNonNullObject(response)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Invalid multi-factor response');\n        }\n        else if (response.mfaInfo) {\n            response.mfaInfo.forEach(factorResponse => {\n                const multiFactorInfo = MultiFactorInfo.initMultiFactorInfo(factorResponse);\n                if (multiFactorInfo) {\n                    parsedEnrolledFactors.push(multiFactorInfo);\n                }\n            });\n        }\n        // Make enrolled factors immutable.\n        addReadonlyGetter(this, 'enrolledFactors', Object.freeze(parsedEnrolledFactors));\n    }\n    /**\n     * Returns a JSON-serializable representation of this multi-factor object.\n     *\n     * @returns A JSON-serializable representation of this multi-factor object.\n     */\n    toJSON() {\n        return {\n            enrolledFactors: this.enrolledFactors.map(info => info.toJSON()),\n        };\n    }\n}\n/**\n * Represents a user's metadata.\n */\nexport class UserMetadata {\n    /**\n     * The date the user was created, formatted as a UTC string.\n     */\n    creationTime;\n    /**\n     * The date the user last signed in, formatted as a UTC string.\n     */\n    lastSignInTime;\n    /**\n     * The time at which the user was last active (ID token refreshed),\n     * formatted as a UTC Date string (eg 'Sat, 03 Feb 2001 04:05:06 GMT').\n     * Returns null if the user was never active.\n     */\n    lastRefreshTime;\n    /**\n     * @param response - The server side response returned from the `getAccountInfo`\n     *     endpoint.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        // Creation date should always be available but due to some backend bugs there\n        // were cases in the past where users did not have creation date properly set.\n        // This included legacy Firebase migrating project users and some anonymous users.\n        // These bugs have already been addressed since then.\n        addReadonlyGetter(this, 'creationTime', parseDate(response.createdAt));\n        addReadonlyGetter(this, 'lastSignInTime', parseDate(response.lastLoginAt));\n        const lastRefreshAt = response.lastRefreshAt ? new Date(response.lastRefreshAt).toUTCString() : null;\n        addReadonlyGetter(this, 'lastRefreshTime', lastRefreshAt);\n    }\n    /**\n     * Returns a JSON-serializable representation of this object.\n     *\n     * @returns A JSON-serializable representation of this object.\n     */\n    toJSON() {\n        return {\n            lastSignInTime: this.lastSignInTime,\n            creationTime: this.creationTime,\n            lastRefreshTime: this.lastRefreshTime,\n        };\n    }\n}\n/**\n * Represents a user's info from a third-party identity provider\n * such as Google or Facebook.\n */\nexport class UserInfo {\n    /**\n     * The user identifier for the linked provider.\n     */\n    uid;\n    /**\n     * The display name for the linked provider.\n     */\n    displayName;\n    /**\n     * The email for the linked provider.\n     */\n    email;\n    /**\n     * The photo URL for the linked provider.\n     */\n    photoURL;\n    /**\n     * The linked provider ID (for example, \"google.com\" for the Google provider).\n     */\n    providerId;\n    /**\n     * The phone number for the linked provider.\n     */\n    phoneNumber;\n    /**\n     * @param response - The server side response returned from the `getAccountInfo`\n     *     endpoint.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        // Provider user id and provider id are required.\n        if (!response.rawId || !response.providerId) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Invalid user info response');\n        }\n        addReadonlyGetter(this, 'uid', response.rawId);\n        addReadonlyGetter(this, 'displayName', response.displayName);\n        addReadonlyGetter(this, 'email', response.email);\n        addReadonlyGetter(this, 'photoURL', response.photoUrl);\n        addReadonlyGetter(this, 'providerId', response.providerId);\n        addReadonlyGetter(this, 'phoneNumber', response.phoneNumber);\n    }\n    /**\n     * Returns a JSON-serializable representation of this object.\n     *\n     * @returns A JSON-serializable representation of this object.\n     */\n    toJSON() {\n        return {\n            uid: this.uid,\n            displayName: this.displayName,\n            email: this.email,\n            photoURL: this.photoURL,\n            providerId: this.providerId,\n            phoneNumber: this.phoneNumber,\n        };\n    }\n}\n/**\n * Represents a user.\n */\nexport class UserRecord {\n    /**\n     * The user's `uid`.\n     */\n    uid;\n    /**\n     * The user's primary email, if set.\n     */\n    email;\n    /**\n     * Whether or not the user's primary email is verified.\n     */\n    emailVerified;\n    /**\n     * The user's display name.\n     */\n    displayName;\n    /**\n     * The user's photo URL.\n     */\n    photoURL;\n    /**\n     * The user's primary phone number, if set.\n     */\n    phoneNumber;\n    /**\n     * Whether or not the user is disabled: `true` for disabled; `false` for\n     * enabled.\n     */\n    disabled;\n    /**\n     * Additional metadata about the user.\n     */\n    metadata;\n    /**\n     * An array of providers (for example, Google, Facebook) linked to the user.\n     */\n    providerData;\n    /**\n     * The user's hashed password (base64-encoded), only if Firebase Auth hashing\n     * algorithm (SCRYPT) is used. If a different hashing algorithm had been used\n     * when uploading this user, as is typical when migrating from another Auth\n     * system, this will be an empty string. If no password is set, this is\n     * null. This is only available when the user is obtained from\n     * {@link BaseAuth.listUsers}.\n     */\n    passwordHash;\n    /**\n     * The user's password salt (base64-encoded), only if Firebase Auth hashing\n     * algorithm (SCRYPT) is used. If a different hashing algorithm had been used to\n     * upload this user, typical when migrating from another Auth system, this will\n     * be an empty string. If no password is set, this is null. This is only\n     * available when the user is obtained from {@link BaseAuth.listUsers}.\n     */\n    passwordSalt;\n    /**\n     * The user's custom claims object if available, typically used to define\n     * user roles and propagated to an authenticated user's ID token.\n     * This is set via {@link BaseAuth.setCustomUserClaims}\n     */\n    customClaims;\n    /**\n     * The ID of the tenant the user belongs to, if available.\n     */\n    tenantId;\n    /**\n     * The date the user's tokens are valid after, formatted as a UTC string.\n     * This is updated every time the user's refresh token are revoked either\n     * from the {@link BaseAuth.revokeRefreshTokens}\n     * API or from the Firebase Auth backend on big account changes (password\n     * resets, password or email updates, etc).\n     */\n    tokensValidAfterTime;\n    /**\n     * The multi-factor related properties for the current user, if available.\n     */\n    multiFactor;\n    /**\n     * @param response - The server side response returned from the getAccountInfo\n     *     endpoint.\n     * @constructor\n     * @internal\n     */\n    constructor(response) {\n        // The Firebase user id is required.\n        if (!response.localId) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Invalid user response');\n        }\n        addReadonlyGetter(this, 'uid', response.localId);\n        addReadonlyGetter(this, 'email', response.email);\n        addReadonlyGetter(this, 'emailVerified', !!response.emailVerified);\n        addReadonlyGetter(this, 'displayName', response.displayName);\n        addReadonlyGetter(this, 'photoURL', response.photoUrl);\n        addReadonlyGetter(this, 'phoneNumber', response.phoneNumber);\n        // If disabled is not provided, the account is enabled by default.\n        addReadonlyGetter(this, 'disabled', response.disabled || false);\n        addReadonlyGetter(this, 'metadata', new UserMetadata(response));\n        const providerData = [];\n        for (const entry of response.providerUserInfo || []) {\n            providerData.push(new UserInfo(entry));\n        }\n        addReadonlyGetter(this, 'providerData', providerData);\n        // If the password hash is redacted (probably due to missing permissions)\n        // then clear it out, similar to how the salt is returned. (Otherwise, it\n        // *looks* like a b64-encoded hash is present, which is confusing.)\n        if (response.passwordHash === B64_REDACTED) {\n            addReadonlyGetter(this, 'passwordHash', undefined);\n        }\n        else {\n            addReadonlyGetter(this, 'passwordHash', response.passwordHash);\n        }\n        addReadonlyGetter(this, 'passwordSalt', response.salt);\n        if (response.customAttributes) {\n            addReadonlyGetter(this, 'customClaims', JSON.parse(response.customAttributes));\n        }\n        let validAfterTime = null;\n        // Convert validSince first to UTC milliseconds and then to UTC date string.\n        if (typeof response.validSince !== 'undefined') {\n            validAfterTime = parseDate(parseInt(response.validSince, 10) * 1000);\n        }\n        addReadonlyGetter(this, 'tokensValidAfterTime', validAfterTime || undefined);\n        addReadonlyGetter(this, 'tenantId', response.tenantId);\n        const multiFactor = new MultiFactorSettings(response);\n        if (multiFactor.enrolledFactors.length > 0) {\n            addReadonlyGetter(this, 'multiFactor', multiFactor);\n        }\n    }\n    /**\n     * Returns a JSON-serializable representation of this object.\n     *\n     * @returns A JSON-serializable representation of this object.\n     */\n    toJSON() {\n        const json = {\n            uid: this.uid,\n            email: this.email,\n            emailVerified: this.emailVerified,\n            displayName: this.displayName,\n            photoURL: this.photoURL,\n            phoneNumber: this.phoneNumber,\n            disabled: this.disabled,\n            // Convert metadata to json.\n            metadata: this.metadata.toJSON(),\n            passwordHash: this.passwordHash,\n            passwordSalt: this.passwordSalt,\n            customClaims: deepCopy(this.customClaims),\n            tokensValidAfterTime: this.tokensValidAfterTime,\n            tenantId: this.tenantId,\n        };\n        if (this.multiFactor) {\n            json.multiFactor = this.multiFactor.toJSON();\n        }\n        json.providerData = [];\n        for (const entry of this.providerData) {\n            // Convert each provider data to json.\n            json.providerData.push(entry.toJSON());\n        }\n        return json;\n    }\n}\n/**\n * Defines a new read-only property directly on an object and returns the object.\n *\n * @param obj - The object on which to define the property.\n * @param prop - The name of the property to be defined or modified.\n * @param value - The value associated with the property.\n */\nfunction addReadonlyGetter(obj, prop, value) {\n    Object.defineProperty(obj, prop, {\n        value,\n        // Make this property read-only.\n        writable: false,\n        // Include this property during enumeration of obj's properties.\n        enumerable: true,\n    });\n}\n/**\n * Returns a deep copy of an object or array.\n *\n * @param value - The object or array to deep copy.\n * @returns A deep copy of the provided object or array.\n */\nfunction deepCopy(value) {\n    return deepExtend(undefined, value);\n}\n/**\n * Copies properties from source to target (recursively allows extension of objects and arrays).\n * Scalar values in the target are over-written. If target is undefined, an object of the\n * appropriate type will be created (and returned).\n *\n * We recursively copy all child properties of plain objects in the source - so that namespace-like\n * objects are merged.\n *\n * Note that the target can be a function, in which case the properties in the source object are\n * copied onto it as static properties of the function.\n *\n * @param target - The value which is being extended.\n * @param source - The value whose properties are extending the target.\n * @returns The target value.\n */\nfunction deepExtend(target, source) {\n    if (!(source instanceof Object)) {\n        return source;\n    }\n    switch (source.constructor) {\n        case Date: {\n            // Treat Dates like scalars; if the target date object had any child\n            // properties - they will be lost!\n            const dateValue = source;\n            return new Date(dateValue.getTime());\n        }\n        case Object:\n            if (target === undefined) {\n                target = {};\n            }\n            break;\n        case Array:\n            // Always copy the array source and overwrite the target.\n            target = [];\n            break;\n        default:\n            // Not a plain Object - treat it as a scalar.\n            return source;\n    }\n    for (const prop in source) {\n        if (!Object.prototype.hasOwnProperty.call(source, prop)) {\n            continue;\n        }\n        target[prop] = deepExtend(target[prop], source[prop]);\n    }\n    return target;\n}\n", "import { ApiSettings } from './api-requests';\nimport { BaseClient } from './client';\nimport { AuthClientErrorCode, FirebaseAuthError } from './errors';\nimport { UserRecord } from './user-record';\nimport { isNonEmptyString, isNumber, isObject, isUid } from './validator';\n/** Minimum allowed session cookie duration in seconds (5 minutes). */\nconst MIN_SESSION_COOKIE_DURATION_SECS = 5 * 60;\n/** Maximum allowed session cookie duration in seconds (2 weeks). */\nconst MAX_SESSION_COOKIE_DURATION_SECS = 14 * 24 * 60 * 60;\n/** List of reserved claims which cannot be provided when creating a custom token. */\nconst RESERVED_CLAIMS = [\n    'acr',\n    'amr',\n    'at_hash',\n    'aud',\n    'auth_time',\n    'azp',\n    'cnf',\n    'c_hash',\n    'exp',\n    'iat',\n    'iss',\n    'jti',\n    'nbf',\n    'nonce',\n    'sub',\n    'firebase',\n];\n/** Maximum allowed number of characters in the custom claims payload. */\nconst MAX_CLAIMS_PAYLOAD_SIZE = 1000;\n/**\n * Instantiates the createSessionCookie endpoint settings.\n *\n * @internal\n */\nexport const FIREBASE_AUTH_CREATE_SESSION_COOKIE = new ApiSettings('v1', ':createSessionCookie', 'POST')\n    // Set request validator.\n    .setRequestValidator((request) => {\n    // Validate the ID token is a non-empty string.\n    if (!isNonEmptyString(request.idToken)) {\n        throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ID_TOKEN);\n    }\n    // Validate the custom session cookie duration.\n    if (!isNumber(request.validDuration) ||\n        request.validDuration < MIN_SESSION_COOKIE_DURATION_SECS ||\n        request.validDuration > MAX_SESSION_COOKIE_DURATION_SECS) {\n        throw new FirebaseAuthError(AuthClientErrorCode.INVALID_SESSION_COOKIE_DURATION);\n    }\n})\n    // Set response validator.\n    .setResponseValidator((response) => {\n    // Response should always contain the session cookie.\n    if (!isNonEmptyString(response.sessionCookie)) {\n        throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR);\n    }\n});\n/**\n * Instantiates the getAccountInfo endpoint settings.\n *\n * @internal\n */\nexport const FIREBASE_AUTH_GET_ACCOUNT_INFO = new ApiSettings('v1', '/accounts:lookup', 'POST')\n    // Set request validator.\n    .setRequestValidator((request) => {\n    if (!request.localId && !request.email && !request.phoneNumber && !request.federatedUserId) {\n        throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Server request is missing user identifier');\n    }\n})\n    // Set response validator.\n    .setResponseValidator((response) => {\n    if (!response.users || !response.users.length) {\n        throw new FirebaseAuthError(AuthClientErrorCode.USER_NOT_FOUND);\n    }\n});\n/**\n * Instantiates the revokeRefreshTokens endpoint settings for updating existing accounts.\n *\n * @internal\n * @link https://github.com/firebase/firebase-admin-node/blob/9955bca47249301aa970679ae99fe01d54adf6a8/src/auth/auth-api-request.ts#L746\n */\nexport const FIREBASE_AUTH_REVOKE_REFRESH_TOKENS = new ApiSettings('v1', '/accounts:update', 'POST')\n    // Set request validator.\n    .setRequestValidator((request) => {\n    // localId is a required parameter.\n    if (typeof request.localId === 'undefined') {\n        throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Server request is missing user identifier');\n    }\n    // validSince should be a number.\n    if (typeof request.validSince !== 'undefined' && !isNumber(request.validSince)) {\n        throw new FirebaseAuthError(AuthClientErrorCode.INVALID_TOKENS_VALID_AFTER_TIME);\n    }\n})\n    // Set response validator.\n    .setResponseValidator((response) => {\n    // If the localId is not returned, then the request failed.\n    if (!response.localId) {\n        throw new FirebaseAuthError(AuthClientErrorCode.USER_NOT_FOUND);\n    }\n});\n/**\n * Instantiates the setCustomUserClaims endpoint settings for updating existing accounts.\n *\n * @internal\n * @link https://github.com/firebase/firebase-admin-node/blob/9955bca47249301aa970679ae99fe01d54adf6a8/src/auth/auth-api-request.ts#L746\n */\nexport const FIREBASE_AUTH_SET_CUSTOM_USER_CLAIMS = new ApiSettings('v1', '/accounts:update', 'POST')\n    // Set request validator.\n    .setRequestValidator((request) => {\n    // localId is a required parameter.\n    if (typeof request.localId === 'undefined') {\n        throw new FirebaseAuthError(AuthClientErrorCode.INTERNAL_ERROR, 'INTERNAL ASSERT FAILED: Server request is missing user identifier');\n    }\n    // customAttributes should be stringified JSON with no blacklisted claims.\n    // The payload should not exceed 1KB.\n    if (typeof request.customAttributes !== 'undefined') {\n        let developerClaims;\n        try {\n            developerClaims = JSON.parse(request.customAttributes);\n        }\n        catch (error) {\n            if (error instanceof Error) {\n                // JSON parsing error. This should never happen as we stringify the claims internally.\n                // However, we still need to check since setAccountInfo via edit requests could pass\n                // this field.\n                throw new FirebaseAuthError(AuthClientErrorCode.INVALID_CLAIMS, error.message);\n            }\n            throw error;\n        }\n        const invalidClaims = [];\n        // Check for any invalid claims.\n        RESERVED_CLAIMS.forEach(blacklistedClaim => {\n            if (Object.prototype.hasOwnProperty.call(developerClaims, blacklistedClaim)) {\n                invalidClaims.push(blacklistedClaim);\n            }\n        });\n        // Throw an error if an invalid claim is detected.\n        if (invalidClaims.length > 0) {\n            throw new FirebaseAuthError(AuthClientErrorCode.FORBIDDEN_CLAIM, invalidClaims.length > 1\n                ? `Developer claims \"${invalidClaims.join('\", \"')}\" are reserved and cannot be specified.`\n                : `Developer claim \"${invalidClaims[0]}\" is reserved and cannot be specified.`);\n        }\n        // Check claims payload does not exceed maxmimum size.\n        if (request.customAttributes.length > MAX_CLAIMS_PAYLOAD_SIZE) {\n            throw new FirebaseAuthError(AuthClientErrorCode.CLAIMS_TOO_LARGE, `Developer claims payload should not exceed ${MAX_CLAIMS_PAYLOAD_SIZE} characters.`);\n        }\n    }\n})\n    // Set response validator.\n    .setResponseValidator((response) => {\n    // If the localId is not returned, then the request failed.\n    if (!response.localId) {\n        throw new FirebaseAuthError(AuthClientErrorCode.USER_NOT_FOUND);\n    }\n});\nexport class AuthApiClient extends BaseClient {\n    /**\n     * Creates a new Firebase session cookie with the specified duration that can be used for\n     * session management (set as a server side session cookie with custom cookie policy).\n     * The session cookie JWT will have the same payload claims as the provided ID token.\n     *\n     * @param idToken - The Firebase ID token to exchange for a session cookie.\n     * @param expiresIn - The session cookie duration in milliseconds.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     *\n     * @returns A promise that resolves on success with the created session cookie.\n     */\n    async createSessionCookie(idToken, expiresIn, env) {\n        const request = {\n            idToken,\n            // Convert to seconds.\n            validDuration: expiresIn / 1000,\n        };\n        const res = await this.fetch(FIREBASE_AUTH_CREATE_SESSION_COOKIE, request, env);\n        return res.sessionCookie;\n    }\n    /**\n     * Looks up a user by uid.\n     *\n     * @param uid - The uid of the user to lookup.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     * @returns A promise that resolves with the user information.\n     */\n    async getAccountInfoByUid(uid, env) {\n        if (!isUid(uid)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_UID);\n        }\n        const request = {\n            localId: [uid],\n        };\n        const res = await this.fetch(FIREBASE_AUTH_GET_ACCOUNT_INFO, request, env);\n        // Returns the user record populated with server response.\n        return new UserRecord(res.users[0]);\n    }\n    /**\n     * Revokes all refresh tokens for the specified user identified by the uid provided.\n     * In addition to revoking all refresh tokens for a user, all ID tokens issued\n     * before revocation will also be revoked on the Auth backend. Any request with an\n     * ID token generated before revocation will be rejected with a token expired error.\n     * Note that due to the fact that the timestamp is stored in seconds, any tokens minted in\n     * the same second as the revocation will still be valid. If there is a chance that a token\n     * was minted in the last second, delay for 1 second before revoking.\n     *\n     * @param uid - The user whose tokens are to be revoked.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     * @returns A promise that resolves when the operation completes\n     *     successfully with the user id of the corresponding user.\n     */\n    async revokeRefreshTokens(uid, env) {\n        // Validate user UID.\n        if (!isUid(uid)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_UID);\n        }\n        const request = {\n            localId: uid,\n            // validSince is in UTC seconds.\n            validSince: Math.floor(new Date().getTime() / 1000),\n        };\n        const res = await this.fetch(FIREBASE_AUTH_REVOKE_REFRESH_TOKENS, request, env);\n        return res.localId;\n    }\n    /**\n     * Sets additional developer claims on an existing user identified by provided UID.\n     *\n     * @param uid - The user to edit.\n     * @param customUserClaims - The developer claims to set.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     * @returns A promise that resolves when the operation completes\n     *     with the user id that was edited.\n     */\n    async setCustomUserClaims(uid, customUserClaims, env) {\n        // Validate user UID.\n        if (!isUid(uid)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_UID);\n        }\n        else if (!isObject(customUserClaims)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'CustomUserClaims argument must be an object or null.');\n        }\n        // Delete operation. Replace null with an empty object.\n        if (customUserClaims === null) {\n            customUserClaims = {};\n        }\n        // Construct custom user attribute editting request.\n        const request = {\n            localId: uid,\n            customAttributes: JSON.stringify(customUserClaims),\n        };\n        const res = await this.fetch(FIREBASE_AUTH_SET_CUSTOM_USER_CLAIMS, request, env);\n        return res.localId;\n    }\n}\n", "export const utf8Encoder = new TextEncoder();\nexport const utf8Decoder = new TextDecoder();\n", "import { utf8Encoder } from './utf8';\nexport const decodeBase64Url = (str) => {\n    return decodeBase64(str.replace(/_|-/g, m => ({ _: '/', '-': '+' })[m] ?? m));\n};\nexport const encodeBase64Url = (buf) => encodeBase64(buf).replace(/\\/|\\+/g, m => ({ '/': '_', '+': '-' })[m] ?? m);\n// This approach is written in MDN.\n// btoa does not support utf-8 characters. So we need a little bit hack.\nexport const encodeBase64 = (buf) => {\n    const binary = String.fromCharCode(...new Uint8Array(buf));\n    return btoa(binary);\n};\n// atob does not support utf-8 characters. So we need a little bit hack.\nexport const decodeBase64 = (str) => {\n    const binary = atob(str);\n    const bytes = new Uint8Array(new ArrayBuffer(binary.length));\n    const half = binary.length / 2;\n    for (let i = 0, j = binary.length - 1; i <= half; i++, j--) {\n        bytes[i] = binary.charCodeAt(i);\n        bytes[j] = binary.charCodeAt(j);\n    }\n    return bytes;\n};\nconst jsonUTF8Stringify = (obj) => utf8Encoder.encode(JSON.stringify(obj));\nexport const encodeObjectBase64Url = (obj) => encodeBase64Url(jsonUTF8Stringify(obj).buffer);\n", "import { decodeBase64 } from './base64';\n/**\n * Parses a sequence of ASN.1 elements from a given Uint8Array.\n * Internally, this function repeatedly calls `parseElement` on\n * the subarray until the entire sequence is consumed, returning\n * an array of parsed elements.\n */\nfunction getElement(seq) {\n    const result = [];\n    let next = 0;\n    while (next < seq.length) {\n        // Parse one ASN.1 element from the remaining subarray\n        const nextPart = parseElement(seq.subarray(next));\n        result.push(nextPart);\n        // Advance the pointer by the element's total byte length\n        next += nextPart.byteLength;\n    }\n    return result;\n}\n/**\n * Parses a single ASN.1 element (in DER encoding) from the given byte array.\n *\n * Each element consists of:\n *   1) Tag (possibly multiple bytes if 0x1f is encountered)\n *   2) Length (short form or long form, possibly indefinite)\n *   3) Contents (the data payload)\n *\n * Returns an object containing:\n *   - byteLength: total size (in bytes) of this element (including tag & length)\n *   - contents: Uint8Array of just the element's contents\n *   - raw: Uint8Array of the entire element (tag + length + contents)\n */\nfunction parseElement(bytes) {\n    let position = 0;\n    // --- Parse Tag ---\n    // The tag is in the lower 5 bits (0x1f). If it's 0x1f, it indicates a multi-byte tag.\n    let tag = bytes[0] & 0x1f;\n    position++;\n    if (tag === 0x1f) {\n        tag = 0;\n        // Continue reading the tag bytes while each byte >= 0x80\n        while (bytes[position] >= 0x80) {\n            tag = tag * 128 + bytes[position] - 0x80;\n            position++;\n        }\n        tag = tag * 128 + bytes[position] - 0x80;\n        position++;\n    }\n    // --- Parse Length ---\n    let length = 0;\n    // Short-form length: if less than 0x80, it's the length itself\n    if (bytes[position] < 0x80) {\n        length = bytes[position];\n        position++;\n    }\n    else if (length === 0x80) {\n        // Indefinite length form: scan until 0x00 0x00\n        length = 0;\n        while (bytes[position + length] !== 0 || bytes[position + length + 1] !== 0) {\n            if (length > bytes.byteLength) {\n                throw new TypeError('invalid indefinite form length');\n            }\n            length++;\n        }\n        const byteLength = position + length + 2;\n        return {\n            byteLength,\n            contents: bytes.subarray(position, position + length),\n            raw: bytes.subarray(0, byteLength),\n        };\n    }\n    else {\n        // Long-form length: the lower 7 bits of this byte indicates how many bytes follow for length\n        const numberOfDigits = bytes[position] & 0x7f;\n        position++;\n        length = 0;\n        // Accumulate the length from these \"numberOfDigits\" bytes\n        for (let i = 0; i < numberOfDigits; i++) {\n            length = length * 256 + bytes[position];\n            position++;\n        }\n    }\n    // The total byte length of this element (tag + length + contents)\n    const byteLength = position + length;\n    return {\n        byteLength,\n        contents: bytes.subarray(position, byteLength),\n        raw: bytes.subarray(0, byteLength),\n    };\n}\n/**\n * Extracts the SubjectPublicKeyInfo (SPKI) portion from a DER-encoded X.509 certificate.\n *\n * Steps:\n *   1) Parse the entire certificate as an ASN.1 SEQUENCE.\n *   2) Retrieve the TBS (To-Be-Signed) Certificate, which is the first element.\n *   3) Parse the TBS Certificate to get its internal fields (version, serial, issuer, etc.).\n *   4) Depending on whether the version field is present (tag = 0xa0), the SPKI is either\n *      at index 6 or 5 (skipping version if absent).\n *   5) Finally, encode the raw SPKI bytes in CryptoKey and return.\n */\nasync function spkiFromX509(buf) {\n    // Parse the top-level ASN.1 structure, then get the top-level contents\n    // which typically contain [ TBS Certificate, signatureAlgorithm, signature ].\n    // Retrieve TBS Certificate as [0], then parse TBS Certificate further.\n    const tbsCertificate = getElement(getElement(parseElement(buf).contents)[0].contents);\n    // In the TBS Certificate, check whether the first element (index 0) is a version field (tag=0xa0).\n    // If it is, the SubjectPublicKeyInfo is the 7th element (index 6).\n    // Otherwise, it is the 6th element (index 5).\n    const spki = tbsCertificate[tbsCertificate[0].raw[0] === 0xa0 ? 6 : 5].raw;\n    return await crypto.subtle.importKey('spki', spki, {\n        name: 'RSASSA-PKCS1-v1_5',\n        hash: 'SHA-256',\n    }, true, ['verify']);\n}\nexport async function jwkFromX509(kid, x509) {\n    const pem = x509.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\\s)/g, '');\n    const raw = decodeBase64(pem);\n    const spki = await spkiFromX509(raw);\n    const { kty, alg, n, e } = await crypto.subtle.exportKey('jwk', spki);\n    return {\n        kid,\n        use: 'sig',\n        kty,\n        alg,\n        n,\n        e,\n    };\n}\n", "import { isNonNullObject, isObject, isURL } from './validator';\nimport { jwkFromX509 } from './x509';\nexport const isJWKMetadata = (value) => {\n    if (!isNonNullObject(value) || !value.keys) {\n        return false;\n    }\n    const keys = value.keys;\n    if (!Array.isArray(keys)) {\n        return false;\n    }\n    const filtered = keys.filter((key) => isObject(key) && !!key.kid && typeof key.kid === 'string');\n    return keys.length === filtered.length;\n};\nexport const isX509Certificates = (value) => {\n    if (!isNonNullObject(value)) {\n        return false;\n    }\n    const values = Object.values(value);\n    if (values.length === 0) {\n        return false;\n    }\n    for (const v of values) {\n        if (typeof v !== 'string' || v === '') {\n            return false;\n        }\n    }\n    return true;\n};\n/**\n * Class to fetch public keys from a client certificates URL.\n */\nexport class UrlKeyFetcher {\n    fetcher;\n    keyStorer;\n    constructor(fetcher, keyStorer) {\n        this.fetcher = fetcher;\n        this.keyStorer = keyStorer;\n    }\n    /**\n     * Fetches the public keys for the Google certs.\n     *\n     * @returns A promise fulfilled with public keys for the Google certs.\n     */\n    async fetchPublicKeys() {\n        const publicKeys = await this.keyStorer.get();\n        if (publicKeys === null || typeof publicKeys !== 'object') {\n            return await this.refresh();\n        }\n        return publicKeys;\n    }\n    async refresh() {\n        const resp = await this.fetcher.fetch();\n        if (!resp.ok) {\n            const errorMessage = 'Error fetching public keys for Google certs: ';\n            const text = await resp.text();\n            throw new Error(errorMessage + text);\n        }\n        const json = await resp.json();\n        const publicKeys = await this.retrievePublicKeys(json);\n        const cacheControlHeader = resp.headers.get('cache-control');\n        // store the public keys cache in the KV store.\n        const maxAge = parseMaxAge(cacheControlHeader);\n        if (!isNaN(maxAge) && maxAge > 0) {\n            await this.keyStorer.put(JSON.stringify(publicKeys), maxAge);\n        }\n        return publicKeys;\n    }\n    async retrievePublicKeys(json) {\n        if (isX509Certificates(json)) {\n            const jwks = [];\n            for (const [kid, x509] of Object.entries(json)) {\n                jwks.push(await jwkFromX509(kid, x509));\n            }\n            return jwks;\n        }\n        if (!isJWKMetadata(json)) {\n            throw new Error(`The public keys are not an object or null: \"${json}`);\n        }\n        return json.keys;\n    }\n}\n// parseMaxAge parses Cache-Control header and returns max-age value as number.\n// returns NaN when Cache-Control header is none or max-age is not found, the value is invalid.\nexport const parseMaxAge = (cacheControlHeader) => {\n    if (cacheControlHeader === null) {\n        return NaN;\n    }\n    const parts = cacheControlHeader.split(',');\n    for (const part of parts) {\n        const subParts = part.trim().split('=');\n        if (subParts[0] !== 'max-age') {\n            continue;\n        }\n        return Number(subParts[1]); // maxAge is a seconds value.\n    }\n    return NaN;\n};\nexport class HTTPFetcher {\n    clientCertUrl;\n    constructor(clientCertUrl) {\n        this.clientCertUrl = clientCertUrl;\n        if (!isURL(clientCertUrl)) {\n            throw new Error('The provided public client certificate URL is not a valid URL.');\n        }\n    }\n    fetch() {\n        return fetch(this.clientCertUrl);\n    }\n}\n", "import { JwtError, JwtErrorCode } from './errors';\nimport { HTTPFetcher, UrlKeyFetcher } from './jwk-fetcher';\nimport { isNonNullObject } from './validator';\n// https://firebase.google.com/docs/auth/admin/verify-id-tokens#verify_id_tokens_using_a_third-party_jwt_library\n// https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams\nexport const rs256alg = {\n    name: 'RSASSA-PKCS1-v1_5',\n    modulusLength: 2048,\n    publicExponent: new Uint8Array([0x01, 0x00, 0x01]),\n    hash: 'SHA-256',\n};\n/**\n * Class for verifying JWT signature with a public key.\n */\nexport class PublicKeySignatureVerifier {\n    keyFetcher;\n    constructor(keyFetcher) {\n        this.keyFetcher = keyFetcher;\n        if (!isNonNullObject(keyFetcher)) {\n            throw new Error('The provided key fetcher is not an object or null.');\n        }\n    }\n    static withCertificateUrl(clientCertUrl, keyStorer) {\n        const fetcher = new HTTPFetcher(clientCertUrl);\n        return new PublicKeySignatureVerifier(new UrlKeyFetcher(fetcher, keyStorer));\n    }\n    /**\n     * Verifies the signature of a JWT using the provided secret or a function to fetch\n     * the public key.\n     *\n     * @param token - The JWT to be verified.\n     * @throws If the JWT is not a valid RS256 token.\n     * @returns A Promise resolving for a token with a valid signature.\n     */\n    async verify(token) {\n        const { header } = token.decodedToken;\n        const publicKeys = await this.fetchPublicKeys();\n        for (const publicKey of publicKeys) {\n            if (publicKey.kid !== header.kid) {\n                continue;\n            }\n            const verified = await this.verifySignature(token, publicKey);\n            if (verified) {\n                // succeeded\n                return;\n            }\n            throw new JwtError(JwtErrorCode.INVALID_SIGNATURE, 'The token signature is invalid.');\n        }\n        throw new JwtError(JwtErrorCode.NO_MATCHING_KID, 'The token does not match the kid.');\n    }\n    async verifySignature(token, publicJWK) {\n        try {\n            const key = await crypto.subtle.importKey('jwk', publicJWK, rs256alg, false, ['verify']);\n            return await crypto.subtle.verify(rs256alg, key, token.decodedToken.signature, token.getHeaderPayloadBytes());\n        }\n        catch (err) {\n            throw new JwtError(JwtErrorCode.INVALID_SIGNATURE, `Error verifying signature: ${err}`);\n        }\n    }\n    async fetchPublicKeys() {\n        try {\n            return await this.keyFetcher.fetchPublicKeys();\n        }\n        catch (err) {\n            throw new JwtError(JwtErrorCode.KEY_FETCH_ERROR, `Error fetching public keys for Google certs: ${err}`);\n        }\n    }\n}\n/**\n * Class for verifying unsigned (emulator) JWTs.\n */\nexport class EmulatorSignatureVerifier {\n    async verify() {\n        // Signature checks skipped for emulator; no need to fetch public keys.\n    }\n}\n", "import { decodeBase64Url } from './base64';\nimport { JwtError, JwtErrorCode } from './errors';\nimport { utf8Decoder, utf8Encoder } from './utf8';\nimport { isNonEmptyString, isNumber, isString } from './validator';\nexport class RS256Token {\n    rawToken;\n    decodedToken;\n    constructor(rawToken, decodedToken) {\n        this.rawToken = rawToken;\n        this.decodedToken = decodedToken;\n    }\n    /**\n     *\n     * @param token - The JWT to verify.\n     * @param currentTimestamp - Current timestamp in seconds since the Unix epoch.\n     * @param skipVerifyHeader - skip verification header content if true.\n     * @throw Error if the token is invalid.\n     * @returns\n     */\n    static decode(token, currentTimestamp, skipVerifyHeader = false) {\n        const tokenParts = token.split('.');\n        if (tokenParts.length !== 3) {\n            throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, 'token must consist of 3 parts');\n        }\n        const header = decodeHeader(tokenParts[0], skipVerifyHeader);\n        const payload = decodePayload(tokenParts[1], currentTimestamp);\n        return new RS256Token(token, {\n            header,\n            payload,\n            signature: decodeBase64Url(tokenParts[2]),\n        });\n    }\n    getHeaderPayloadBytes() {\n        const rawToken = this.rawToken;\n        // `${token.header}.${token.payload}`\n        const trimmedSignature = rawToken.substring(0, rawToken.lastIndexOf('.'));\n        return utf8Encoder.encode(trimmedSignature);\n    }\n}\nconst decodeHeader = (headerPart, skipVerifyHeader) => {\n    const header = decodeBase64JSON(headerPart);\n    if (skipVerifyHeader) {\n        return header;\n    }\n    const kid = header.kid;\n    if (!isString(kid)) {\n        throw new JwtError(JwtErrorCode.NO_KID_IN_HEADER, `kid must be a string but got ${kid}`);\n    }\n    const alg = header.alg;\n    if (isString(alg) && alg !== 'RS256') {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `algorithm must be RS256 but got ${alg}`);\n    }\n    return header;\n};\nconst decodePayload = (payloadPart, currentTimestamp) => {\n    const payload = decodeBase64JSON(payloadPart);\n    if (!isNonEmptyString(payload.aud)) {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `\"aud\" claim must be a string but got \"${payload.aud}\"`);\n    }\n    if (!isNonEmptyString(payload.sub)) {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `\"sub\" claim must be a string but got \"${payload.sub}\"`);\n    }\n    if (!isNonEmptyString(payload.iss)) {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `\"iss\" claim must be a string but got \"${payload.iss}\"`);\n    }\n    if (!isNumber(payload.iat)) {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `\"iat\" claim must be a number but got \"${payload.iat}\"`);\n    }\n    if (currentTimestamp < payload.iat) {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `Incorrect \"iat\" claim must be a older than \"${currentTimestamp}\" (iat: \"${payload.iat}\")`);\n    }\n    if (!isNumber(payload.exp)) {\n        throw new JwtError(JwtErrorCode.INVALID_ARGUMENT, `\"exp\" claim must be a number but got \"${payload.exp}\"`);\n    }\n    if (currentTimestamp > payload.exp) {\n        throw new JwtError(JwtErrorCode.TOKEN_EXPIRED, `Incorrect \"exp\" (expiration time) claim must be a newer than \"${currentTimestamp}\" (exp: \"${payload.exp}\")`);\n    }\n    return payload;\n};\nconst decodeBase64JSON = (b64Url) => {\n    const decoded = decodeBase64Url(b64Url);\n    try {\n        return JSON.parse(utf8Decoder.decode(decoded));\n    }\n    catch {\n        return null;\n    }\n};\n", "import { AuthClientErrorCode, FirebaseAuthError, JwtError, JwtErrorCode } from './errors';\nimport { EmulatorSignatureVerifier, PublicKeySignatureVerifier } from './jws-verifier';\nimport { RS256Token } from './jwt-decoder';\nimport { isNonEmptyString, isNonNullObject, isString, isURL } from './validator';\n// Audience to use for Firebase Auth Custom tokens\nexport const FIREBASE_AUDIENCE = 'https://identitytoolkit.googleapis.com/google.identity.identitytoolkit.v1.IdentityToolkit';\nconst EMULATOR_VERIFIER = new EmulatorSignatureVerifier();\nconst makeExpectedbutGotMsg = (want, got) => `Expected \"${want}\" but got \"${got}\".`;\n/**\n * Class for verifying general purpose Firebase JWTs. This verifies ID tokens and session cookies.\n *\n * @internal\n */\nexport class FirebaseTokenVerifier {\n    signatureVerifier;\n    projectId;\n    issuer;\n    tokenInfo;\n    shortNameArticle;\n    constructor(signatureVerifier, projectId, issuer, tokenInfo) {\n        this.signatureVerifier = signatureVerifier;\n        this.projectId = projectId;\n        this.issuer = issuer;\n        this.tokenInfo = tokenInfo;\n        if (!isNonEmptyString(projectId)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'Your Firebase project ID must be a non-empty string');\n        }\n        else if (!isURL(issuer)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The provided JWT issuer is an invalid URL.');\n        }\n        else if (!isNonNullObject(tokenInfo)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The provided JWT information is not an object or null.');\n        }\n        else if (!isURL(tokenInfo.url)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The provided JWT verification documentation URL is invalid.');\n        }\n        else if (!isNonEmptyString(tokenInfo.verifyApiName)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The JWT verify API name must be a non-empty string.');\n        }\n        else if (!isNonEmptyString(tokenInfo.jwtName)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The JWT public full name must be a non-empty string.');\n        }\n        else if (!isNonEmptyString(tokenInfo.shortName)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The JWT public short name must be a non-empty string.');\n        }\n        else if (!isNonNullObject(tokenInfo.expiredErrorCode) || !('code' in tokenInfo.expiredErrorCode)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'The JWT expiration error code must be a non-null ErrorInfo object.');\n        }\n        this.shortNameArticle = tokenInfo.shortName.charAt(0).match(/[aeiou]/i) ? 'an' : 'a';\n    }\n    /**\n     * Verifies the format and signature of a Firebase Auth JWT token.\n     *\n     * @param jwtToken - The Firebase Auth JWT token to verify.\n     * @param isEmulator - Whether to accept Auth Emulator tokens.\n     * @param clockSkewSeconds - The number of seconds to tolerate when checking the token's iat. Must be between 0-60, and an integer. Defualts to 0.\n     * @returns A promise fulfilled with the decoded claims of the Firebase Auth ID token.\n     */\n    verifyJWT(jwtToken, isEmulator = false, clockSkewSeconds = 5) {\n        if (!isString(jwtToken)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, `First argument to ${this.tokenInfo.verifyApiName} must be a ${this.tokenInfo.jwtName} string.`);\n        }\n        if (clockSkewSeconds < 0 || clockSkewSeconds > 60 || !Number.isInteger(clockSkewSeconds)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, 'clockSkewSeconds must be an integer between 0 and 60.');\n        }\n        return this.decodeAndVerify(jwtToken, isEmulator, clockSkewSeconds).then(payload => {\n            payload.uid = payload.sub;\n            return payload;\n        });\n    }\n    async decodeAndVerify(token, isEmulator, clockSkewSeconds = 5) {\n        const currentTimestamp = Math.floor(Date.now() / 1000) + clockSkewSeconds;\n        try {\n            const rs256Token = this.safeDecode(token, isEmulator, currentTimestamp);\n            const { payload } = rs256Token.decodedToken;\n            this.verifyPayload(payload, currentTimestamp);\n            await this.verifySignature(rs256Token, isEmulator);\n            return payload;\n        }\n        catch (err) {\n            if (err instanceof JwtError) {\n                throw this.mapJwtErrorToAuthError(err);\n            }\n            throw err;\n        }\n    }\n    safeDecode(jwtToken, isEmulator, currentTimestamp) {\n        try {\n            return RS256Token.decode(jwtToken, currentTimestamp, isEmulator);\n        }\n        catch (err) {\n            const verifyJwtTokenDocsMessage = ` See ${this.tokenInfo.url} ` +\n                `for details on how to retrieve ${this.shortNameArticle} ${this.tokenInfo.shortName}.`;\n            const errorMessage = `Decoding ${this.tokenInfo.jwtName} failed. Make sure you passed ` +\n                `the entire string JWT which represents ${this.shortNameArticle} ` +\n                `${this.tokenInfo.shortName}.` +\n                verifyJwtTokenDocsMessage;\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, errorMessage + ` err: ${err}`);\n        }\n    }\n    verifyPayload(tokenPayload, currentTimestamp) {\n        const payload = tokenPayload;\n        const projectIdMatchMessage = ` Make sure the ${this.tokenInfo.shortName} comes from the same ` +\n            'Firebase project as the service account used to authenticate this SDK.';\n        const verifyJwtTokenDocsMessage = ` See ${this.tokenInfo.url} ` +\n            `for details on how to retrieve ${this.shortNameArticle} ${this.tokenInfo.shortName}.`;\n        const createInvalidArgument = (errorMessage) => new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, errorMessage);\n        if (payload.aud !== this.projectId && payload.aud !== FIREBASE_AUDIENCE) {\n            throw createInvalidArgument(`${this.tokenInfo.jwtName} has incorrect \"aud\" (audience) claim. ` +\n                makeExpectedbutGotMsg(this.projectId, payload.aud) +\n                projectIdMatchMessage +\n                verifyJwtTokenDocsMessage);\n        }\n        if (payload.iss !== this.issuer + this.projectId) {\n            throw createInvalidArgument(`${this.tokenInfo.jwtName} has incorrect \"iss\" (issuer) claim. ` +\n                makeExpectedbutGotMsg(this.issuer, payload.iss) +\n                projectIdMatchMessage +\n                verifyJwtTokenDocsMessage);\n        }\n        if (payload.sub.length > 128) {\n            throw createInvalidArgument(`${this.tokenInfo.jwtName} has \"sub\" (subject) claim longer than 128 characters.` + verifyJwtTokenDocsMessage);\n        }\n        // check auth_time claim\n        if (typeof payload.auth_time !== 'number') {\n            throw createInvalidArgument(`${this.tokenInfo.jwtName} has no \"auth_time\" claim. ` + verifyJwtTokenDocsMessage);\n        }\n        if (currentTimestamp < payload.auth_time) {\n            throw createInvalidArgument(`${this.tokenInfo.jwtName} has incorrect \"auth_time\" claim. ` + verifyJwtTokenDocsMessage);\n        }\n    }\n    async verifySignature(token, isEmulator) {\n        const verifier = isEmulator ? EMULATOR_VERIFIER : this.signatureVerifier;\n        return await verifier.verify(token);\n    }\n    /**\n     * Maps JwtError to FirebaseAuthError\n     *\n     * @param error - JwtError to be mapped.\n     * @returns FirebaseAuthError or Error instance.\n     */\n    mapJwtErrorToAuthError(error) {\n        const verifyJwtTokenDocsMessage = ` See ${this.tokenInfo.url} ` +\n            `for details on how to retrieve ${this.shortNameArticle} ${this.tokenInfo.shortName}.`;\n        if (error.code === JwtErrorCode.TOKEN_EXPIRED) {\n            const errorMessage = `${this.tokenInfo.jwtName} has expired. Get a fresh ${this.tokenInfo.shortName}` +\n                ` from your client app and try again (auth/${this.tokenInfo.expiredErrorCode.code}).` +\n                verifyJwtTokenDocsMessage;\n            return new FirebaseAuthError(this.tokenInfo.expiredErrorCode, errorMessage);\n        }\n        else if (error.code === JwtErrorCode.INVALID_SIGNATURE) {\n            const errorMessage = `${this.tokenInfo.jwtName} has invalid signature.` + verifyJwtTokenDocsMessage;\n            return new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, errorMessage);\n        }\n        else if (error.code === JwtErrorCode.NO_MATCHING_KID) {\n            const errorMessage = `${this.tokenInfo.jwtName} has \"kid\" claim which does not ` +\n                `correspond to a known public key. Most likely the ${this.tokenInfo.shortName} ` +\n                'is expired, so get a fresh token from your client app and try again.';\n            return new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, errorMessage);\n        }\n        return new FirebaseAuthError(AuthClientErrorCode.INVALID_ARGUMENT, error.message);\n    }\n}\n// URL containing the public keys for the Google certs (whose private keys are used to sign Firebase\n// Auth ID tokens)\nconst CLIENT_JWK_URL = 'https://www.googleapis.com/robot/v1/metadata/jwk/securetoken@system.gserviceaccount.com';\n/**\n * User facing token information related to the Firebase ID token.\n *\n * @internal\n */\nexport const ID_TOKEN_INFO = {\n    url: 'https://firebase.google.com/docs/auth/admin/verify-id-tokens',\n    verifyApiName: 'verifyIdToken()',\n    jwtName: 'Firebase ID token',\n    shortName: 'ID token',\n    expiredErrorCode: AuthClientErrorCode.ID_TOKEN_EXPIRED,\n};\n/**\n * Creates a new FirebaseTokenVerifier to verify Firebase ID tokens.\n *\n * @internal\n * @returns FirebaseTokenVerifier\n */\nexport function createIdTokenVerifier(projectID, keyStorer) {\n    const signatureVerifier = PublicKeySignatureVerifier.withCertificateUrl(CLIENT_JWK_URL, keyStorer);\n    return baseCreateIdTokenVerifier(signatureVerifier, projectID);\n}\n/**\n * @internal\n * @returns FirebaseTokenVerifier\n */\nexport function baseCreateIdTokenVerifier(signatureVerifier, projectID) {\n    return new FirebaseTokenVerifier(signatureVerifier, projectID, 'https://securetoken.google.com/', ID_TOKEN_INFO);\n}\n// URL containing the public keys for Firebase session cookies.\nconst SESSION_COOKIE_CERT_URL = 'https://www.googleapis.com/identitytoolkit/v3/relyingparty/publicKeys';\n/**\n * User facing token information related to the Firebase session cookie.\n *\n * @internal\n */\nexport const SESSION_COOKIE_INFO = {\n    url: 'https://firebase.google.com/docs/auth/admin/manage-cookies',\n    verifyApiName: 'verifySessionCookie()',\n    jwtName: 'Firebase session cookie',\n    shortName: 'session cookie',\n    expiredErrorCode: AuthClientErrorCode.SESSION_COOKIE_EXPIRED,\n};\n/**\n * Creates a new FirebaseTokenVerifier to verify Firebase session cookies.\n *\n * @internal\n * @param app - Firebase app instance.\n * @returns FirebaseTokenVerifier\n */\nexport function createSessionCookieVerifier(projectID, keyStorer) {\n    const signatureVerifier = PublicKeySignatureVerifier.withCertificateUrl(SESSION_COOKIE_CERT_URL, keyStorer);\n    return baseCreateSessionCookieVerifier(signatureVerifier, projectID);\n}\n/**\n * @internal\n * @returns FirebaseTokenVerifier\n */\nexport function baseCreateSessionCookieVerifier(signatureVerifier, projectID) {\n    return new FirebaseTokenVerifier(signatureVerifier, projectID, 'https://session.firebase.google.com/', SESSION_COOKIE_INFO);\n}\n", "import { AuthApiClient } from './auth-api-requests';\nimport { useEmulator } from './emulator';\nimport { AppErrorCodes, AuthClientErrorCode, FirebaseAppError, FirebaseAuthError } from './errors';\nimport { createIdTokenVerifier, createSessionCookieVerifier } from './token-verifier';\nimport { isNonNullObject, isNumber } from './validator';\nexport class BaseAuth {\n    /** @internal */\n    idTokenVerifier;\n    sessionCookieVerifier;\n    _authApiClient;\n    constructor(projectId, keyStore, credential) {\n        this.idTokenVerifier = createIdTokenVerifier(projectId, keyStore);\n        this.sessionCookieVerifier = createSessionCookieVerifier(projectId, keyStore);\n        if (credential) {\n            this._authApiClient = new AuthApiClient(projectId, credential);\n        }\n    }\n    get authApiClient() {\n        if (this._authApiClient) {\n            return this._authApiClient;\n        }\n        throw new FirebaseAppError(AppErrorCodes.INVALID_CREDENTIAL, 'Service account must be required in initialization.');\n    }\n    /**\n     * Verifies a Firebase ID token (JWT). If the token is valid, the promise is\n     * fulfilled with the token's decoded claims; otherwise, the promise is\n     * rejected.\n     *\n     * If `checkRevoked` is set to true, first verifies whether the corresponding\n     * user is disabled. If yes, an `auth/user-disabled` error is thrown. If no,\n     * verifies if the session corresponding to the ID token was revoked. If the\n     * corresponding user's session was invalidated, an `auth/id-token-revoked`\n     * error is thrown. If not specified the check is not applied.\n     *\n     * See {@link https://firebase.google.com/docs/auth/admin/verify-id-tokens | Verify ID Tokens}\n     * for code samples and detailed documentation.\n     *\n     * @param idToken - The ID token to verify.\n     * @param checkRevoked - Whether to check if the ID token was revoked.\n     *   This requires an extra request to the Firebase Auth backend to check\n     *   the `tokensValidAfterTime` time for the corresponding user.\n     *   When not specified, this additional check is not applied.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     * @param clockSkewSeconds - The number of seconds to tolerate when checking the `iat`.\n     *   This is to deal with small clock differences among different servers.\n     * @returns A promise fulfilled with the\n     *   token's decoded claims if the ID token is valid; otherwise, a rejected\n     *   promise.\n     */\n    async verifyIdToken(idToken, checkRevoked = false, env, clockSkewSeconds) {\n        const isEmulator = useEmulator(env);\n        const decodedIdToken = await this.idTokenVerifier.verifyJWT(idToken, isEmulator, clockSkewSeconds);\n        // Whether to check if the token was revoked.\n        if (checkRevoked) {\n            return await this.verifyDecodedJWTNotRevokedOrDisabled(decodedIdToken, AuthClientErrorCode.ID_TOKEN_REVOKED, env);\n        }\n        return decodedIdToken;\n    }\n    /**\n     * Creates a new Firebase session cookie with the specified options. The created\n     * JWT string can be set as a server-side session cookie with a custom cookie\n     * policy, and be used for session management. The session cookie JWT will have\n     * the same payload claims as the provided ID token.\n     *\n     * See {@link https://firebase.google.com/docs/auth/admin/manage-cookies | Manage Session Cookies}\n     * for code samples and detailed documentation.\n     *\n     * @param idToken - The Firebase ID token to exchange for a session\n     *   cookie.\n     * @param sessionCookieOptions - The session\n     *   cookie options which includes custom session duration.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     *\n     * @returns A promise that resolves on success with the\n     *   created session cookie.\n     */\n    async createSessionCookie(idToken, sessionCookieOptions, env) {\n        // Return rejected promise if expiresIn is not available.\n        if (!isNonNullObject(sessionCookieOptions) || !isNumber(sessionCookieOptions.expiresIn)) {\n            throw new FirebaseAuthError(AuthClientErrorCode.INVALID_SESSION_COOKIE_DURATION);\n        }\n        return await this.authApiClient.createSessionCookie(idToken, sessionCookieOptions.expiresIn, env);\n    }\n    /**\n     * Verifies a Firebase session cookie. Returns a Promise with the cookie claims.\n     * Rejects the promise if the cookie could not be verified.\n     *\n     * If `checkRevoked` is set to true, first verifies whether the corresponding\n     * user is disabled: If yes, an `auth/user-disabled` error is thrown. If no,\n     * verifies if the session corresponding to the session cookie was revoked.\n     * If the corresponding user's session was invalidated, an\n     * `auth/session-cookie-revoked` error is thrown. If not specified the check\n     * is not performed.\n     *\n     * See {@link https://firebase.google.com/docs/auth/admin/manage-cookies#verify_session_cookie_and_check_permissions |\n     * Verify Session Cookies}\n     * for code samples and detailed documentation\n     *\n     * @param sessionCookie - The session cookie to verify.\n     * @param checkRevoked -  Whether to check if the session cookie was\n     *   revoked. This requires an extra request to the Firebase Auth backend to\n     *   check the `tokensValidAfterTime` time for the corresponding user.\n     *   When not specified, this additional check is not performed.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     *\n     * @returns A promise fulfilled with the\n     *   session cookie's decoded claims if the session cookie is valid; otherwise,\n     *   a rejected promise.\n     */\n    async verifySessionCookie(sessionCookie, checkRevoked = false, env) {\n        const isEmulator = useEmulator(env);\n        const decodedIdToken = await this.sessionCookieVerifier.verifyJWT(sessionCookie, isEmulator);\n        // Whether to check if the token was revoked.\n        if (checkRevoked) {\n            return await this.verifyDecodedJWTNotRevokedOrDisabled(decodedIdToken, AuthClientErrorCode.SESSION_COOKIE_REVOKED, env);\n        }\n        return decodedIdToken;\n    }\n    /**\n     * Gets the user data for the user corresponding to a given `uid`.\n     *\n     * See {@link https://firebase.google.com/docs/auth/admin/manage-users#retrieve_user_data | Retrieve user data}\n     * for code samples and detailed documentation.\n     *\n     * @param uid - The `uid` corresponding to the user whose data to fetch.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     *\n     * @returns A promise fulfilled with the user\n     *   data corresponding to the provided `uid`.\n     */\n    async getUser(uid, env) {\n        return await this.authApiClient.getAccountInfoByUid(uid, env);\n    }\n    /**\n     * Revokes all refresh tokens for an existing user.\n     *\n     * This API will update the user's {@link UserRecord.tokensValidAfterTime} to\n     * the current UTC. It is important that the server on which this is called has\n     * its clock set correctly and synchronized.\n     *\n     * While this will revoke all sessions for a specified user and disable any\n     * new ID tokens for existing sessions from getting minted, existing ID tokens\n     * may remain active until their natural expiration (one hour). To verify that\n     * ID tokens are revoked, use {@link BaseAuth.verifyIdToken}\n     * where `checkRevoked` is set to true.\n     *\n     * @param uid - The `uid` corresponding to the user whose refresh tokens\n     *   are to be revoked.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     *\n     * @returns An empty promise fulfilled once the user's refresh\n     *   tokens have been revoked.\n     */\n    async revokeRefreshTokens(uid, env) {\n        await this.authApiClient.revokeRefreshTokens(uid, env);\n    }\n    /**\n     * Sets additional developer claims on an existing user identified by the\n     * provided `uid`, typically used to define user roles and levels of\n     * access. These claims should propagate to all devices where the user is\n     * already signed in (after token expiration or when token refresh is forced)\n     * and the next time the user signs in. If a reserved OIDC claim name\n     * is used (sub, iat, iss, etc), an error is thrown. They are set on the\n     * authenticated user's ID token JWT.\n     *\n     * See {@link https://firebase.google.com/docs/auth/admin/custom-claims |\n     * Defining user roles and access levels}\n     * for code samples and detailed documentation.\n     *\n     * @param uid - The `uid` of the user to edit.\n     * @param customUserClaims - The developer claims to set. If null is\n     *   passed, existing custom claims are deleted. Passing a custom claims payload\n     *   larger than 1000 bytes will throw an error. Custom claims are added to the\n     *   user's ID token which is transmitted on every authenticated request.\n     *   For profile non-access related user attributes, use database or other\n     *   separate storage systems.\n     * @param env - An optional parameter specifying the environment in which the function is running.\n     *   If the function is running in an emulator environment, this should be set to `EmulatorEnv`.\n     *   If not specified, the function will assume it is running in a production environment.\n     * @returns A promise that resolves when the operation completes\n     *   successfully.\n     */\n    async setCustomUserClaims(uid, customUserClaims, env) {\n        await this.authApiClient.setCustomUserClaims(uid, customUserClaims, env);\n    }\n    /**\n     * Verifies the decoded Firebase issued JWT is not revoked or disabled. Returns a promise that\n     * resolves with the decoded claims on success. Rejects the promise with revocation error if revoked\n     * or user disabled.\n     *\n     * @param decodedIdToken - The JWT's decoded claims.\n     * @param revocationErrorInfo - The revocation error info to throw on revocation\n     *     detection.\n     * @returns A promise that will be fulfilled after a successful verification.\n     */\n    async verifyDecodedJWTNotRevokedOrDisabled(decodedIdToken, revocationErrorInfo, env) {\n        // Get tokens valid after time for the corresponding user.\n        const user = await this.getUser(decodedIdToken.sub, env);\n        if (user.disabled) {\n            throw new FirebaseAuthError(AuthClientErrorCode.USER_DISABLED, 'The user record is disabled.');\n        }\n        // If no tokens valid after time available, token is not revoked.\n        if (user.tokensValidAfterTime) {\n            // Get the ID token authentication time and convert to milliseconds UTC.\n            const authTimeUtc = decodedIdToken.auth_time * 1000;\n            // Get user tokens valid after time in milliseconds UTC.\n            const validSinceUtc = new Date(user.tokensValidAfterTime).getTime();\n            // Check if authentication time is older than valid since time.\n            if (authTimeUtc < validSinceUtc) {\n                throw new FirebaseAuthError(revocationErrorInfo);\n            }\n        }\n        // All checks above passed. Return the decoded token.\n        return decodedIdToken;\n    }\n}\n", "import { BaseAuth } from './auth';\nimport { AuthApiClient } from './auth-api-requests';\nimport { WorkersKVStore } from './key-store';\nexport { ServiceAccountCredential } from './credential';\nexport { emulatorHost, useEmulator } from './emulator';\nexport * from './errors';\nexport class Auth extends BaseAuth {\n    static instance;\n    static withCredential;\n    constructor(projectId, keyStore, credential) {\n        super(projectId, keyStore, credential);\n    }\n    static getOrInitialize(projectId, keyStore, credential) {\n        if (!Auth.withCredential && credential !== undefined) {\n            Auth.withCredential = new Auth(projectId, keyStore, credential);\n        }\n        if (Auth.withCredential) {\n            return Auth.withCredential;\n        }\n        if (!Auth.instance) {\n            Auth.instance = new Auth(projectId, keyStore);\n        }\n        return Auth.instance;\n    }\n}\nexport class WorkersKVStoreSingle extends WorkersKVStore {\n    static instance;\n    constructor(cacheKey, cfKVNamespace) {\n        super(cacheKey, cfKVNamespace);\n    }\n    static getOrInitialize(cacheKey, cfKVNamespace) {\n        if (!WorkersKVStoreSingle.instance) {\n            WorkersKVStoreSingle.instance = new Map();\n        }\n        const instance = WorkersKVStoreSingle.instance.get(cacheKey);\n        if (instance) {\n            return instance;\n        }\n        const newInstance = new WorkersKVStoreSingle(cacheKey, cfKVNamespace);\n        WorkersKVStoreSingle.instance.set(cacheKey, newInstance);\n        return newInstance;\n    }\n}\nexport class AdminAuthApiClient extends AuthApiClient {\n    static instance;\n    constructor(projectId, credential, retryConfig) {\n        super(projectId, credential, retryConfig);\n    }\n    static getOrInitialize(projectId, credential, retryConfig) {\n        if (!AdminAuthApiClient.instance) {\n            AdminAuthApiClient.instance = new AdminAuthApiClient(projectId, credential, retryConfig);\n        }\n        return AdminAuthApiClient.instance;\n    }\n}\n", "/**\n * Firebase Auth middleware for Cloudflare Workers\n */\n\nimport { Auth } from 'firebase-auth-cloudflare-workers';\nimport { unauthorizedResponse } from '../core/errors.js';\n\n/**\n * Initialize Firebase Auth\n * @param {object} env - Worker environment with Firebase config\n * @returns {Auth} Firebase Auth instance\n */\nfunction getFirebaseAuth(env) {\n\tif (!env.FIREBASE_PROJECT_ID) {\n\t\tthrow new Error('FIREBASE_PROJECT_ID not configured');\n\t}\n\n\treturn Auth.getOrInitialize(\n\t\tenv.FIREBASE_PROJECT_ID,\n\t\tenv.FIREBASE_KEYS || env.KVDB // Use dedicated KV for keys or fallback to main KV\n\t);\n}\n\n/**\n * Verify Firebase ID token\n * @param {string} idToken - Firebase ID token from Authorization header\n * @param {object} env - Worker environment with Firebase config\n * @returns {Promise<object|null>} Decoded token or null if invalid\n */\nexport async function verifyIdToken(idToken, env) {\n\ttry {\n\t\tconst auth = getFirebaseAuth(env);\n\t\tconst decodedToken = await auth.verifyIdToken(idToken);\n\t\treturn decodedToken;\n\t} catch (err) {\n\t\tconsole.error('Token verification error:', err);\n\t\treturn null;\n\t}\n}\n\n/**\n * Require authentication middleware\n * Checks for valid Bearer token in Authorization header\n */\nexport async function requireAuth(request, env) {\n\tconst authHeader = request.headers.get('Authorization');\n\n\tif (!authHeader || !authHeader.startsWith('Bearer ')) {\n\t\treturn {\n\t\t\terror: unauthorizedResponse('Missing or invalid Authorization header'),\n\t\t\tuser: null,\n\t\t};\n\t}\n\n\tconst idToken = authHeader.slice(7); // Remove 'Bearer '\n\n\ttry {\n\t\tconst decodedToken = await verifyIdToken(idToken, env);\n\n\t\tif (!decodedToken) {\n\t\t\treturn {\n\t\t\t\terror: unauthorizedResponse('Invalid token'),\n\t\t\t\tuser: null,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\terror: null,\n\t\t\tuser: {\n\t\t\t\tuserId: decodedToken.uid,\n\t\t\t\temail: decodedToken.email,\n\t\t\t\tname: decodedToken.name,\n\t\t\t\tpicture: decodedToken.picture,\n\t\t\t},\n\t\t};\n\t} catch (err) {\n\t\tconsole.error('Auth verification error:', err);\n\t\treturn {\n\t\t\terror: unauthorizedResponse('Authentication failed'),\n\t\t\tuser: null,\n\t\t};\n\t}\n}\n", "/**\n * Firestore REST API client for Cloudflare Workers\n * Uses REST API instead of Admin SDK (incompatible with Workers)\n */\n\nconst FIRESTORE_API_BASE = 'https://firestore.googleapis.com/v1';\n\n/**\n * Firestore client for CRUD operations\n */\nexport class FirestoreClient {\n\tconstructor(projectId, apiKey) {\n\t\tthis.projectId = projectId;\n\t\tthis.apiKey = apiKey;\n\t\tthis.baseUrl = `${FIRESTORE_API_BASE}/projects/${projectId}/databases/(default)/documents`;\n\t}\n\n\t/**\n\t * Convert JS object to Firestore fields format\n\t */\n\ttoFirestoreFields(obj) {\n\t\tconst fields = {};\n\t\tfor (const [key, value] of Object.entries(obj)) {\n\t\t\tif (value === null || value === undefined) continue;\n\n\t\t\tif (typeof value === 'string') {\n\t\t\t\tfields[key] = { stringValue: value };\n\t\t\t} else if (typeof value === 'number') {\n\t\t\t\tif (Number.isInteger(value)) {\n\t\t\t\t\tfields[key] = { integerValue: value };\n\t\t\t\t} else {\n\t\t\t\t\tfields[key] = { doubleValue: value };\n\t\t\t\t}\n\t\t\t} else if (typeof value === 'boolean') {\n\t\t\t\tfields[key] = { booleanValue: value };\n\t\t\t} else if (value instanceof Date) {\n\t\t\t\tfields[key] = { timestampValue: value.toISOString() };\n\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\tfields[key] = {\n\t\t\t\t\tarrayValue: {\n\t\t\t\t\t\tvalues: value.map(v => this.toFirestoreFields({ v }).v)\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else if (typeof value === 'object') {\n\t\t\t\tfields[key] = {\n\t\t\t\t\tmapValue: {\n\t\t\t\t\t\tfields: this.toFirestoreFields(value)\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn fields;\n\t}\n\n\t/**\n\t * Convert Firestore fields to JS object\n\t */\n\tfromFirestoreFields(fields) {\n\t\tif (!fields) return {};\n\n\t\tconst obj = {};\n\t\tfor (const [key, value] of Object.entries(fields)) {\n\t\t\tif (value.stringValue !== undefined) {\n\t\t\t\tobj[key] = value.stringValue;\n\t\t\t} else if (value.integerValue !== undefined) {\n\t\t\t\tobj[key] = parseInt(value.integerValue);\n\t\t\t} else if (value.doubleValue !== undefined) {\n\t\t\t\tobj[key] = value.doubleValue;\n\t\t\t} else if (value.booleanValue !== undefined) {\n\t\t\t\tobj[key] = value.booleanValue;\n\t\t\t} else if (value.timestampValue !== undefined) {\n\t\t\t\tobj[key] = value.timestampValue;\n\t\t\t} else if (value.arrayValue !== undefined) {\n\t\t\t\tobj[key] = (value.arrayValue.values || []).map(v =>\n\t\t\t\t\tthis.fromFirestoreFields({ temp: v }).temp\n\t\t\t\t);\n\t\t\t} else if (value.mapValue !== undefined) {\n\t\t\t\tobj[key] = this.fromFirestoreFields(value.mapValue.fields);\n\t\t\t}\n\t\t}\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Extract document ID from full path\n\t */\n\textractDocId(path) {\n\t\tconst parts = path.split('/');\n\t\treturn parts[parts.length - 1];\n\t}\n\n\t/**\n\t * Create a document\n\t */\n\tasync createDocument(collection, data) {\n\t\tconst url = `${this.baseUrl}/${collection}?key=${this.apiKey}`;\n\t\tconst fields = this.toFirestoreFields(data);\n\n\t\ttry {\n\t\t\tconst res = await fetch(url, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ fields }),\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\tconst error = await res.text();\n\t\t\t\tthrow new Error(`Firestore create error: ${res.status} - ${error}`);\n\t\t\t}\n\n\t\t\tconst doc = await res.json();\n\t\t\treturn {\n\t\t\t\tid: this.extractDocId(doc.name),\n\t\t\t\t...this.fromFirestoreFields(doc.fields),\n\t\t\t};\n\t\t} catch (err) {\n\t\t\tconsole.error('createDocument error:', err);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t/**\n\t * Get a document by ID\n\t */\n\tasync getDocument(collection, docId) {\n\t\tconst url = `${this.baseUrl}/${collection}/${docId}?key=${this.apiKey}`;\n\n\t\ttry {\n\t\t\tconst res = await fetch(url);\n\n\t\t\tif (res.status === 404) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!res.ok) {\n\t\t\t\tconst error = await res.text();\n\t\t\t\tthrow new Error(`Firestore get error: ${res.status} - ${error}`);\n\t\t\t}\n\n\t\t\tconst doc = await res.json();\n\t\t\treturn {\n\t\t\t\tid: docId,\n\t\t\t\t...this.fromFirestoreFields(doc.fields),\n\t\t\t};\n\t\t} catch (err) {\n\t\t\tconsole.error('getDocument error:', err);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t/**\n\t * Update a document\n\t */\n\tasync updateDocument(collection, docId, data) {\n\t\tconst url = `${this.baseUrl}/${collection}/${docId}?key=${this.apiKey}`;\n\t\tconst fields = this.toFirestoreFields(data);\n\n\t\ttry {\n\t\t\tconst res = await fetch(url, {\n\t\t\t\tmethod: 'PATCH',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ fields }),\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\tconst error = await res.text();\n\t\t\t\tthrow new Error(`Firestore update error: ${res.status} - ${error}`);\n\t\t\t}\n\n\t\t\tconst doc = await res.json();\n\t\t\treturn {\n\t\t\t\tid: docId,\n\t\t\t\t...this.fromFirestoreFields(doc.fields),\n\t\t\t};\n\t\t} catch (err) {\n\t\t\tconsole.error('updateDocument error:', err);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t/**\n\t * Delete a document\n\t */\n\tasync deleteDocument(collection, docId) {\n\t\tconst url = `${this.baseUrl}/${collection}/${docId}?key=${this.apiKey}`;\n\n\t\ttry {\n\t\t\tconst res = await fetch(url, {\n\t\t\t\tmethod: 'DELETE',\n\t\t\t});\n\n\t\t\tif (!res.ok && res.status !== 404) {\n\t\t\t\tconst error = await res.text();\n\t\t\t\tthrow new Error(`Firestore delete error: ${res.status} - ${error}`);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} catch (err) {\n\t\t\tconsole.error('deleteDocument error:', err);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t/**\n\t * Query documents (simplified - filter by one field)\n\t */\n\tasync queryDocuments(collection, filters = {}) {\n\t\t// For complex queries, we'll use runQuery endpoint\n\t\tconst url = `${this.baseUrl}:runQuery?key=${this.apiKey}`;\n\n\t\t// Build structured query\n\t\tconst query = {\n\t\t\tstructuredQuery: {\n\t\t\t\tfrom: [{ collectionId: collection }],\n\t\t\t\twhere: {},\n\t\t\t}\n\t\t};\n\n\t\t// Add filters\n\t\tif (Object.keys(filters).length > 0) {\n\t\t\tconst fieldFilters = [];\n\t\t\tfor (const [field, value] of Object.entries(filters)) {\n\t\t\t\tconst firestoreValue = this.toFirestoreFields({ value }).value;\n\t\t\t\tfieldFilters.push({\n\t\t\t\t\tfieldFilter: {\n\t\t\t\t\t\tfield: { fieldPath: field },\n\t\t\t\t\t\top: 'EQUAL',\n\t\t\t\t\t\tvalue: firestoreValue,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (fieldFilters.length === 1) {\n\t\t\t\tquery.structuredQuery.where = fieldFilters[0];\n\t\t\t} else if (fieldFilters.length > 1) {\n\t\t\t\tquery.structuredQuery.where = {\n\t\t\t\t\tcompositeFilter: {\n\t\t\t\t\t\top: 'AND',\n\t\t\t\t\t\tfilters: fieldFilters,\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tconst res = await fetch(url, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\tbody: JSON.stringify(query),\n\t\t\t});\n\n\t\t\tif (!res.ok) {\n\t\t\t\tconst error = await res.text();\n\t\t\t\tthrow new Error(`Firestore query error: ${res.status} - ${error}`);\n\t\t\t}\n\n\t\t\tconst results = await res.json();\n\n\t\t\tif (!results || results.length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn results\n\t\t\t\t.filter(r => r.document)\n\t\t\t\t.map(r => ({\n\t\t\t\t\tid: this.extractDocId(r.document.name),\n\t\t\t\t\t...this.fromFirestoreFields(r.document.fields),\n\t\t\t\t}));\n\t\t} catch (err) {\n\t\t\tconsole.error('queryDocuments error:', err);\n\t\t\tthrow err;\n\t\t}\n\t}\n}\n", "/**\n * User Tournaments endpoints (protected - requires auth)\n */\n\nimport { requireAuth } from '../middleware/auth.js';\nimport { FirestoreClient } from '../services/firestore.js';\nimport { jsonResponse } from '../core/response.js';\nimport { errorResponse, notFoundResponse, badRequestResponse } from '../core/errors.js';\n\n/**\n * Get Firestore client instance\n */\nfunction getFirestore(env) {\n\tif (!env.FIREBASE_PROJECT_ID || !env.FIREBASE_API_KEY) {\n\t\tthrow new Error('Firebase not configured');\n\t}\n\treturn new FirestoreClient(env.FIREBASE_PROJECT_ID, env.FIREBASE_API_KEY);\n}\n\n/**\n * POST /v1/user/tournaments - Create tournament\n */\nexport async function handleCreateUserTournament(request, env, ctx) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst body = await request.json();\n\n\t\t// Validate required fields\n\t\tif (!body.game || !body.name || !body.format || !body.date) {\n\t\t\treturn badRequestResponse('Missing required fields: game, name, format, date');\n\t\t}\n\n\t\tconst firestore = getFirestore(env);\n\t\tconst now = new Date().toISOString();\n\n\t\tconst tournament = await firestore.createDocument('user_tournaments', {\n\t\t\tuserId: user.userId,\n\t\t\tgame: body.game,\n\t\t\tname: body.name,\n\t\t\tformat: body.format,\n\t\t\tdate: body.date,\n\t\t\tlocation: body.location || null,\n\t\t\timageUrl: body.imageUrl || null,\n\t\t\tdeckName: body.deckName || null,\n\t\t\tdeckImageUrl: body.deckImageUrl || null,\n\t\t\tdecklistUrl: body.decklistUrl || null,\n\t\t\tnotes: body.notes || null,\n\t\t\tcreatedAt: now,\n\t\t\tupdatedAt: now,\n\t\t});\n\n\t\treturn jsonResponse(tournament, { status: 201 });\n\t} catch (err) {\n\t\tconsole.error('handleCreateUserTournament error:', err);\n\t\treturn errorResponse('Failed to create tournament', 500, err.message);\n\t}\n}\n\n/**\n * GET /v1/user/tournaments - List user's tournaments\n */\nexport async function handleListUserTournaments(request, env, ctx) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst url = new URL(request.url);\n\t\tconst game = url.searchParams.get('game');\n\t\tconst limit = parseInt(url.searchParams.get('limit')) || 50;\n\t\tconst offset = parseInt(url.searchParams.get('offset')) || 0;\n\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Query user's tournaments\n\t\tconst filters = { userId: user.userId };\n\t\tif (game) {\n\t\t\tfilters.game = game;\n\t\t}\n\n\t\tconst allTournaments = await firestore.queryDocuments('user_tournaments', filters);\n\n\t\t// Sort by date descending\n\t\tallTournaments.sort((a, b) => new Date(b.date) - new Date(a.date));\n\n\t\t// Pagination\n\t\tconst tournaments = allTournaments.slice(offset, offset + limit);\n\n\t\treturn jsonResponse({\n\t\t\ttournaments,\n\t\t\tcount: tournaments.length,\n\t\t\ttotal: allTournaments.length,\n\t\t\toffset,\n\t\t\tlimit,\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('handleListUserTournaments error:', err);\n\t\treturn errorResponse('Failed to list tournaments', 500, err.message);\n\t}\n}\n\n/**\n * PUT /v1/user/tournaments/:id - Update tournament\n */\nexport async function handleUpdateUserTournament(request, env, ctx, tournamentId) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Verify tournament exists and belongs to user\n\t\tconst existing = await firestore.getDocument('user_tournaments', tournamentId);\n\t\tif (!existing) {\n\t\t\treturn notFoundResponse('Tournament not found');\n\t\t}\n\t\tif (existing.userId !== user.userId) {\n\t\t\treturn errorResponse('Forbidden', 403);\n\t\t}\n\n\t\t// Update tournament\n\t\tconst body = await request.json();\n\t\tconst updates = {\n\t\t\t...body,\n\t\t\tupdatedAt: new Date().toISOString(),\n\t\t};\n\n\t\t// Don't allow changing userId or id\n\t\tdelete updates.userId;\n\t\tdelete updates.id;\n\t\tdelete updates.createdAt;\n\n\t\tconst updated = await firestore.updateDocument('user_tournaments', tournamentId, updates);\n\n\t\treturn jsonResponse(updated);\n\t} catch (err) {\n\t\tconsole.error('handleUpdateUserTournament error:', err);\n\t\treturn errorResponse('Failed to update tournament', 500, err.message);\n\t}\n}\n\n/**\n * DELETE /v1/user/tournaments/:id - Delete tournament\n */\nexport async function handleDeleteUserTournament(request, env, ctx, tournamentId) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Verify tournament exists and belongs to user\n\t\tconst existing = await firestore.getDocument('user_tournaments', tournamentId);\n\t\tif (!existing) {\n\t\t\treturn notFoundResponse('Tournament not found');\n\t\t}\n\t\tif (existing.userId !== user.userId) {\n\t\t\treturn errorResponse('Forbidden', 403);\n\t\t}\n\n\t\t// Delete tournament\n\t\tawait firestore.deleteDocument('user_tournaments', tournamentId);\n\n\t\t// Delete associated matches (cascade delete)\n\t\tconst matches = await firestore.queryDocuments('user_matches', {\n\t\t\ttournamentId: tournamentId,\n\t\t});\n\n\t\tfor (const match of matches) {\n\t\t\tawait firestore.deleteDocument('user_matches', match.id);\n\t\t}\n\n\t\treturn new Response(null, { status: 204 });\n\t} catch (err) {\n\t\tconsole.error('handleDeleteUserTournament error:', err);\n\t\treturn errorResponse('Failed to delete tournament', 500, err.message);\n\t}\n}\n", "/**\n * User Matches endpoints (protected - requires auth)\n */\n\nimport { requireAuth } from '../middleware/auth.js';\nimport { FirestoreClient } from '../services/firestore.js';\nimport { jsonResponse } from '../core/response.js';\nimport { errorResponse, notFoundResponse, badRequestResponse } from '../core/errors.js';\n\n/**\n * Get Firestore client instance\n */\nfunction getFirestore(env) {\n\tif (!env.FIREBASE_PROJECT_ID || !env.FIREBASE_API_KEY) {\n\t\tthrow new Error('Firebase not configured');\n\t}\n\treturn new FirestoreClient(env.FIREBASE_PROJECT_ID, env.FIREBASE_API_KEY);\n}\n\n/**\n * Calculate match statistics\n */\nfunction calculateStats(matches) {\n\tlet wins = 0;\n\tlet losses = 0;\n\tlet ties = 0;\n\n\tmatches.forEach(match => {\n\t\tif (match.result === 'win') wins++;\n\t\telse if (match.result === 'loss') losses++;\n\t\telse if (match.result === 'tie') ties++;\n\t});\n\n\tconst totalGames = wins + losses + ties;\n\tconst winRate = totalGames > 0 ? (wins / totalGames) * 100 : 0;\n\n\treturn {\n\t\twins,\n\t\tlosses,\n\t\tties,\n\t\ttotalGames,\n\t\twinRate: Math.round(winRate * 100) / 100, // Round to 2 decimals\n\t};\n}\n\n/**\n * POST /v1/user/matches - Create match\n */\nexport async function handleCreateUserMatch(request, env, ctx) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst body = await request.json();\n\n\t\t// Validate required fields\n\t\tif (!body.tournamentId || !body.game || !body.round || !body.opponent || !body.opponentDeck || !body.result) {\n\t\t\treturn badRequestResponse('Missing required fields: tournamentId, game, round, opponent, opponentDeck, result');\n\t\t}\n\n\t\tif (!['win', 'loss', 'tie'].includes(body.result)) {\n\t\t\treturn badRequestResponse('Invalid result. Must be: win, loss, or tie');\n\t\t}\n\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Verify tournament exists and belongs to user\n\t\tconst tournament = await firestore.getDocument('user_tournaments', body.tournamentId);\n\t\tif (!tournament) {\n\t\t\treturn notFoundResponse('Tournament not found');\n\t\t}\n\t\tif (tournament.userId !== user.userId) {\n\t\t\treturn errorResponse('Forbidden', 403);\n\t\t}\n\n\t\tconst now = new Date().toISOString();\n\n\t\tconst match = await firestore.createDocument('user_matches', {\n\t\t\tuserId: user.userId,\n\t\t\ttournamentId: body.tournamentId,\n\t\t\tgame: body.game,\n\t\t\tround: body.round,\n\t\t\topponent: body.opponent,\n\t\t\topponentDeck: body.opponentDeck,\n\t\t\topponentDeckImageUrl: body.opponentDeckImageUrl || null,\n\t\t\tresult: body.result,\n\t\t\tmyScore: body.myScore || null,\n\t\t\topponentScore: body.opponentScore || null,\n\t\t\tnotes: body.notes || null,\n\t\t\tcreatedAt: now,\n\t\t\tupdatedAt: now,\n\t\t});\n\n\t\treturn jsonResponse(match, { status: 201 });\n\t} catch (err) {\n\t\tconsole.error('handleCreateUserMatch error:', err);\n\t\treturn errorResponse('Failed to create match', 500, err.message);\n\t}\n}\n\n/**\n * GET /v1/user/matches - List matches for a tournament\n */\nexport async function handleListUserMatches(request, env, ctx) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst url = new URL(request.url);\n\t\tconst tournamentId = url.searchParams.get('tournamentId');\n\n\t\tif (!tournamentId) {\n\t\t\treturn badRequestResponse('Missing required parameter: tournamentId');\n\t\t}\n\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Verify tournament exists and belongs to user\n\t\tconst tournament = await firestore.getDocument('user_tournaments', tournamentId);\n\t\tif (!tournament) {\n\t\t\treturn notFoundResponse('Tournament not found');\n\t\t}\n\t\tif (tournament.userId !== user.userId) {\n\t\t\treturn errorResponse('Forbidden', 403);\n\t\t}\n\n\t\t// Query matches for tournament\n\t\tconst matches = await firestore.queryDocuments('user_matches', {\n\t\t\ttournamentId: tournamentId,\n\t\t});\n\n\t\t// Sort by round ascending\n\t\tmatches.sort((a, b) => a.round - b.round);\n\n\t\t// Calculate stats\n\t\tconst stats = calculateStats(matches);\n\n\t\treturn jsonResponse({\n\t\t\tmatches,\n\t\t\tcount: matches.length,\n\t\t\tstats,\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('handleListUserMatches error:', err);\n\t\treturn errorResponse('Failed to list matches', 500, err.message);\n\t}\n}\n\n/**\n * PUT /v1/user/matches/:id - Update match\n */\nexport async function handleUpdateUserMatch(request, env, ctx, matchId) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Verify match exists and belongs to user\n\t\tconst existing = await firestore.getDocument('user_matches', matchId);\n\t\tif (!existing) {\n\t\t\treturn notFoundResponse('Match not found');\n\t\t}\n\t\tif (existing.userId !== user.userId) {\n\t\t\treturn errorResponse('Forbidden', 403);\n\t\t}\n\n\t\t// Update match\n\t\tconst body = await request.json();\n\t\tconst updates = {\n\t\t\t...body,\n\t\t\tupdatedAt: new Date().toISOString(),\n\t\t};\n\n\t\t// Don't allow changing userId, tournamentId, or id\n\t\tdelete updates.userId;\n\t\tdelete updates.tournamentId;\n\t\tdelete updates.id;\n\t\tdelete updates.createdAt;\n\n\t\tconst updated = await firestore.updateDocument('user_matches', matchId, updates);\n\n\t\treturn jsonResponse(updated);\n\t} catch (err) {\n\t\tconsole.error('handleUpdateUserMatch error:', err);\n\t\treturn errorResponse('Failed to update match', 500, err.message);\n\t}\n}\n\n/**\n * DELETE /v1/user/matches/:id - Delete match\n */\nexport async function handleDeleteUserMatch(request, env, ctx, matchId) {\n\t// Verify auth\n\tconst { error, user } = await requireAuth(request, env);\n\tif (error) return error;\n\n\ttry {\n\t\tconst firestore = getFirestore(env);\n\n\t\t// Verify match exists and belongs to user\n\t\tconst existing = await firestore.getDocument('user_matches', matchId);\n\t\tif (!existing) {\n\t\t\treturn notFoundResponse('Match not found');\n\t\t}\n\t\tif (existing.userId !== user.userId) {\n\t\t\treturn errorResponse('Forbidden', 403);\n\t\t}\n\n\t\t// Delete match\n\t\tawait firestore.deleteDocument('user_matches', matchId);\n\n\t\treturn new Response(null, { status: 204 });\n\t} catch (err) {\n\t\tconsole.error('handleDeleteUserMatch error:', err);\n\t\treturn errorResponse('Failed to delete match', 500, err.message);\n\t}\n}\n", "/**\n * Rate limiting middleware using Cloudflare KV\n */\n\nimport { rateLimitResponse } from '../core/errors.js';\n\nexport async function checkRateLimit(request, env, limit = 100, window = 3600) {\n\tconst ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n\tconst now = Math.floor(Date.now() / 1000);\n\tconst windowKey = Math.floor(now / window);\n\tconst key = `ratelimit:${ip}:${windowKey}`;\n\n\ttry {\n\t\tconst count = await env.KVDB.get(key);\n\t\tconst currentCount = count ? parseInt(count) : 0;\n\n\t\tif (currentCount >= limit) {\n\t\t\tconst retryAfter = window - (now % window);\n\t\t\treturn rateLimitResponse(retryAfter);\n\t\t}\n\n\t\t// Increment counter\n\t\tawait env.KVDB.put(key, String(currentCount + 1), {\n\t\t\texpirationTtl: window,\n\t\t});\n\n\t\treturn null; // OK - no rate limit hit\n\t} catch (err) {\n\t\tconsole.error('Rate limit check error:', err);\n\t\t// On error, allow request through (fail open)\n\t\treturn null;\n\t}\n}\n", "/**\n * TCG Companion Backend - Multi-Game Architecture\n * Cloudflare Worker - Main Router\n */\n\nimport { gameRegistry } from './games/registry.js';\nimport { PokemonAdapter } from './games/pokemon/adapter.js';\nimport { MagicAdapter } from './games/magic/adapter.js';\n\nimport { handleMetaTop } from './routes/meta.js';\nimport { handleTournamentsRecent } from './routes/tournaments.js';\nimport { handleDeckDetails } from './routes/deck.js';\nimport { handleDemo } from './routes/demo.js';\nimport {\n\thandleCreateUserTournament,\n\thandleListUserTournaments,\n\thandleUpdateUserTournament,\n\thandleDeleteUserTournament,\n} from './routes/userTournaments.js';\nimport {\n\thandleCreateUserMatch,\n\thandleListUserMatches,\n\thandleUpdateUserMatch,\n\thandleDeleteUserMatch,\n} from './routes/userMatches.js';\n\nimport { handleCorsOptions } from './middleware/cors.js';\nimport { checkRateLimit } from './middleware/rateLimit.js';\n\nimport { jsonResponse, corsOptionsResponse } from './core/response.js';\nimport { notFoundResponse, methodNotAllowedResponse } from './core/errors.js';\n\n/**\n * Initialize game adapters\n */\nfunction initializeAdapters() {\n\tgameRegistry.register('pokemon', new PokemonAdapter());\n\tgameRegistry.register('magic', new MagicAdapter()); // Stub - Phase 2\n\t// Add more games here in Phase 2\n}\n\n/**\n * Main worker fetch handler\n */\nexport default {\n\tasync fetch(request, env, ctx) {\n\t\t// Initialize game adapters\n\t\tinitializeAdapters();\n\n\t\tconst url = new URL(request.url);\n\t\tconst method = request.method;\n\n\t\t// CORS preflight\n\t\tif (method === 'OPTIONS') {\n\t\t\treturn corsOptionsResponse();\n\t\t}\n\n\t\t// Health check\n\t\tif (url.pathname === '/health' && method === 'GET') {\n\t\t\treturn jsonResponse({ status: 'OK', timestamp: new Date().toISOString() });\n\t\t}\n\n\t\t// Demo page\n\t\tif ((url.pathname === '/' || url.pathname === '/demo') && method === 'GET') {\n\t\t\treturn await handleDemo(request, env, ctx);\n\t\t}\n\n\t\t// Apply rate limiting to API endpoints\n\t\tif (url.pathname.startsWith('/v1/')) {\n\t\t\tconst rateLimitResult = await checkRateLimit(request, env, 100, 3600);\n\t\t\tif (rateLimitResult) {\n\t\t\t\treturn rateLimitResult;\n\t\t\t}\n\t\t}\n\n\t\t// Multi-game routing: /v1/:game/meta/top\n\t\tconst metaTopMatch = url.pathname.match(/^\\/v1\\/([^/]+)\\/meta\\/top$/);\n\t\tif (metaTopMatch && method === 'GET') {\n\t\t\tconst game = metaTopMatch[1].toLowerCase();\n\t\t\treturn await handleMetaTop(request, env, ctx, game);\n\t\t}\n\n\t\t// Multi-game routing: /v1/:game/tournaments/recent\n\t\tconst tournamentsMatch = url.pathname.match(/^\\/v1\\/([^/]+)\\/tournaments\\/recent$/);\n\t\tif (tournamentsMatch && method === 'GET') {\n\t\t\tconst game = tournamentsMatch[1].toLowerCase();\n\t\t\treturn await handleTournamentsRecent(request, env, ctx, game);\n\t\t}\n\n\t\t// Multi-game routing: /v1/:game/meta/deck/:deckName\n\t\tconst deckDetailsMatch = url.pathname.match(/^\\/v1\\/([^/]+)\\/meta\\/deck\\/([^/]+)$/);\n\t\tif (deckDetailsMatch && method === 'GET') {\n\t\t\tconst game = deckDetailsMatch[1].toLowerCase();\n\t\t\tconst deckName = deckDetailsMatch[2];\n\t\t\treturn await handleDeckDetails(request, env, ctx, game, deckName);\n\t\t}\n\n\t\t// Backward compatibility: /v1/meta/top \u2192 /v1/pokemon/meta/top\n\t\tif (url.pathname === '/v1/meta/top' && method === 'GET') {\n\t\t\treturn await handleMetaTop(request, env, ctx, 'pokemon');\n\t\t}\n\n\t\t// Backward compatibility: /v1/tournaments/recent \u2192 /v1/pokemon/tournaments/recent\n\t\tif (url.pathname === '/v1/tournaments/recent' && method === 'GET') {\n\t\t\treturn await handleTournamentsRecent(request, env, ctx, 'pokemon');\n\t\t}\n\n\t\t// Backward compatibility: /v1/meta/deck/:deckName \u2192 /v1/pokemon/meta/deck/:deckName\n\t\tconst legacyDeckMatch = url.pathname.match(/^\\/v1\\/meta\\/deck\\/([^/]+)$/);\n\t\tif (legacyDeckMatch && method === 'GET') {\n\t\t\tconst deckName = legacyDeckMatch[1];\n\t\t\treturn await handleDeckDetails(request, env, ctx, 'pokemon', deckName);\n\t\t}\n\n\t\t// User Tournaments endpoints (protected)\n\t\tif (url.pathname === '/v1/user/tournaments') {\n\t\t\tif (method === 'POST') {\n\t\t\t\treturn await handleCreateUserTournament(request, env, ctx);\n\t\t\t}\n\t\t\tif (method === 'GET') {\n\t\t\t\treturn await handleListUserTournaments(request, env, ctx);\n\t\t\t}\n\t\t\treturn methodNotAllowedResponse(['GET', 'POST']);\n\t\t}\n\n\t\tconst tournamentIdMatch = url.pathname.match(/^\\/v1\\/user\\/tournaments\\/([^/]+)$/);\n\t\tif (tournamentIdMatch) {\n\t\t\tconst tournamentId = tournamentIdMatch[1];\n\t\t\tif (method === 'PUT') {\n\t\t\t\treturn await handleUpdateUserTournament(request, env, ctx, tournamentId);\n\t\t\t}\n\t\t\tif (method === 'DELETE') {\n\t\t\t\treturn await handleDeleteUserTournament(request, env, ctx, tournamentId);\n\t\t\t}\n\t\t\treturn methodNotAllowedResponse(['PUT', 'DELETE']);\n\t\t}\n\n\t\t// User Matches endpoints (protected)\n\t\tif (url.pathname === '/v1/user/matches') {\n\t\t\tif (method === 'POST') {\n\t\t\t\treturn await handleCreateUserMatch(request, env, ctx);\n\t\t\t}\n\t\t\tif (method === 'GET') {\n\t\t\t\treturn await handleListUserMatches(request, env, ctx);\n\t\t\t}\n\t\t\treturn methodNotAllowedResponse(['GET', 'POST']);\n\t\t}\n\n\t\tconst matchIdMatch = url.pathname.match(/^\\/v1\\/user\\/matches\\/([^/]+)$/);\n\t\tif (matchIdMatch) {\n\t\t\tconst matchId = matchIdMatch[1];\n\t\t\tif (method === 'PUT') {\n\t\t\t\treturn await handleUpdateUserMatch(request, env, ctx, matchId);\n\t\t\t}\n\t\t\tif (method === 'DELETE') {\n\t\t\t\treturn await handleDeleteUserMatch(request, env, ctx, matchId);\n\t\t\t}\n\t\t\treturn methodNotAllowedResponse(['PUT', 'DELETE']);\n\t\t}\n\n\t\t// Not found\n\t\treturn notFoundResponse('Endpoint not found');\n\t},\n};\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\src\\\\index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\src\\\\index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\.wrangler\\\\tmp\\\\bundle-GaryF3\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\.wrangler\\\\tmp\\\\bundle-GaryF3\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\.wrangler\\\\tmp\\\\bundle-GaryF3\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": ["version", "JwtErrorCode", "err", "MultiFactorId", "byteLength", "getFirestore"]
}
