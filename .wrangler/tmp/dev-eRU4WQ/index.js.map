{
  "version": 3,
  "sources": ["../../../src/index.js", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-ROlSmn/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-ROlSmn/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\yagod\\Documents\\Proyectos\\TCGServer\\.wrangler\\tmp\\dev-eRU4WQ",
  "sourcesContent": ["/**\n * Pok\u00E9mon TCG Companion Backend\n * Cloudflare Worker - Public API Layer\n */\n\nconst LIMITLESS_API_BASE = 'https://play.limitlesstcg.com/api';\nconst POKEMONTCG_API = 'https://api.pokemontcg.io/v2';\n\n// Cache for card images to avoid repeated lookups\nconst imageCache = new Map();\n\n/**\n * Fetch tournaments from Limitless API\n */\nasync function fetchTournaments(days = 7, format = 'standard', limit = 50) {\n\tconst now = new Date();\n\tconst startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n\n\tconst params = new URLSearchParams({\n\t\tgame: 'PTCG',\n\t\tformat: format.toUpperCase(),\n\t\tlimit,\n\t\tpage: 0,\n\t});\n\n\ttry {\n\t\tconst res = await fetch(`${LIMITLESS_API_BASE}/tournaments?${params}`);\n\t\tif (!res.ok) throw new Error(`API error: ${res.status}`);\n\n\t\tconst data = await res.json();\n\t\t// Filter tournaments from last N days\n\t\t// API returns array directly, not wrapped in .tournaments\n\t\treturn (Array.isArray(data) ? data : data.tournaments || []).filter(t => {\n\t\t\tconst tDate = new Date(t.date);\n\t\t\treturn tDate >= startDate;\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('fetchTournaments error:', err);\n\t\tthrow err;\n\t}\n}\n\n/**\n * Fetch standings for a specific tournament (with retries on rate limit)\n */\nasync function fetchStandings(tournamentId, retries = 3) {\n\tfor (let i = 0; i < retries; i++) {\n\t\ttry {\n\t\t\tconst res = await fetch(`${LIMITLESS_API_BASE}/tournaments/${tournamentId}/standings`);\n\n\t\t\t// Check for rate limit\n\t\t\tif (res.status === 429) {\n\t\t\t\tconst retryAfter = res.headers.get('Retry-After');\n\t\t\t\tconst delay = retryAfter ? parseInt(retryAfter) * 1000 : (1000 * Math.pow(2, i));\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, delay));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!res.ok) throw new Error(`API error: ${res.status}`);\n\t\t\treturn await res.json();\n\t\t} catch (err) {\n\t\t\tif (i === retries - 1) {\n\t\t\t\tconsole.error(`fetchStandings(${tournamentId}) failed after ${retries} retries:`, err);\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));\n\t\t}\n\t}\n\treturn [];\n}\n\n/**\n * Extract main card from deck (prioritize \"ex\" cards, then first pokemon)\n */\nfunction extractMainCard(decklist) {\n\tif (!decklist || !decklist.pokemon || decklist.pokemon.length === 0) {\n\t\treturn null;\n\t}\n\n\t// First, try to find an \"ex\" card\n\tconst exCard = decklist.pokemon.find(card => card.name && card.name.includes('ex'));\n\tif (exCard) {\n\t\treturn { name: exCard.name, set: exCard.set, number: exCard.number };\n\t}\n\n\t// Otherwise, return first pokemon\n\tconst firstCard = decklist.pokemon[0];\n\treturn { name: firstCard.name, set: firstCard.set, number: firstCard.number };\n}\n\n/**\n * Get card image URL using Limitless CDN (no API call needed)\n * URL format: https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com/tpci/[SET]/[SET]_[CARD_ID]_R_EN_[SIZE].png\n */\nfunction getCardImageUrl(cardSet, cardNumber, size = 'SM') {\n\tif (!cardSet || !cardNumber) return null;\n\tconst url = `https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com/tpci/${cardSet}/${cardSet}_${cardNumber}_R_EN_${size}.png`;\n\treturn url;\n}\n\n/**\n * Get Pokemon artwork URL from PokemonTCG.io CDN\n */\nfunction getPokemonImageUrl(iconName) {\n\t// Use PokemonTCG.io CDN which has reliable card artwork\n\t// Format: https://images.pokemontcg.io/[setId]/[cardNumber]_hires.png\n\t// For now, return null as we'll use card images instead\n\treturn null;\n}\n\n/**\n * Get set color/brand - returns a color code for each Pokemon TCG set\n * Used for visual identification instead of images\n */\nfunction getSetColor(cardSet) {\n\tconst setColors = {\n\t\t// Current era\n\t\t'TWM': '#8B4789', // Twilight Masquerade - Purple\n\t\t'PRE': '#22B14C', // Primal Energy - Green\n\t\t'OBF': '#FF8C00', // Obsidian Flames - Orange\n\t\t'PAL': '#1E90FF', // Paldean Fates - Blue\n\t\t'SVI': '#DC143C', // Scarlet & Violet - Red\n\t\t'MEG': '#FFD700', // Magneton Meta - Gold\n\t\t'TEF': '#20B2AA', // Temporal Forces - Teal\n\t\t'ASC': '#9370DB', // Ancient Roar - Indigo\n\t\t'DRI': '#FF6347', // Dragon Tera - Coral\n\t\t'MEW': '#00CED1', // Mewtwo - Cyan\n\t\t'PAF': '#FF69B4', // Paldean Future - Pink\n\t\t'PFL': '#8B7355', // Paldean Fates - Brown\n\t\t'SCR': '#4169E1', // Scarlet - Royal Blue\n\t\t'SLV': '#C0C0C0', // Silver - Silver\n\t\t'SHF': '#FF4500', // Shining Fates - Red-Orange\n\t\t'SVP': '#DA70D6', // Sword/Shield Purple\n\t};\n\n\treturn setColors[cardSet.toUpperCase()] || '#808080'; // Default gray\n}\n\n/**\n * Enhance card list with images from Limitless CDN\n */\nfunction enhanceCardListWithImages(decklist) {\n\tif (!decklist) return decklist;\n\n\tconst enhanced = { ...decklist };\n\n\t// Function to add images to cards\n\tconst addImagesToCards = (cards) => {\n\t\tif (!Array.isArray(cards)) return cards;\n\n\t\treturn cards.map(card => {\n\t\t\t// Use Limitless CDN for images - construct URL directly from card set and number\n\t\t\t// Only add image if set and number are valid\n\t\t\tif (card.set && card.number) {\n\t\t\t\tcard.image = getCardImageUrl(card.set, card.number, 'SM');\n\t\t\t}\n\t\t\treturn card;\n\t\t});\n\t};\n\n\t// Add images to all card types\n\tif (enhanced.pokemon) {\n\t\tenhanced.pokemon = addImagesToCards(enhanced.pokemon);\n\t}\n\tif (enhanced.trainer) {\n\t\tenhanced.trainer = addImagesToCards(enhanced.trainer);\n\t}\n\tif (enhanced.energy) {\n\t\tenhanced.energy = addImagesToCards(enhanced.energy);\n\t}\n\n\treturn enhanced;\n}\n\n/**\n * Aggregate decks from standings with main card info\n */\nasync function aggregateDecks(standingsArray) {\n\tconst deckMap = {};\n\n\t// Aggregate deck info\n\tstandingsArray.forEach(standing => {\n\t\tif (standing.deck && standing.deck.name) {\n\t\t\tconst deckName = standing.deck.name;\n\t\t\tif (!deckMap[deckName]) {\n\t\t\t\tdeckMap[deckName] = {\n\t\t\t\t\tname: deckName,\n\t\t\t\t\tcount: 0,\n\t\t\t\t\tmainCard: extractMainCard(standing.decklist),\n\t\t\t\t\tdeckId: standing.deck.id,\n\t\t\t\t\ticons: standing.deck.icons || [],\n\t\t\t\t};\n\t\t\t}\n\t\t\tdeckMap[deckName].count++;\n\t\t}\n\t});\n\n\t// Add URLs and images for visual identification\n\tObject.values(deckMap).forEach(deck => {\n\t\tif (deck.mainCard) {\n\t\t\tdeck.setColor = getSetColor(deck.mainCard.set);\n\t\t\tdeck.setCode = deck.mainCard.set;\n\t\t\t// Use main card image from Limitless CDN\n\t\t\tdeck.image = getCardImageUrl(deck.mainCard.set, deck.mainCard.number, 'LG');\n\t\t}\n\t\t// Limitless deck URL\n\t\tdeck.deckUrl = `https://play.limitlesstcg.com/deck/${deck.deckId}`;\n\t});\n\n\tconst decks = Object.values(deckMap);\n\n\t// Sort by count descending\n\treturn decks.sort((a, b) => b.count - a.count);\n}\n\n/**\n * GET /v1/meta/top - Return top meta decks\n */\nasync function handleMetaTop(request, env, ctx) {\n\tconst url = new URL(request.url);\n\tconst days = parseInt(url.searchParams.get('days')) || 7;\n\tconst format = (url.searchParams.get('format') || 'standard').toLowerCase();\n\tconst limit = parseInt(url.searchParams.get('limit')) || 10;\n\n\t// Cache key\n\tconst cacheKey = `meta:top:${format}:${days}:${limit}`;\n\n\ttry {\n\t\t// Check cache first\n\t\tconst cached = await env.KVDB.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn new Response(cached, {\n\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Cache': 'HIT' },\n\t\t\t});\n\t\t}\n\n\t\t// Fetch tournaments\n\t\tconst tournaments = await fetchTournaments(days, format, 50);\n\n\t\tif (tournaments.length === 0) {\n\t\t\treturn new Response(JSON.stringify({\n\t\t\t\tupdated_at: new Date().toISOString(),\n\t\t\t\tformat,\n\t\t\t\tdays,\n\t\t\t\tdecks: [],\n\t\t\t\tmessage: 'No tournaments found'\n\t\t\t}), {\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t});\n\t\t}\n\n\t\t// MVP: Process only first 5 tournaments to avoid rate limiting and be faster\n\t\t// In production, this would be better with pagination or background jobs\n\t\tconst tournamentsToProcess = tournaments.slice(0, 5);\n\n\t\t// Fetch standings for each tournament with delays\n\t\tconst allStandings = [];\n\t\tfor (let i = 0; i < tournamentsToProcess.length; i++) {\n\t\t\tconst tournament = tournamentsToProcess[i];\n\t\t\tconst standings = await fetchStandings(tournament.id);\n\t\t\tallStandings.push(...standings);\n\n\t\t\t// Delay between requests to respect rate limiting (MVP: 500ms)\n\t\t\tif (i < tournamentsToProcess.length - 1) {\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 500));\n\t\t\t}\n\t\t}\n\n\t\t// Aggregate and sort decks (now async to fetch images)\n\t\tconst allDecks = await aggregateDecks(allStandings);\n\t\tconst decks = allDecks.slice(0, limit);\n\n\t\tconst response = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t\tformat,\n\t\t\tdays,\n\t\t\tdecks,\n\t\t};\n\n\t\tconst responseJson = JSON.stringify(response);\n\n\t\t// Cache for 12 hours (43200 seconds)\n\t\tctx.waitUntil(env.KVDB.put(cacheKey, responseJson, { expirationTtl: 43200 }));\n\n\t\treturn new Response(responseJson, {\n\t\t\theaders: { 'Content-Type': 'application/json', 'X-Cache': 'MISS' },\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('handleMetaTop error:', err);\n\t\treturn new Response(JSON.stringify({\n\t\t\terror: 'Internal server error',\n\t\t\tmessage: err.message,\n\t\t}), {\n\t\t\tstatus: 500,\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t});\n\t}\n}\n\n/**\n * GET /v1/tournaments/recent - Return recent tournaments\n */\nasync function handleTournamentsRecent(request, env, ctx) {\n\tconst url = new URL(request.url);\n\tconst days = parseInt(url.searchParams.get('days')) || 7;\n\tconst format = (url.searchParams.get('format') || 'standard').toLowerCase();\n\tconst limit = parseInt(url.searchParams.get('limit')) || 50;\n\n\tconst cacheKey = `tournaments:recent:${format}:${days}:${limit}`;\n\n\ttry {\n\t\tconst cached = await env.KVDB.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn new Response(cached, {\n\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Cache': 'HIT' },\n\t\t\t});\n\t\t}\n\n\t\tconst tournaments = await fetchTournaments(days, format, limit);\n\n\t\tconst response = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t\tformat,\n\t\t\tdays,\n\t\t\tcount: tournaments.length,\n\t\t\ttournaments: tournaments.map(t => ({\n\t\t\t\tid: t.id,\n\t\t\t\tname: t.name,\n\t\t\t\tdate: t.date,\n\t\t\t\tplayers: t.players || 0,\n\t\t\t\tformat: t.format,\n\t\t\t})),\n\t\t};\n\n\t\tconst responseJson = JSON.stringify(response);\n\t\tctx.waitUntil(env.KVDB.put(cacheKey, responseJson, { expirationTtl: 21600 }));\n\n\t\treturn new Response(responseJson, {\n\t\t\theaders: { 'Content-Type': 'application/json', 'X-Cache': 'MISS' },\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('handleTournamentsRecent error:', err);\n\t\treturn new Response(JSON.stringify({\n\t\t\terror: 'Internal server error',\n\t\t\tmessage: err.message,\n\t\t}), {\n\t\t\tstatus: 500,\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t});\n\t}\n}\n\n/**\n * Fetch deck details by aggregating tournament standings\n */\nasync function fetchDeckDetails(deckName, days = 7, format = 'standard') {\n\tconst tournaments = await fetchTournaments(days, format, 50);\n\n\tif (tournaments.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst deckInfo = {\n\t\tname: deckName,\n\t\tappearances: 0,\n\t\ttopPlacements: [],\n\t\tcardList: null,\n\t\tmainCard: null,\n\t};\n\n\tconst tournamentsToProcess = tournaments.slice(0, 5);\n\n\tfor (let i = 0; i < tournamentsToProcess.length; i++) {\n\t\tconst tournament = tournamentsToProcess[i];\n\t\tconst standings = await fetchStandings(tournament.id);\n\n\t\tstandings.forEach(standing => {\n\t\t\tif (standing.deck && standing.deck.name === deckName) {\n\t\t\t\tdeckInfo.appearances++;\n\n\t\t\t\tif (standing.placing <= 8) {\n\t\t\t\t\tdeckInfo.topPlacements.push({\n\t\t\t\t\t\tplacing: standing.placing,\n\t\t\t\t\t\tplayer: standing.name,\n\t\t\t\t\t\ttournament: tournament.name,\n\t\t\t\t\t\tdate: tournament.date,\n\t\t\t\t\t\trecord: standing.record,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (standing.decklist && !deckInfo.cardList) {\n\t\t\t\t\tdeckInfo.cardList = standing.decklist;\n\t\t\t\t\tdeckInfo.mainCard = extractMainCard(standing.decklist);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (i < tournamentsToProcess.length - 1) {\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 500));\n\t\t}\n\t}\n\n\t// Enhance card list with images if we found one\n\tif (deckInfo.cardList) {\n\t\tdeckInfo.cardList = enhanceCardListWithImages(deckInfo.cardList);\n\t}\n\n\treturn deckInfo.appearances > 0 ? deckInfo : null;\n}\n\n/**\n * GET /v1/meta/deck/:deckName - Get detailed deck info\n */\nasync function handleDeckDetails(request, env, ctx, deckName) {\n\tconst url = new URL(request.url);\n\tconst days = parseInt(url.searchParams.get('days')) || 7;\n\tconst format = (url.searchParams.get('format') || 'standard').toLowerCase();\n\n\tconst decodedDeckName = decodeURIComponent(deckName);\n\tconst cacheKey = `deck:${decodedDeckName}:${format}:${days}`;\n\n\ttry {\n\t\tconst cached = await env.KVDB.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn new Response(cached, {\n\t\t\t\theaders: { 'Content-Type': 'application/json', 'X-Cache': 'HIT' },\n\t\t\t});\n\t\t}\n\n\t\tconst deckInfo = await fetchDeckDetails(decodedDeckName, days, format);\n\n\t\tif (!deckInfo) {\n\t\t\treturn new Response(JSON.stringify({\n\t\t\t\terror: 'Deck not found',\n\t\t\t\tmessage: `No recent data found for deck: ${decodedDeckName}`,\n\t\t\t}), {\n\t\t\t\tstatus: 404,\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t});\n\t\t}\n\n\t\tif (deckInfo.mainCard) {\n\t\t\tdeckInfo.setColor = getSetColor(deckInfo.mainCard.set);\n\t\t\tdeckInfo.setCode = deckInfo.mainCard.set;\n\t\t}\n\n\t\tconst response = {\n\t\t\tupdated_at: new Date().toISOString(),\n\t\t\tformat,\n\t\t\tdays,\n\t\t\tdeck: deckInfo,\n\t\t};\n\n\t\tconst responseJson = JSON.stringify(response);\n\t\tctx.waitUntil(env.KVDB.put(cacheKey, responseJson, { expirationTtl: 43200 }));\n\n\t\treturn new Response(responseJson, {\n\t\t\theaders: { 'Content-Type': 'application/json', 'X-Cache': 'MISS' },\n\t\t});\n\t} catch (err) {\n\t\tconsole.error('handleDeckDetails error:', err);\n\t\treturn new Response(JSON.stringify({\n\t\t\terror: 'Internal server error',\n\t\t\tmessage: err.message,\n\t\t}), {\n\t\t\tstatus: 500,\n\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t});\n\t}\n}\n\n/**\n * Generate demo HTML page\n */\nfunction generateDemoHTML() {\n\treturn `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t<title>Pokemon TCG Meta - Demo</title>\n\t<style>\n\t\t* { margin: 0; padding: 0; box-sizing: border-box; }\n\t\tbody {\n\t\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n\t\t\tmin-height: 100vh;\n\t\t\tpadding: 20px;\n\t\t\tcolor: #333;\n\t\t}\n\t\t.container { max-width: 1200px; margin: 0 auto; }\n\t\theader {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 30px;\n\t\t\tmargin-bottom: 30px;\n\t\t\tbox-shadow: 0 4px 6px rgba(0,0,0,0.1);\n\t\t}\n\t\th1 { color: #667eea; margin-bottom: 10px; }\n\t\t.subtitle { color: #666; font-size: 14px; }\n\t\t.controls {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 20px;\n\t\t\tmargin-bottom: 30px;\n\t\t\tbox-shadow: 0 4px 6px rgba(0,0,0,0.1);\n\t\t\tdisplay: flex;\n\t\t\tgap: 15px;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-items: flex-end;\n\t\t}\n\t\t.control-group {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tgap: 5px;\n\t\t}\n\t\tlabel {\n\t\t\tfont-size: 12px;\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #666;\n\t\t\ttext-transform: uppercase;\n\t\t}\n\t\tselect, input {\n\t\t\tpadding: 8px 12px;\n\t\t\tborder: 2px solid #e0e0e0;\n\t\t\tborder-radius: 6px;\n\t\t\tfont-size: 14px;\n\t\t}\n\t\tselect:focus, input:focus {\n\t\t\toutline: none;\n\t\t\tborder-color: #667eea;\n\t\t}\n\t\tbutton {\n\t\t\tpadding: 10px 20px;\n\t\t\tbackground: #667eea;\n\t\t\tcolor: white;\n\t\t\tborder: none;\n\t\t\tborder-radius: 6px;\n\t\t\tfont-weight: 600;\n\t\t\tcursor: pointer;\n\t\t}\n\t\tbutton:hover { background: #5568d3; }\n\t\tbutton:disabled { background: #ccc; cursor: not-allowed; }\n\t\t.section {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 25px;\n\t\t\tmargin-bottom: 30px;\n\t\t\tbox-shadow: 0 4px 6px rgba(0,0,0,0.1);\n\t\t}\n\t\th2 { color: #667eea; margin-bottom: 20px; font-size: 22px; }\n\t\t.loading { text-align: center; padding: 40px; color: #999; }\n\t\t.error {\n\t\t\tbackground: #fee;\n\t\t\tborder: 2px solid #fcc;\n\t\t\tborder-radius: 8px;\n\t\t\tpadding: 15px;\n\t\t\tcolor: #c33;\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t\t.deck-grid {\n\t\t\tdisplay: grid;\n\t\t\tgrid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n\t\t\tgap: 20px;\n\t\t}\n\t\t.deck-card {\n\t\t\tbackground: #f8f9fa;\n\t\t\tborder-radius: 10px;\n\t\t\tpadding: 15px;\n\t\t\tcursor: pointer;\n\t\t\tborder: 2px solid transparent;\n\t\t\ttransition: all 0.2s;\n\t\t}\n\t\t.deck-card:hover {\n\t\t\ttransform: translateY(-4px);\n\t\t\tbox-shadow: 0 6px 12px rgba(0,0,0,0.15);\n\t\t\tborder-color: #667eea;\n\t\t}\n\t\t.deck-image {\n\t\t\twidth: 100%;\n\t\t\theight: 200px;\n\t\t\tobject-fit: contain;\n\t\t\tborder-radius: 8px;\n\t\t\tmargin-bottom: 12px;\n\t\t\tbackground: white;\n\t\t}\n\t\t.deck-name { font-weight: 600; font-size: 16px; margin-bottom: 8px; }\n\t\t.deck-count { color: #667eea; font-size: 14px; font-weight: 600; }\n\t\t.tournament-list { display: flex; flex-direction: column; gap: 12px; }\n\t\t.tournament-item {\n\t\t\tbackground: #f8f9fa;\n\t\t\tpadding: 15px;\n\t\t\tborder-radius: 8px;\n\t\t\tborder-left: 4px solid #667eea;\n\t\t}\n\t\t.tournament-name { font-weight: 600; margin-bottom: 5px; }\n\t\t.tournament-meta { font-size: 13px; color: #666; }\n\t\t.modal {\n\t\t\tdisplay: none;\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tbackground: rgba(0,0,0,0.7);\n\t\t\tz-index: 1000;\n\t\t\tpadding: 20px;\n\t\t\toverflow-y: auto;\n\t\t}\n\t\t.modal.active {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t}\n\t\t.modal-content {\n\t\t\tbackground: white;\n\t\t\tborder-radius: 12px;\n\t\t\tpadding: 30px;\n\t\t\tmax-width: 900px;\n\t\t\twidth: 100%;\n\t\t\tmax-height: 90vh;\n\t\t\toverflow-y: auto;\n\t\t\tposition: relative;\n\t\t}\n\t\t.close-modal {\n\t\t\tposition: absolute;\n\t\t\ttop: 15px;\n\t\t\tright: 15px;\n\t\t\tbackground: #f0f0f0;\n\t\t\tborder: none;\n\t\t\twidth: 32px;\n\t\t\theight: 32px;\n\t\t\tborder-radius: 50%;\n\t\t\tcursor: pointer;\n\t\t\tfont-size: 20px;\n\t\t}\n\t\t.close-modal:hover { background: #e0e0e0; }\n\t\t.card-section { margin-bottom: 25px; }\n\t\t.card-section h3 { color: #667eea; margin-bottom: 12px; font-size: 16px; text-transform: uppercase; }\n\t\t.card-list { display: flex; flex-direction: column; gap: 8px; }\n\t\t.card-item {\n\t\t\tbackground: #f8f9fa;\n\t\t\tpadding: 10px 15px;\n\t\t\tborder-radius: 6px;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t\tgap: 15px;\n\t\t}\n\t\t.card-image-thumb {\n\t\t\twidth: 50px;\n\t\t\theight: 70px;\n\t\t\tborder-radius: 4px;\n\t\t\tbackground: white;\n\t\t\tborder: 1px solid #ddd;\n\t\t\tflex-shrink: 0;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\toverflow: hidden;\n\t\t}\n\t\t.card-image-thumb img {\n\t\t\tmax-width: 100%;\n\t\t\tmax-height: 100%;\n\t\t\tobject-fit: contain;\n\t\t}\n\t\t.card-count {\n\t\t\tbackground: #667eea;\n\t\t\tcolor: white;\n\t\t\tpadding: 4px 10px;\n\t\t\tborder-radius: 12px;\n\t\t\tfont-size: 12px;\n\t\t\tfont-weight: 600;\n\t\t}\n\t\t.cache-badge {\n\t\t\tdisplay: inline-block;\n\t\t\tpadding: 4px 8px;\n\t\t\tborder-radius: 4px;\n\t\t\tfont-size: 11px;\n\t\t\tfont-weight: 600;\n\t\t\tmargin-left: 10px;\n\t\t}\n\t\t.cache-hit { background: #d4edda; color: #155724; }\n\t\t.cache-miss { background: #fff3cd; color: #856404; }\n\t</style>\n</head>\n<body>\n\t<div class=\"container\">\n\t\t<header>\n\t\t\t<h1>Pokemon TCG Meta Dashboard</h1>\n\t\t\t<p class=\"subtitle\">Live tournament data powered by Cloudflare Workers + Limitless API</p>\n\t\t</header>\n\n\t\t<div class=\"controls\">\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Days</label>\n\t\t\t\t<select id=\"days\">\n\t\t\t\t\t<option value=\"3\">Last 3 Days</option>\n\t\t\t\t\t<option value=\"7\" selected>Last 7 Days</option>\n\t\t\t\t\t<option value=\"14\">Last 14 Days</option>\n\t\t\t\t\t<option value=\"30\">Last 30 Days</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Format</label>\n\t\t\t\t<select id=\"format\">\n\t\t\t\t\t<option value=\"standard\" selected>Standard</option>\n\t\t\t\t\t<option value=\"expanded\">Expanded</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div class=\"control-group\">\n\t\t\t\t<label>Limit</label>\n\t\t\t\t<input type=\"number\" id=\"limit\" value=\"10\" min=\"5\" max=\"20\">\n\t\t\t</div>\n\n\t\t\t<button id=\"refreshBtn\" onclick=\"loadData()\">Refresh Data</button>\n\t\t</div>\n\n\t\t<div id=\"errorContainer\"></div>\n\n\t\t<div class=\"section\">\n\t\t\t<h2>Top Meta Decks <span id=\"metaCacheBadge\"></span></h2>\n\t\t\t<div id=\"metaDecks\" class=\"loading\">Loading...</div>\n\t\t</div>\n\n\t\t<div class=\"section\">\n\t\t\t<h2>Recent Tournaments <span id=\"tournamentCacheBadge\"></span></h2>\n\t\t\t<div id=\"tournaments\" class=\"loading\">Loading...</div>\n\t\t</div>\n\t</div>\n\n\t<div id=\"deckModal\" class=\"modal\">\n\t\t<div class=\"modal-content\">\n\t\t\t<button class=\"close-modal\" onclick=\"closeModal()\">&times;</button>\n\t\t\t<div id=\"modalContent\"></div>\n\t\t</div>\n\t</div>\n\n\t<script>\n\t\tasync function loadData() {\n\t\t\tconst days = document.getElementById('days').value;\n\t\t\tconst format = document.getElementById('format').value;\n\t\t\tconst limit = document.getElementById('limit').value;\n\t\t\tconst refreshBtn = document.getElementById('refreshBtn');\n\n\t\t\trefreshBtn.disabled = true;\n\t\t\tdocument.getElementById('errorContainer').innerHTML = '';\n\n\t\t\ttry {\n\t\t\t\tawait Promise.all([\n\t\t\t\t\tloadMetaDecks(days, format, limit),\n\t\t\t\t\tloadTournaments(days, format)\n\t\t\t\t]);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error loading data:', error);\n\t\t\t\tshowError('Failed to load data: ' + error.message);\n\t\t\t} finally {\n\t\t\t\trefreshBtn.disabled = false;\n\t\t\t}\n\t\t}\n\n\t\tasync function loadMetaDecks(days, format, limit) {\n\t\t\tconst container = document.getElementById('metaDecks');\n\t\t\tcontainer.innerHTML = '<div class=\"loading\">Loading meta decks...</div>';\n\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\\`/v1/meta/top?days=\\${days}&format=\\${format}&limit=\\${limit}\\`);\n\t\t\t\tif (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n\n\t\t\t\tconst cacheStatus = res.headers.get('X-Cache');\n\t\t\t\tupdateCacheBadge('metaCacheBadge', cacheStatus);\n\n\t\t\t\tconst data = await res.json();\n\n\t\t\t\tif (data.decks.length === 0) {\n\t\t\t\t\tcontainer.innerHTML = '<p class=\"loading\">No decks found for this period.</p>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer.innerHTML = '';\n\t\t\t\tconst grid = document.createElement('div');\n\t\t\t\tgrid.className = 'deck-grid';\n\n\t\t\t\tdata.decks.forEach((deck, index) => {\n\t\t\t\t\tconst card = document.createElement('div');\n\t\t\t\t\tcard.className = 'deck-card';\n\t\t\t\t\tcard.onclick = () => showDeckDetails(deck.name, days, format);\n\n\t\t\t\t\tconst setColor = deck.setColor || '#808080';\n\t\t\t\t\tconst deckUrl = deck.deckUrl || '#';\n\t\t\t\t\tconst deckName = deck.name || 'Unknown';\n\t\t\t\t\tconst deckCount = deck.count || 0;\n\t\t\t\t\tconst setCode = deck.setCode || 'Unknown';\n\n\t\t\t\t\tlet imageHtml = '';\n\t\t\t\t\tif (deck.image) {\n\t\t\t\t\t\timageHtml = '<img src=\"' + deck.image + '\" alt=\"' + deckName + '\" style=\"height: 100%; width: auto; object-fit: contain;\" onerror=\"this.style.display=\\'none\\'\">';\n\t\t\t\t\t} else {\n\t\t\t\t\t\timageHtml = '<span style=\"color: white; font-size: 12px; font-weight: bold; text-transform: uppercase;\">' + setCode + '</span>';\n\t\t\t\t\t}\n\n\t\t\t\t\tcard.innerHTML = '<div class=\"deck-image\" style=\"background-color: ' + setColor + '; display: flex; align-items: center; justify-content: center; position: relative;\">' +\n\t\t\t\t\t\timageHtml +\n\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'<div class=\"deck-name\">' + deckName + '</div>' +\n\t\t\t\t\t\t'<div class=\"deck-count\">' + deckCount + ' appearances</div>' +\n\t\t\t\t\t\t'<a href=\"' + deckUrl + '\" target=\"_blank\" style=\"display: inline-block; margin-top: 8px; padding: 4px 8px; background: #667eea; color: white; text-decoration: none; border-radius: 4px; font-size: 11px; font-weight: 600;\">Ver Deck</a>';\n\n\t\t\t\t\tgrid.appendChild(card);\n\t\t\t\t});\n\n\t\t\t\tcontainer.appendChild(grid);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('loadMetaDecks error:', error);\n\t\t\t\tcontainer.innerHTML = \\`<div class=\"error\">Failed to load meta decks: \\${error.message}</div>\\`;\n\t\t\t}\n\t\t}\n\n\t\tasync function loadTournaments(days, format) {\n\t\t\tconst container = document.getElementById('tournaments');\n\t\t\tcontainer.innerHTML = '<div class=\"loading\">Loading tournaments...</div>';\n\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\\`/v1/tournaments/recent?days=\\${days}&format=\\${format}&limit=50\\`);\n\t\t\t\tif (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n\n\t\t\t\tconst cacheStatus = res.headers.get('X-Cache');\n\t\t\t\tupdateCacheBadge('tournamentCacheBadge', cacheStatus);\n\n\t\t\t\tconst data = await res.json();\n\n\t\t\t\tif (data.tournaments.length === 0) {\n\t\t\t\t\tcontainer.innerHTML = '<p class=\"loading\">No tournaments found for this period.</p>';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontainer.innerHTML = '';\n\t\t\t\tconst list = document.createElement('div');\n\t\t\t\tlist.className = 'tournament-list';\n\n\t\t\t\tdata.tournaments.slice(0, 10).forEach((tournament, index) => {\n\t\t\t\t\tconst item = document.createElement('div');\n\t\t\t\t\titem.className = 'tournament-item';\n\n\t\t\t\t\titem.innerHTML = \\`\n\t\t\t\t\t\t<div class=\"tournament-name\">\\${tournament.name}</div>\n\t\t\t\t\t\t<div class=\"tournament-meta\">\n\t\t\t\t\t\t\t\\${new Date(tournament.date).toLocaleDateString()}\n\t\t\t\t\t\t\t\u2022 \\${tournament.players || 'N/A'} players\n\t\t\t\t\t\t\t\u2022 \\${tournament.format}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\\`;\n\n\t\t\t\t\tlist.appendChild(item);\n\t\t\t\t});\n\n\t\t\t\tcontainer.appendChild(list);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('loadTournaments error:', error);\n\t\t\t\tcontainer.innerHTML = \\`<div class=\"error\">Failed to load tournaments: \\${error.message}</div>\\`;\n\t\t\t}\n\t\t}\n\n\t\tasync function showDeckDetails(deckName, days, format) {\n\t\t\tconst modal = document.getElementById('deckModal');\n\t\t\tconst content = document.getElementById('modalContent');\n\n\t\t\tmodal.classList.add('active');\n\t\t\tcontent.innerHTML = '<div class=\"loading\">Loading deck details...</div>';\n\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\\`/v1/meta/deck/\\${encodeURIComponent(deckName)}?days=\\${days}&format=\\${format}\\`);\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tif (res.status === 404) {\n\t\t\t\t\t\tthrow new Error('Deck details not available');\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(\\`HTTP \\${res.status}\\`);\n\t\t\t\t}\n\n\t\t\t\tconst data = await res.json();\n\t\t\t\tconst deck = data.deck;\n\n\t\t\t\tif (!deck || !deck.name) {\n\t\t\t\t\tthrow new Error('Invalid deck data received');\n\t\t\t\t}\n\n\t\t\t\tconst setColor = deck.setColor || '#808080';\n\t\t\t\tconst deckName = deck.name || 'Unknown';\n\t\t\t\tconst deckAppearances = deck.appearances || 0;\n\t\t\t\tconst deckUrl = deck.deckUrl || '#';\n\t\t\t\tconst setCode = deck.setCode || 'Unknown';\n\n\t\t\t\tlet imageHtml = '';\n\t\t\t\tif (deck.image) {\n\t\t\t\t\timageHtml = '<img src=\"' + deck.image + '\" alt=\"' + deckName + '\" style=\"height: 100%; width: auto; object-fit: contain;\" onerror=\"this.style.display=\\'none\\'\">';\n\t\t\t\t} else {\n\t\t\t\t\timageHtml = '<span style=\"color: white; font-size: 18px; font-weight: bold; text-transform: uppercase;\">' + setCode + '</span>';\n\t\t\t\t}\n\n\t\t\t\tlet html = '<h2>' + deckName + '</h2>' +\n\t\t\t\t\t'<p style=\"color: #666; margin-bottom: 10px;\">' +\n\t\t\t\t\tdeckAppearances + ' appearances in last ' + days + ' days' +\n\t\t\t\t\t'</p>' +\n\t\t\t\t\t'<a href=\"' + deckUrl + '\" target=\"_blank\" style=\"display: inline-block; margin-bottom: 20px; padding: 8px 16px; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;\">\uD83D\uDCCB Ver Deck Completo en Limitless</a>' +\n\t\t\t\t\t'<div style=\"width: 200px; height: 200px; background-color: ' + setColor + '; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center;\">' +\n\t\t\t\t\timageHtml +\n\t\t\t\t\t'</div>';\n\n\t\t\t\tif (deck.topPlacements && deck.topPlacements.length > 0) {\n\t\t\t\t\thtml += '<div class=\"card-section\"><h3>Top Placements</h3><div class=\"card-list\">';\n\t\t\t\t\tdeck.topPlacements.slice(0, 5).forEach(placement => {\n\t\t\t\t\t\tconst placing = placement.placing || '?';\n\t\t\t\t\t\tconst player = placement.player || 'Unknown';\n\t\t\t\t\t\tconst tournament = placement.tournament || 'Unknown';\n\t\t\t\t\t\tconst record = placement.record || {wins: 0, losses: 0, ties: 0};\n\t\t\t\t\t\tconst date = placement.date ? new Date(placement.date).toLocaleDateString() : 'Unknown';\n\n\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<strong>#\\${placing}</strong> - \\${player} at \\${tournament}\n\t\t\t\t\t\t\t\t\t<div style=\"font-size: 12px; color: #666; margin-top: 4px;\">\n\t\t\t\t\t\t\t\t\t\t\\${record.wins}-\\${record.losses}-\\${record.ties}\n\t\t\t\t\t\t\t\t\t\t\u2022 \\${date}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\\`;\n\t\t\t\t\t});\n\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t}\n\n\t\t\t\tif (deck.cardList) {\n\t\t\t\t\tconst cardList = deck.cardList;\n\n\t\t\t\t\tif (cardList.pokemon && cardList.pokemon.length > 0) {\n\t\t\t\t\t\thtml += \\`<div class=\"card-section\"><h3>Pokemon (\\${cardList.pokemon.length})</h3><div class=\"card-list\">\\`;\n\t\t\t\t\t\tcardList.pokemon.forEach(card => {\n\t\t\t\t\t\t\tconst imageHtml = card.image\n\t\t\t\t\t\t\t\t? \\`<div class=\"card-image-thumb\"><img src=\"\\${card.image}\" alt=\"\\${card.name}\" onerror=\"this.style.display=\\'none\\'\" /></div>\\`\n\t\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t\t\\${imageHtml}\n\t\t\t\t\t\t\t\t\t<span>\\${card.name}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"card-count\">\\${card.count}x</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\\`;\n\t\t\t\t\t\t});\n\t\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (cardList.trainer && cardList.trainer.length > 0) {\n\t\t\t\t\t\thtml += \\`<div class=\"card-section\"><h3>Trainers (\\${cardList.trainer.length})</h3><div class=\"card-list\">\\`;\n\t\t\t\t\t\tcardList.trainer.forEach(card => {\n\t\t\t\t\t\t\tconst imageHtml = card.image\n\t\t\t\t\t\t\t\t? \\`<div class=\"card-image-thumb\"><img src=\"\\${card.image}\" alt=\"\\${card.name}\" onerror=\"this.style.display=\\'none\\'\" /></div>\\`\n\t\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t\t\\${imageHtml}\n\t\t\t\t\t\t\t\t\t<span>\\${card.name}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"card-count\">\\${card.count}x</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\\`;\n\t\t\t\t\t\t});\n\t\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (cardList.energy && cardList.energy.length > 0) {\n\t\t\t\t\t\thtml += \\`<div class=\"card-section\"><h3>Energy (\\${cardList.energy.length})</h3><div class=\"card-list\">\\`;\n\t\t\t\t\t\tcardList.energy.forEach(card => {\n\t\t\t\t\t\t\tconst imageHtml = card.image\n\t\t\t\t\t\t\t\t? \\`<div class=\"card-image-thumb\"><img src=\"\\${card.image}\" alt=\"\\${card.name}\" onerror=\"this.style.display=\\'none\\'\" /></div>\\`\n\t\t\t\t\t\t\t\t: '';\n\t\t\t\t\t\t\thtml += \\`\n\t\t\t\t\t\t\t\t<div class=\"card-item\">\n\t\t\t\t\t\t\t\t\t\\${imageHtml}\n\t\t\t\t\t\t\t\t\t<span>\\${card.name}</span>\n\t\t\t\t\t\t\t\t\t<span class=\"card-count\">\\${card.count}x</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\\`;\n\t\t\t\t\t\t});\n\t\t\t\t\t\thtml += '</div></div>';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcontent.innerHTML = html;\n\t\t\t} catch (error) {\n\t\t\t\tcontent.innerHTML = \\`<div class=\"error\">Failed to load deck details: \\${error.message}</div>\\`;\n\t\t\t}\n\t\t}\n\n\t\tfunction closeModal() {\n\t\t\tdocument.getElementById('deckModal').classList.remove('active');\n\t\t}\n\n\t\tfunction updateCacheBadge(badgeId, cacheStatus) {\n\t\t\tconst badge = document.getElementById(badgeId);\n\t\t\tif (cacheStatus === 'HIT') {\n\t\t\t\tbadge.innerHTML = '<span class=\"cache-badge cache-hit\">CACHED</span>';\n\t\t\t} else if (cacheStatus === 'MISS') {\n\t\t\t\tbadge.innerHTML = '<span class=\"cache-badge cache-miss\">FRESH</span>';\n\t\t\t}\n\t\t}\n\n\t\tfunction showError(message) {\n\t\t\tconst container = document.getElementById('errorContainer');\n\t\t\tcontainer.innerHTML = \\`<div class=\"error\">\\${message}</div>\\`;\n\t\t}\n\n\t\tloadData();\n\n\t\tdocument.getElementById('deckModal').addEventListener('click', (e) => {\n\t\t\tif (e.target.id === 'deckModal') {\n\t\t\t\tcloseModal();\n\t\t\t}\n\t\t});\n\t</script>\n</body>\n</html>`;\n}\n\n/**\n * GET / or /demo - Serve demo HTML page\n */\nasync function handleDemo(request, env, ctx) {\n\treturn new Response(generateDemoHTML(), {\n\t\theaders: {\n\t\t\t'Content-Type': 'text/html; charset=utf-8',\n\t\t\t'Cache-Control': 'public, max-age=300',\n\t\t},\n\t});\n}\n\nexport default {\n\tasync fetch(request, env, ctx) {\n\t\tconst url = new URL(request.url);\n\n\t\t// Demo page\n\t\tif ((url.pathname === '/' || url.pathname === '/demo') && request.method === 'GET') {\n\t\t\treturn await handleDemo(request, env, ctx);\n\t\t}\n\n\t\t// Health check\n\t\tif (url.pathname === '/health') {\n\t\t\treturn new Response('OK', { status: 200 });\n\t\t}\n\n\t\t// GET /v1/meta/top\n\t\tif (url.pathname === '/v1/meta/top' && request.method === 'GET') {\n\t\t\treturn await handleMetaTop(request, env, ctx);\n\t\t}\n\n\t\t// GET /v1/tournaments/recent\n\t\tif (url.pathname === '/v1/tournaments/recent' && request.method === 'GET') {\n\t\t\treturn await handleTournamentsRecent(request, env, ctx);\n\t\t}\n\n\t\t// GET /v1/meta/deck/:deckName\n\t\tconst deckMatch = url.pathname.match(/^\\/v1\\/meta\\/deck\\/([^/]+)$/);\n\t\tif (deckMatch && request.method === 'GET') {\n\t\t\treturn await handleDeckDetails(request, env, ctx, deckMatch[1]);\n\t\t}\n\n\t\t// Not found\n\t\treturn new Response('Not Found', { status: 404 });\n\t},\n};\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\src\\\\index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\src\\\\index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\.wrangler\\\\tmp\\\\bundle-ROlSmn\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\.wrangler\\\\tmp\\\\bundle-ROlSmn\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\yagod\\\\Documents\\\\Proyectos\\\\TCGServer\\\\.wrangler\\\\tmp\\\\bundle-ROlSmn\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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",
  "names": []
}
